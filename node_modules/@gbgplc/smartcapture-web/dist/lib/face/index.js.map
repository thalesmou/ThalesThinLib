{"version":3,"file":"index.js","sources":["../../../../src/face/error/FaceCameraError.ts","../../../../src/helper/index.ts","../../../../src/image/resizer.ts","../../../../src/image/DetectResponse.ts","../../../../src/image/smart-capture/SmartCaptureHost.ts","../../../../src/face/components/live-face-camera.ts","../../../../src/image/SmartCaptureModule.ts","../../../../src/image/smart-capture/SmartCaptureWorker.ts","../../../../src/face/components/FaceCameraEventDispatcher.ts"],"sourcesContent":["export type FaceCameraError = {\n  code: number;\n  message: string;\n};\n\nexport const PermissionNotGrantedError = (\n  message: string\n): FaceCameraError => ({ code: 1, message });\n\nexport const UnexpectedError = (message: string): FaceCameraError => ({\n  code: 2,\n  message: `Unexpected error: ${message}`,\n});\n","export { addMetadata, SDKMetadata } from './MetaDataHelper';\n\nexport const isIpadIOS13OrAbove = () =>\n  navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;\n\nexport const isIOS = (): boolean =>\n  /iPad|iPhone|iPod/.test(navigator.platform) || isIpadIOS13OrAbove();\n\nexport const iOSversion = (): number[] => {\n  if (/iP(hone|od|ad)/.test(navigator.platform)) {\n    // supports iOS 2.0 and later: <http://bit.ly/TJjs1V>\n    try {\n      const v = navigator.appVersion.match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n      if (v === null) {\n        return [-1];\n      }\n      return [\n        parseInt(v[1], 10),\n        parseInt(v[2], 10),\n        parseInt(v[3] || '0', 10),\n      ];\n    } catch (_) {\n      return [-1];\n    }\n  }\n  return [-1];\n};\n\nexport const isiOS144Plus = (): boolean => {\n  const ver = iOSversion();\n  return ver && ver.length >= 2 && ver[0] === 14 && ver[1] >= 4;\n};\n\nexport const isiOS15 = (): boolean => {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] === 15;\n};\n\nexport function isiOS163OrLess() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] === 16 && ver[1] < 4;\n}\n\nexport function isiOS164Plus() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] >= 16 && ver[1] >= 4;\n}\n\nexport function isiOS17() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] >= 17;\n}\n\nexport const isDeviceAffectedByIOS16Issue = (): boolean => {\n  const decodedCookie = decodeURIComponent(document.cookie);\n  if (decodedCookie.includes('ForceRegularCapture=true')) {\n    return false;\n  }\n  if (decodedCookie.includes('ForceDistantCapture=true')) {\n    return true;\n  }\n  if (isiOS163OrLess()) {\n\n    const dims = [screen.width, screen.height];\n    const long = Math.max(...dims);\n    const short = Math.min(...dims);\n    if (long === 852 && short === 393) {\n      // 14 pro\n      return true;\n    }\n    if (long === 932 && short === 430) {\n      // 14 pro max\n      return true;\n    }\n    if (long === 844 && short === 390) {\n      // 13 pro\n      return true;\n    }\n    if (long === 926 && short === 428) {\n      // 13 pro max\n      return true;\n    }\n  }\n  return false;\n};\n\nexport const isFirefox = (): boolean =>\n  navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const isSamsungNote10OrS10OrNewer = async () => {\n  const navData: any = navigator;\n  let deviceModel: any = '';\n\n  if (navData.userAgentData?.getHighEntropyValues) {\n    const dm = await navData.userAgentData.getHighEntropyValues(['model']);\n    if (typeof dm === 'string') {\n      deviceModel = dm;\n    } else if (typeof dm.model === 'string') {\n      deviceModel = dm.model;\n    }\n  } else {\n    deviceModel = navigator.userAgent;\n  }\n\n  const matchedModelNumber = deviceModel.match(/SM-[N|G|S]\\d{3}/);\n  if (!matchedModelNumber) {\n    return false;\n  }\n\n  const modelNumber = parseInt(matchedModelNumber[0].match(/\\d{3}/)[0], 10);\n  const smallerModelNumber = deviceModel.match(/SM-S\\d{3}/) ? 900 : 970; // S10e\n  return !Number.isNaN(modelNumber) && modelNumber >= smallerModelNumber;\n};\n\nexport const isChromeForIOS = () => {\n  const { userAgent } = window.navigator;\n  const isWebkit = userAgent.indexOf('WebKit') > -1;\n  const isChrome = userAgent.indexOf('CriOS') > -1;\n  return isWebkit && isChrome && isIOS();\n};\n\nexport const isLiveCaptureSupported = (): boolean =>{\n  if('mediaDevices' in navigator){\n    return true\n  }\n  console.error(\"Camera not available\");\n  return false\n}\n\nexport const isBackCameraLabel = (cameraLabel: string): boolean => {\n  const backCameraKeywords = [\n    'rear',\n    'back',\n    'rück',\n    'arrière',\n    'trasera',\n    'trás',\n    'traseira',\n    'posteriore',\n    '后面',\n    '後面',\n    '背面',\n    'задней',\n    'الخلفية',\n    '후',\n    'arka',\n    'achterzijde',\n    'หลัง',\n    'baksidan',\n    'bagside',\n    'sau',\n    'bak',\n    'tylny',\n    'takakamera',\n    'belakang',\n    'אחורית',\n    'πίσω',\n    'spate',\n    'hátsó',\n    'zadní',\n    'darrere',\n    'zadná',\n    'задня',\n    'stražnja',\n    'belakang',\n    'बैक',\n  ];\n  return backCameraKeywords.some(keyword => cameraLabel.includes(keyword));\n};\n\nexport const arrayBufferToBase64 = (buffer: ArrayBuffer): string => {\n  let binary = '';\n  const bytes = new Uint8Array(buffer);\n  const len = bytes.byteLength;\n  for (let i = 0; i < len; i += 1) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return window.btoa(binary);\n};\nexport const deviceOS = (): string => (isIOS() ? 'iOS' : 'Android');\n\nexport const sdkName = 'Docs & Bio Mobile Web SDK 1.0';\n","const onload: (imageElement: HTMLImageElement) => string = (\n  imageElement: HTMLImageElement\n) => {\n  const canvasElement = document.createElement('canvas');\n  let MAX_WIDTH = 1080;\n  let MAX_HEIGHT = 720;\n  const { width, height } = imageElement;\n  const context = canvasElement.getContext('2d');\n\n  const smallerDimension = width > height ? height : width;\n\n  if (smallerDimension > MAX_HEIGHT) {\n    if (width < height) {\n      const aspectRatio = height / width;\n      MAX_WIDTH = MAX_HEIGHT;\n      MAX_HEIGHT = MAX_WIDTH * aspectRatio;\n    } else {\n      const aspectRatio = width / height;\n      MAX_WIDTH = MAX_HEIGHT * aspectRatio;\n    }\n  } else {\n    MAX_WIDTH = imageElement.width;\n    MAX_HEIGHT = imageElement.height;\n  }\n\n  canvasElement.width = MAX_WIDTH;\n  canvasElement.height = MAX_HEIGHT;\n\n  context?.drawImage(imageElement, 0, 0, MAX_WIDTH, MAX_HEIGHT);\n  const data = canvasElement.toDataURL('image/jpeg', 0.8);\n  context?.clearRect(0, 0, MAX_WIDTH, MAX_HEIGHT);\n  return data;\n};\n\nexport const resizeImageFromBlob = (imageBlob: Blob): Promise<string> =>\n  new Promise(resolve => {\n    const imageElement = document.createElement('img');\n\n    imageElement.onload = () => {\n      const data = onload(imageElement);\n      URL.revokeObjectURL(imageElement.src);\n      resolve(data);\n    };\n    imageElement.src = URL.createObjectURL(imageBlob);\n  });\n\nexport const resizeImageFromString = (imageSrc: string): Promise<string> =>\n  new Promise(resolve => {\n    const imageElement = document.createElement('img');\n\n    imageElement.onload = () => {\n      const data = onload(imageElement);\n      resolve(data.split('base64,')[1]);\n    };\n    imageElement.src = imageSrc;\n  });\n","export enum DocumentType {\n  ID1,\n  ID2,\n  ID3,\n  OTHER,\n  NONE,\n}\n\nexport enum DocumentState {\n  SMALL_DOCUMENT,\n  OUT_OF_FRAME_DOCUMENT,\n  GOOD_DOCUMENT,\n}\n\nexport type Dimension = {\n  width: number;\n  height: number;\n};\n\nexport type Corner = {\n  x: number;\n  y: number;\n};\n\nexport type MappedCorners = {\n  topLeft: Corner;\n  topRight: Corner;\n  bottomLeft: Corner;\n  bottomRight: Corner;\n};\n\nexport type DetectResponse = {\n  isGood: boolean;\n  image?: ImageData;\n  state?: DocumentState;\n  dimensions?: Dimension;\n  isAdequateDpi?: boolean;\n  isSharp?: boolean;\n  isGlareFree?: boolean;\n  quality?: Object;\n  coords?: Object;\n  corners?: MappedCorners;\n  failedChecks: String[];\n};\n","/* eslint no-promise-executor-return: 0 */\nimport { SmartCaptureWorkerMessages } from './enums/SmartCaptureWorkerMessages';\nimport { IImageResult } from './interfaces/IImage';\nimport { IWorkerMessageEvent } from './interfaces/IMessage';\n\nexport class SmartCaptureHost {\n  private smartCaptureWorker?: Worker;\n\n  public createWorker = (workerScriptUrl: string): Promise<void> =>\n    new Promise((resolve, reject) => {\n      if (this.smartCaptureWorker) {\n        return this.makeRequest(SmartCaptureWorkerMessages.Initialize, null)\n          .then(resolve)\n          .catch(reject);\n      }\n      this.smartCaptureWorker = this.createCrossDomainWorker(workerScriptUrl);\n      return this.makeRequest(SmartCaptureWorkerMessages.Initialize, null)\n        .then(resolve)\n        .catch(reject);\n    });\n\n  private createCrossDomainWorker(workerUrl: string): Worker | undefined {\n    let worker;\n    try {\n      if (this.testSameOrigin(workerUrl)) {\n        worker = new Worker(workerUrl, { type: 'module' });\n        worker.onerror = event => {\n          event.preventDefault();\n          worker = this.createWorkerFallback(workerUrl);\n        };\n      } else {\n        worker = this.createWorkerFallback(workerUrl);\n      }\n    } catch (_) {\n      worker = this.createWorkerFallback(workerUrl);\n    }\n    return worker;\n  }\n\n  private createWorkerFallback(workerUrl: string): Worker | undefined {\n    let worker;\n    try {\n      let blob;\n      try {\n        // TODO: This does not work as expected. We cannot use importScripts with module\n        blob = new Blob([`importScripts('${workerUrl}');`], { type: 'module' });\n      } catch (_) {\n        const blobBuilder = new ((window && (window as any).BlobBuilder) ||\n          (window && (window as any).WebKitBlobBuilder) ||\n          (window && (window as any).MozBlobBuilder))();\n        blobBuilder.append(`importScripts('${workerUrl}');`);\n        blob = blobBuilder.getBlob('module');\n      }\n\n      const url =\n        (window && (window as any).URL) ||\n        (window && (window as any).webkitURL);\n      const blobUrl = url.createObjectURL(blob);\n      return new Worker(blobUrl);\n    } catch (e1) {\n      console.log('WorkerFallback', e1);\n    }\n    return worker;\n  }\n\n  public checkImage = (image: any): Promise<IImageResult> =>\n    this.makeRequest(SmartCaptureWorkerMessages.PerformQualityCheck, { image });\n\n  private makeRequest = <InputType = any, OutputType = any>(\n    requestMessage: SmartCaptureWorkerMessages,\n    requestData: InputType,\n    requestId: string = new Date().getTime().toString()\n  ): Promise<OutputType> =>\n    new Promise((resolve, reject) => {\n      if (this.smartCaptureWorker) {\n        const responseHandler = ({ data }: IWorkerMessageEvent<OutputType>) => {\n          if (data.id === requestId) {\n            this.smartCaptureWorker!.removeEventListener(\n              'message',\n              responseHandler\n            );\n            this.smartCaptureWorker!.removeEventListener('error', errorHandler);\n\n            switch (data.message) {\n              case SmartCaptureWorkerMessages.Error:\n                return reject();\n              default:\n                return resolve(data.data);\n            }\n          }\n          return reject();\n        };\n\n        const errorHandler = (e: any) => {\n          this.smartCaptureWorker!.removeEventListener(\n            'message',\n            responseHandler\n          );\n          this.smartCaptureWorker!.removeEventListener('error', errorHandler);\n          return reject(e);\n        };\n\n        this.smartCaptureWorker.addEventListener('message', responseHandler);\n        this.smartCaptureWorker.addEventListener('error', errorHandler);\n\n        this.smartCaptureWorker!.postMessage({\n          id: requestId,\n          message: requestMessage,\n          data: requestData,\n        });\n      } else {\n        reject();\n      }\n    });\n\n  private testSameOrigin(url: string) {\n    const loc = window.location;\n    const a = document.createElement('a');\n    a.href = url;\n    return (\n      a.hostname === loc.hostname &&\n      a.port === loc.port &&\n      a.protocol === loc.protocol\n    );\n  }\n}\n\n// TODO: Ideally this string wants to come from webpack...\nexport default new SmartCaptureHost();\n","import { html, css, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ref, createRef, Ref } from 'lit/directives/ref.js';\nimport { FaceDetectionHint } from './FaceDetectionHint.js';\nimport {\n  PermissionNotGrantedError,\n  UnexpectedError,\n} from '../error/index';\nimport { /* addMetadata, */ isLiveCaptureSupported } from '../../helper/index';\nimport { resizeImageFromBlob } from '../../image/index';\nimport { FaceCameraEventDispatcher } from './FaceCameraEventDispatcher';\nexport enum FaceDetectionState {\n  NotInitialized = 'NOT_INITIALIZED',\n  FaceNotFound = 'FACE_NOT_FOUND',\n  TooManyFaces = 'TOO_MANY_FACES',\n  FaceAngleTooLarge = 'FACE_ANGLE_TOO_LARGE',\n  ProbabilityTooSmall = 'PROBABILITY_TOO_SMALL',\n  FaceTooSmall = 'FACE_TOO_SMALL',\n  FaceCloseToBorder = 'FACE_CLOSE_TO_BORDER',\n}\n\nfunction loadIDRND(environment: string) {\n  if (environment === 'development') {\n    return import('idlive-face-capture-web-development');\n  }\n  return import('idlive-face-capture-web');\n}\n\n@customElement('live-face-camera')\nexport class LiveFaceCamera extends LitElement {\n  public static readonly InitializeEventName = FaceCameraEventDispatcher.InitializeEventName;\n  public static readonly BeforeOpenEventName = FaceCameraEventDispatcher.BeforeOpenEventName;\n  public static readonly OpenEventName = FaceCameraEventDispatcher.OpenEventName;\n  public static readonly DetectEventName = FaceCameraEventDispatcher.DetectEventName;\n  public static readonly BeforeCaptureEventName = FaceCameraEventDispatcher.BeforeCaptureEventName;\n  public static readonly CaptureEventName = FaceCameraEventDispatcher.CaptureEventName;\n  public static readonly CloseEventName = FaceCameraEventDispatcher.CloseEventName;\n  public static readonly FailureEventName = FaceCameraEventDispatcher.FailureEventName;\n\n  /**\n   * @deprecated Use 'InitializeEventName' instead. This will be removed in a feature release.\n   */\n  public static readonly DetectorInitializeEventName =\n    FaceCameraEventDispatcher.DetectorInitializeEventName;\n\n  /**\n   * @deprecated Use 'DetectEventName' instead. This will be removed in a feature release.\n   */\n  public static readonly PreviewEventName = FaceCameraEventDispatcher.PreviewEventName;\n\n  /**\n   * @deprecated RetakeEventName will be removed in a future release and will have no replacement.\n   */\n  public static readonly RetakeEventName = FaceCameraEventDispatcher.RetakeEventName;\n\n  private readonly liveCameraRef: Ref<HTMLElement> = createRef();\n\n  private readonly eventDispatcher: FaceCameraEventDispatcher =\n    new FaceCameraEventDispatcher(this);\n\n  private lastDetectionState: FaceDetectionState | null = null;\n  private isFlashing: boolean = false;\n\n  @property({ type: String})\n  environment: 'development' | 'production' = 'production';\n\n  @property({ type: Boolean })\n  isOpen: boolean = false;\n\n  @property({ type: Object })\n  hints: FaceDetectionHint | undefined = undefined;\n\n  @state()\n  detectionState: FaceDetectionState = FaceDetectionState.FaceNotFound;\n\n  @state()\n  isInPreview: boolean = false;\n\n  detectionText: (faceState: FaceDetectionState) => string = (\n    faceState: FaceDetectionState,\n  ) => {\n    switch (faceState) {\n      case FaceDetectionState.NotInitialized:\n        return this.hints?.notInitializedHint ?? 'Tap to capture';\n      case FaceDetectionState.FaceNotFound:\n        return this.hints?.faceNotFoundHint ?? 'Face not found';\n      case FaceDetectionState.TooManyFaces:\n        return this.hints?.tooManyFacesHint ?? 'Too many faces';\n      case FaceDetectionState.FaceAngleTooLarge:\n        return this.hints?.faceAngleTooLargeHint ?? 'Face not straight on';\n      case FaceDetectionState.ProbabilityTooSmall:\n        return this.hints?.probabilityTooSmallHint ?? 'Probability too small';\n      case FaceDetectionState.FaceTooSmall:\n        return this.hints?.faceTooSmallHint ?? 'Face too far';\n      case FaceDetectionState.FaceCloseToBorder:\n        return this.hints?.faceCloseToBorderHint ?? 'Face too close';\n      default:\n        return '';\n    }\n  };\n\n  static readonly styles = css`\n\n    :host {\n          display: flex;\n\n      width: 100%;\n      height: 100%;\n    }\n      .warningIcon{\n      width: 1.5vw;\n      height: 1.5vw;\n    }\n  .hint, .initializer {\n  white-space: nowrap;\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n  font-family: 'Inter';\n  color: rgb(255, 255, 255);\n  text-align: center;\n  font-weight: normal;\n}\n\n.hint {\n  bottom: -10vh; /* Adjust this value as needed */\n  font-size: 1.5vw;\n}\n  .hint.done {\n  display: none;\n}\n\n.initializer {\n  top: -10vh; /* Adjust this value as needed */\n  font-size: 1.5vw;\n}\n      .hint2 {\n      justify-content: center;\n      align-items: center;\n\n      z-index: 101;\n      font-family: 'Inter';\n\n      font-size: 2vw;\n\n      color: rgb(255, 255, 255);\n      bottom: 5vh;\n      text-align: center;\n      font-weight: normal;\n    }\n\n    .oval {\n      z-index: 100;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      position: absolute;\n      width: 50vh;\n      height: 70%;\n      border: 1.1vw solid white;\n      border-radius: 70vw;\n      background: transparent;\n      box-shadow: 0 0 0 9999px rgba(0, 0, 10, 0.6);\n      transition: .5s;\n    }\n     .capturedModal{\n\n      font-size: 1.5vw;\n      display:none;\n      text-align: center;\n      justify-content: center;\n      align-items: center;\n      color:white;\n      z-index: 100;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      position: absolute;\n      width: 20vw;\n      height: 4vw;\n      border-radius: 8px;\n      background: rgba(0,0,10,0.6);\n      transition: 1s;\n      }\n      .capturedModal.done {\n      display: flex;\n\n    }\n    /* Adjust for portrait mode */\n    @media (orientation: portrait) {\n      .oval {\n        width: 70vw;\n        height: 100vw;\n        border-radius: 140vw;\n      }\n      .hint {\n        font-size: 100%;\n        bottom: -8vh;\n          font-size: 2vh;\n\n      }\n      .initializer {\n        top: -8vh; /* Adjust this value as needed */\n\n      font-size: 2vh;\n      white-space: nowrap;\n      }\n      .warningIcon{\n        width:6vw;\n        height: 6vw;\n\n      }\n      .capturedModal{\n        width: 40vw;\n        height: 8vw;\n        font-size: 3vw;\n      }\n      .capturedModal svg{\n        width: 3vw;\n        height: 3vw;\n      }\n    }\n    svg {\n      vertical-align: middle;\n      margin-bottom: .5vw;\n    }\n    .liveface{\n      height:100%;\n      width:100%;\n      position:absolute;\n      top:0\n    }\n\n    .oval.error {\n      transition: 1s;\n      border-color: orange;\n    }\n    .sidepanel{\n      z-index: 103;\n      display: none;\n      position: absolute;\n      background: rgba(0,0,10,1);\n      height: 100%;\n      width: 40%;\n      right: 0%;\n    }\n    .oval.done {\n      border-color: rgb(144, 238, 144);\n    }\n\n    @media (orientation: landscape) {\n      .oval.mobile {\n      left: 23%;\n      height: 80%;\n\n      transform: translate(-20%, -50%);    }\n      .sidepanel.mobile{\n        display: flex;\n        top: 0;\n        text-align: center;\n        justify-content: center;\n        align-items: center;\n      }\n      .liveface.mobile{\n        width:80%;\n        transform: translate(-25%, 0);\n\n      }\n      .hint.mobile{\n       display: none;\n      }\n      .initializer.mobile{\n        display: none;\n      }\n    }\n    .capturedModal svg {\n      margin-right: 8px;\n    }\n    .backButton{\n    position:absolute;\n    z-index:101;\n    top:4vh;\n\n    left:5vw;\n    }\n  `;\n  private isMobileDevice(): boolean {\n    return /Android|iPhone|iPad/i.test(navigator.userAgent);\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n    this.loadLibrary().then(() => console.log('Library loaded successfully.')).catch((error) => console.error('Error loading library', error));\n  }\n\n  private async loadLibrary() {\n    try {\n      const library = await loadIDRND(this.environment);\n      console.log(`${this.environment} library loaded`, library);\n    } catch (error) {\n      console.log(`Failed to load the ${this.environment} library`, error);\n    }\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    if (!changedProperties.has('isOpen')) {\n      return;\n    }\n    if (isLiveCaptureSupported()) {\n      if (this.isOpen) {\n        this.liveCameraRef.value?.dispatchEvent(new Event('open'));\n      } else {\n        this.liveCameraRef.value?.dispatchEvent(new Event('close'));\n      }\n    } else if (this.isOpen) { /* empty */ }\n  }\n\n  private _onInitialized(e: CustomEvent) {\n    e.stopPropagation();\n    console.log(\"Initialized\")\n    this.eventDispatcher.dispatchInitialized();\n  }\n\n  private _onBeforeOpened(e: CustomEvent) {\n    e.stopPropagation();\n    this.eventDispatcher.dispatchBeforeOpened();\n  }\n\n  private _onOpened(e: CustomEvent) {\n    const oval = this.shadowRoot?.querySelector('.oval');\n    const initializer = this.shadowRoot?.querySelector('.initializer');\n    const sidepanel = this.shadowRoot?.querySelector('.sidepanel');\n    const liveface = this.shadowRoot?.querySelector('.liveface');\n    const hint = this.shadowRoot?.querySelector('.hint');\n\n    oval?.classList.remove('error')\n    sidepanel?.classList.remove('mobile');\n      liveface?.classList.remove('mobile');\n      oval?.classList.remove('mobile');\n\n    if (this.isMobileDevice()) {\n      console.log(\"Detected mobile device\" )\n\n      sidepanel?.classList.add('mobile');\n      liveface?.classList.add('mobile');\n      oval?.classList.add('mobile');\n      hint?.classList.add('mobile');\n      initializer?.classList.add('mobile');\n\n    }else{\n\n      console.log(\"Detected desktop device\")\n      // if(initializer)\n      //   initializer.innerHTML ='Desktop';\n\n    }\n    e.stopPropagation();\n    (this.liveCameraRef.value as any).openCamera();\n    this.eventDispatcher.dispatchOpened();\n  }\n\n  private _onDetection(e: CustomEvent) {\n    e.stopPropagation();\n    const { errors } = e.detail[0]\n    const detectionText =errors[0];\n    if (detectionText !== undefined) {\n      this.detectionState = detectionText as FaceDetectionState;\n    }\n\n    // Update the border color based on the detection state\n    const oval = this.shadowRoot?.querySelector('.oval');\n    const errorStates = [\n      FaceDetectionState.NotInitialized,\n      FaceDetectionState.FaceNotFound,\n      FaceDetectionState.TooManyFaces,\n      FaceDetectionState.FaceAngleTooLarge,\n      FaceDetectionState.ProbabilityTooSmall,\n      FaceDetectionState.FaceTooSmall,\n      FaceDetectionState.FaceCloseToBorder\n    ];\n\n    if (this.detectionState !== this.lastDetectionState) {\n      if (errorStates.includes(this.detectionState)) {\n        if (!this.isFlashing) {\n          this.isFlashing = true;\n          oval?.classList.add('error');\n          setTimeout(() => {\n            //oval?.classList.remove('error');\n            this.isFlashing = false;\n          }, 300); // 0.3-second delay\n        }\n      }\n      this.lastDetectionState = this.detectionState;\n    }\n    this.eventDispatcher.dispatchDetected(errors);\n  }\n\n  private _onBeforeCaptured(e: CustomEvent) {\n    e.stopPropagation();\n    this.eventDispatcher.dispatchBeforeCaptured();\n  }\n\n  private _onCaptured(e: CustomEvent) {\n    const oval = this.shadowRoot?.querySelector('.oval');\n    const capturedModal = this.shadowRoot?.querySelector('.capturedModal');\n    const hint = this.shadowRoot?.querySelector('.hint');\n\n\n\n    oval?.classList.remove('error');\n    oval?.classList.add('done');\n    hint?.classList.add('done');\n    capturedModal?.classList.add('done');\n\n    setTimeout(() => {\n      e.stopPropagation();\n      this.isInPreview = false;\n      this.isOpen = false;\n\n      const imageBlob: Blob = e.detail[0].photo;\n      resizeImageFromBlob(imageBlob).then(imageBase64 => {\n        this.eventDispatcher.dispatchCapture(\n          imageBase64.split('base64,')[1],\n          e.detail[0].encryptedFile,\n        );\n      });\n      oval?.classList.remove('done');\n      capturedModal?.classList.remove('done');\n      hint?.classList.remove('done');\n\n\n    }, 1000); // 0.3-second delay\n\n  }\n\n  private _onClosed(e: CustomEvent) {\n    e.stopPropagation();\n    this.isOpen = false;\n    this.eventDispatcher.dispatchClosed();\n  }\n\n  private _onFailure(e: CustomEvent) {\n    e.stopPropagation();\n    this.isOpen = false;\n    if (e.type === 'error') {\n      this.eventDispatcher.dispatchError(\n        PermissionNotGrantedError(e.detail.error),\n      );\n    } else {\n      this.eventDispatcher.dispatchError(UnexpectedError(e.detail.error));\n    }\n  }\n\n  private _onPreview(e: CustomEvent) {\n    e.stopPropagation();\n    this.isInPreview = true;\n    this.eventDispatcher.dispatchPreview();\n  }\n\n  private _onRetake(e: CustomEvent) {\n    e.stopPropagation();\n    this.isInPreview = false;\n    this.eventDispatcher.dispatchRetake();\n  }\n\n  private _closeCamera(e: Event) {\n    e.stopPropagation();\n    (this.liveCameraRef.value as any).closeCamera();\n\n    this.isInPreview = false;\n    this.isOpen = false;\n  }\n\n  liveCamera() {\n    return html`\n      <div class=\"backButton\" @click=${this._closeCamera} style=\"cursor: pointer;\">\n      <svg width=\"2rem\" height=\"2rem\"  viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M15 18L9 12L15 6\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      </svg>\n    </div>\n\n      <div class=\"sidepanel\"><div\n        id=\"face-camera-detection-text\"\n        class=\"hint2\"\n        ?hidden=${!this.isOpen || this.isInPreview}\n      >\n        <svg  width=\"3vw\" height=\"3vw\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12 1C12.3788 1 12.725 1.214 12.8944 1.55279L22.8944 21.5528C23.0494 21.8628 23.0329 22.2309 22.8507 22.5257C22.6684 22.8205 22.3466 23 22 23H2C1.65342 23 1.33156 22.8205 1.14935 22.5257C0.967144 22.2309 0.95058 21.8628 1.10557 21.5528L11.1056 1.55279C11.275 1.214 11.6212 1 12 1ZM20.382 21L12 4.23607L3.61804 21H20.382ZM12 9C12.5523 9 13 9.44771 13 10V14C13 14.5523 12.5523 15 12 15C11.4477 15 11 14.5523 11 14V10C11 9.44771 11.4477 9 12 9ZM12 19C12.5523 19 13 18.5523 13 18C13 17.4477 12.5523 17 12 17C11.4477 17 11 17.4477 11 18C11 18.5523 11.4477 19 12 19Z\" fill=\"#F88618\"/>\n        </svg>\n${this.detectionText(this.detectionState)}\n      </div></div>\n\n      <div class=\"oval\">\n        <div class=\"initializer\" >Place your face within the oval</div>\n\n        <div\n\n        id=\"face-camera-detection-text\"\n        class=\"hint\"\n        ?hidden=${!this.isOpen || this.isInPreview}\n      >\n        <svg class=\"warningIcon\"  viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12 1C12.3788 1 12.725 1.214 12.8944 1.55279L22.8944 21.5528C23.0494 21.8628 23.0329 22.2309 22.8507 22.5257C22.6684 22.8205 22.3466 23 22 23H2C1.65342 23 1.33156 22.8205 1.14935 22.5257C0.967144 22.2309 0.95058 21.8628 1.10557 21.5528L11.1056 1.55279C11.275 1.214 11.6212 1 12 1ZM20.382 21L12 4.23607L3.61804 21H20.382ZM12 9C12.5523 9 13 9.44771 13 10V14C13 14.5523 12.5523 15 12 15C11.4477 15 11 14.5523 11 14V10C11 9.44771 11.4477 9 12 9ZM12 19C12.5523 19 13 18.5523 13 18C13 17.4477 12.5523 17 12 17C11.4477 17 11 17.4477 11 18C11 18.5523 11.4477 19 12 19Z\" fill=\"#F88618\"/>\n        </svg>\n  ${this.detectionText(this.detectionState)}\n        </div>\n      </div>\n\n      <div class=\"capturedModal\">\n        <svg width=\"1.5vw\" height=\"1.5vw\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <g clip-path=\"url(#clip0_6455_142)\">\n            <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.5 12C2.5 6.47715 6.97715 2 12.5 2C18.0228 2 22.5 6.47715 22.5 12C22.5 17.5228 18.0228 22 12.5 22C6.97715 22 2.5 17.5228 2.5 12ZM12.5 0C5.87258 0 0.5 5.37258 0.5 12C0.5 18.6274 5.87258 24 12.5 24C19.1274 24 24.5 18.6274 24.5 12C24.5 5.37258 19.1274 0 12.5 0ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L9.20711 12.2929C8.81658 11.9024 8.18342 11.9024 7.79289 12.2929C7.40237 12.6834 7.40237 13.3166 7.79289 13.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z\" fill=\"#78D278\"/>\n          </g>\n          <defs>\n            <clipPath id=\"clip0_6455_142\">\n              <rect width=\"80\" height=\"80\" fill=\"white\" transform=\"translate(0.5)\"/>\n            </clipPath>\n          </defs>\n        </svg>\n        Photo captured\n      </div>\n\n      <div class=\"liveface\">\n        <idlive-face-capture\n        mask_hidden\n        ${ref(this.liveCameraRef)}\n        @initialize=${this._onInitialized}\n        @beforeOpen=${this._onBeforeOpened}\n        @open=${this._onOpened}\n        @detection=${this._onDetection}\n        @beforeCapture=${this._onBeforeCaptured}\n        @capture=${this._onCaptured}\n        @close=${this._onClosed}\n        @error=${this._onFailure}\n\n        @makePhoto=${this._onPreview}\n        @retakePhoto=${this._onRetake}\n      >\n      </idlive-face-capture>\n      </div>\n    `;\n  }\n\n\n  render() {\n    return isLiveCaptureSupported() ? this.liveCamera() : html``;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'live-face-camera': LiveFaceCamera;\n  }\n}\n","/* eslint no-promise-executor-return: 0 */\n/* eslint prefer-promise-reject-errors: 0 */\n/* eslint consistent-return: 0 */\nimport SmartCaptureHost from './smart-capture/SmartCaptureHost';\nimport { DetectResponse, MappedCorners } from './DetectResponse';\nimport { ISmartCaptureModule } from './interfaces/ISmartCaptureModule';\nimport { CaptureResponse } from '../document/CaptureResponse';\n\nexport class SmartCaptureModule implements ISmartCaptureModule {\n\n  static #instance: SmartCaptureModule | undefined;\n\n  private constructor() {\n    this.addBarcodeReaderDiv(this.barcodeReaderId);\n  }\n\n\n  static getInstance: () => SmartCaptureModule = () => {\n    if (!SmartCaptureModule.#instance) {\n      SmartCaptureModule.#instance = new SmartCaptureModule();\n    }\n    return SmartCaptureModule.#instance;\n  };\n\n  private _initialized = false;\n  get isInitialized() {\n    return this._initialized;\n  }\n  private _initializing = false;\n  get isInitializing() {\n    return this._initializing;\n  }\n\n  private barcodeReaderId: string = 'barcode-reader';\n\n  private hiddenCanvas: HTMLCanvasElement = document.createElement('canvas');\n\n  init: () => Promise<boolean> = async () => {\n    if (this._initialized) {\n      return true;\n    }\n    if (!this._initializing) {\n      this._initializing = true;\n      const workerScriptUrl = new URL(__WORKER_PATH__, import.meta.url).href;\n      try {\n        await SmartCaptureHost.createWorker(workerScriptUrl);\n        this._initializing = false;\n        this._initialized = true;\n        return true;\n      } catch {\n        this._initializing = false;\n        this._initialized = false;\n        throw new Error('Create Worker Failed');\n      }\n    } else {\n      return false;\n    }\n  };\n\n  private addBarcodeReaderDiv: (barcodeReaderId: string) => void = (\n    barcodeReaderId: string\n  ) => {\n    if (document.getElementById(barcodeReaderId)) {\n      return;\n    }\n    const barcodeReaderDiv = document.createElement('div');\n    barcodeReaderDiv.id = barcodeReaderId;\n    barcodeReaderDiv.style.display = 'none';\n    document.body.appendChild(barcodeReaderDiv);\n  };\n\n  private processEncodedFrame: (img: ArrayBuffer) => Promise<DetectResponse> =\n    async (img: ArrayBuffer) => {\n      const result = await SmartCaptureHost.checkImage(img);\n      if (result && result.quality && result.coords) {\n        const corners = result.quality.coordinateCheck\n          ? this.mapCorners(result.coords)\n          : undefined;\n        const dimensions = {\n          width: result.coords.width,\n          height: result.coords.height,\n        };\n        // let type = DocumentType.ID1; //todo how can we detect this now\n        const response: DetectResponse = {\n          isGood: result.isGood,\n          // type: type,\n          dimensions,\n          isAdequateDpi: result.quality.resolutionCheck,\n          // isCorrectAspectRatio: this.isCorrectAspectRatio(dimensions, type),\n          corners,\n          isSharp: result.quality.blurCheck,\n          isGlareFree: result.quality.glareCheck,\n          failedChecks: result.failedChecks,\n        };\n        return response;\n      }\n      throw new Error('Part of result was null');\n    };\n\n  // private isCorrectAspectRatio(dimens: Dimension, cardType: DocumentType) {\n  //   let aspectRatio = dimens.width/dimens.height;\n  //   let isCorrectAspectRatio = false;\n  //   let tolerancePercentage = 5.0;\n  //   let expectedPassportAspectRatio = 1.42;\n  //   let expectedID1AspectRatio = 1.58870;\n  //   let expectedID2AspectRatio  = 1.41915551;\n  //   if (cardType == DocumentType.ID3) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedPassportAspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedPassportAspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   } else if (cardType == DocumentType.ID1) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedID1AspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedID1AspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   } else if (cardType == DocumentType.ID2) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedID2AspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedID2AspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   }\n  //   return isCorrectAspectRatio;\n  // }\n\n  private mapCorners(coords: {\n    height: number;\n    width: number;\n    x: number;\n    y: number;\n  }): MappedCorners {\n    return {\n      topLeft: {\n        x: coords.x,\n        y: coords.y,\n      },\n      topRight: {\n        x: coords.x + coords.width,\n        y: coords.y,\n      },\n      bottomRight: {\n        x: coords.x + coords.width,\n        y: coords.y + coords.height,\n      },\n      bottomLeft: {\n        x: coords.x,\n        y: coords.y + coords.height,\n      },\n    };\n  }\n\n  private imageDataToBlob: (imageData: ImageData) => Promise<Blob> = async (\n    imageData: ImageData\n  ) => {\n    const w = imageData.width;\n    const h = imageData.height;\n    const { hiddenCanvas } = this;\n    const hiddenContext = this.hiddenCanvas.getContext('2d');\n\n    if (!hiddenContext) {\n      throw new Error('Hidden Context Missing');\n    }\n    hiddenCanvas.width = w;\n    hiddenCanvas.height = h;\n    hiddenContext.putImageData(imageData, 0, 0);\n    const blob: Blob | null = await new Promise(resolve =>\n      hiddenCanvas.toBlob(resolve)\n    );\n    if (blob) return blob;\n    throw new Error('Canvas To Blob Errored');\n  };\n\n  detect: (imgData: CaptureResponse) => Promise<DetectResponse> = async (\n    imgData: CaptureResponse\n  ) => {\n    if (imgData.imageData) {\n      const asBlob = await this.imageDataToBlob(imgData.imageData);\n      const buffer = await asBlob.arrayBuffer();\n      const result = await this.processEncodedFrame(buffer);\n      if (result.isGood) {\n        const croppedImg = await this.crop(buffer, result);\n        result.image = croppedImg;\n        return result;\n      }\n      return result;\n    }\n    throw new Error('Image Data Was Null');\n  };\n\n  crop: (\n    imgBlob: ArrayBuffer,\n    captureData: DetectResponse\n  ) => Promise<ImageData> = async (\n    imgBlob: ArrayBuffer,\n    captureData: DetectResponse\n  ) => {\n    if (!imgBlob || !captureData.corners) {\n      throw new Error('Image or Corners Missing');\n    }\n\n    const { hiddenCanvas } = this;\n    const hiddenContext = this.hiddenCanvas.getContext('2d');\n\n    if (!hiddenContext) {\n      throw new Error('Hidden Context Missing');\n    }\n\n    if (captureData.dimensions?.width && captureData.dimensions?.height) {\n      const blob = new Blob([imgBlob], { type: 'image/jpeg' });\n      const img = new Image();\n\n      const addImageProcess = (src: string) =>\n        new Promise<ImageData>((resolve, reject) => {\n\n          img.onload = function () {\n            if (captureData.corners) {\n              const top = Math.min(\n                captureData.corners.topLeft.y,\n                captureData.corners.topRight.y\n              );\n              const bot = Math.max(\n                captureData.corners.bottomLeft.y,\n                captureData.corners.bottomRight.y\n              );\n              const left = Math.min(\n                captureData.corners.topLeft.x,\n                captureData.corners.bottomLeft.x\n              );\n              const right = Math.max(\n                captureData.corners.topRight.x,\n                captureData.corners.bottomRight.x\n              );\n\n              hiddenCanvas.height = bot - top;\n              hiddenCanvas.width = right - left;\n              hiddenContext.drawImage(\n                img,\n                left,\n                top,\n                right - left,\n                bot - top,\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              const data = hiddenContext.getImageData(\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              hiddenContext.clearRect(\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              hiddenCanvas.height = 1;\n              hiddenCanvas.width = 1;\n\n              resolve(data);\n            }\n          };\n          img.onerror = reject;\n          img.src = src;\n        });\n\n      return addImageProcess(URL.createObjectURL(blob));\n    }\n    throw new Error('Width or Height Missing');\n  };\n}\n","/* eslint camelcase: 0 */\n/* eslint no-promise-executor-return: 0 */\nimport stickman_module from '@gbgplc/stickman-wasm';\nimport { SmartCaptureWorkerMessages } from './enums/SmartCaptureWorkerMessages';\nimport { IWorkerMessageEvent, IWorkerMessage } from './interfaces/IMessage';\n\nexport class SmartCaptureWorker {\n  private smartCapture?: any;\n  private workerGlobalContext: any;\n\n  constructor(workerGlobalContext: any) {\n    this.workerGlobalContext = workerGlobalContext;\n\n    this.workerGlobalContext.addEventListener('message', this.onMessage);\n    this.workerGlobalContext.addEventListener('error', this.onError);\n  }\n\n  private postMessage = (\n    id: string,\n    message: SmartCaptureWorkerMessages,\n    data?: any\n  ): Promise<void> =>\n    new Promise(resolve =>\n      resolve(\n        this.workerGlobalContext.postMessage({\n          id,\n          message,\n          data,\n        } as IWorkerMessage)\n      )\n    );\n\n  private onError = (e: Error) =>\n    this.postMessage('', SmartCaptureWorkerMessages.Error, { ...e });\n\n\n  private onMessage = ({ data }: IWorkerMessageEvent) => {\n    switch (data.message) {\n      case SmartCaptureWorkerMessages.PerformQualityCheck:\n        return this.onPerformQualityCheck(data.id, data.data);\n      case SmartCaptureWorkerMessages.Terminate:\n        return this.postMessage(\n          data.id,\n          SmartCaptureWorkerMessages.Terminate\n        ).then(() => this.workerGlobalContext.close());\n      case SmartCaptureWorkerMessages.Initialize:\n        return this.onInitialize()\n          .then(() =>\n            this.postMessage(data.id, SmartCaptureWorkerMessages.ReadyToProcess)\n          )\n          .catch(() =>\n            this.postMessage(data.id, SmartCaptureWorkerMessages.Error)\n          );\n      default:\n    }\n  };\n\n  private onInitialize = () =>\n    new Promise(resolve => {\n      if (this.smartCapture) {\n        return resolve(this.smartCapture);\n      }\n      return stickman_module().then((smartCapture: any) => {\n        this.smartCapture = smartCapture;\n\n        return resolve(smartCapture);\n      });\n    });\n\n  private onPerformQualityCheck = (id: string, { image }: { image: any }) => {\n    this.checkQuality(image)\n      .then(response =>\n        this.postMessage(id, SmartCaptureWorkerMessages.CheckComplete, response)\n      )\n      .catch((e: any) =>\n        this.postMessage(id, SmartCaptureWorkerMessages.CheckFailed, e.message)\n      );\n  };\n\n  private resolveCheck = (\n    name: string,\n    succesfulChecks: any,\n    failedChecks: any\n  ) => {\n    const checkPassed = succesfulChecks.includes(name);\n    const checkFailed = failedChecks.includes(name);\n    if (!checkPassed && !checkFailed) {\n      return null;\n    }\n    return checkPassed;\n  };\n\n  private checkQuality = (image: any) => {\n    const smResult = this.smartCapture.analyse_encoded_image(image);\n    const { document_bounds, failed_checks, is_good, successful_checks } =\n      JSON.parse(smResult);\n    const result = Promise.resolve({\n      isGood: is_good,\n      quality: {\n        blurCheck: this.resolveCheck(\n          'BlurCheck',\n          successful_checks,\n          failed_checks\n        ),\n        glareCheck: this.resolveCheck(\n          'GlareCheck',\n          successful_checks,\n          failed_checks\n        ),\n        resolutionCheck: this.resolveCheck(\n          'LowResolutionCheck',\n          successful_checks,\n          failed_checks\n        ),\n        coordinateCheck: this.resolveCheck(\n          'FullDocumentInViewCheck',\n          successful_checks,\n          failed_checks\n        ),\n      },\n      failedChecks: failed_checks,\n      coords: document_bounds,\n    });\n\n    return result;\n  };\n}\n\nexport default new SmartCaptureWorker(self);\n","import { FaceCameraError, UnexpectedError } from '../error/index';\n\nexport class FaceCameraEventDispatcher {\n\n  public static InitializeEventName = 'initialize';\n  public static BeforeOpenEventName = 'beforeOpen';\n  public static OpenEventName = 'open';\n  public static DetectEventName = 'detect';\n  public static BeforeCaptureEventName = 'beforeCapture';\n  public static CaptureEventName = 'capture';\n  public static CloseEventName = 'close';\n  public static FailureEventName = 'failure';\n\n  /**\n   * @deprecated Use 'InitializeEventName' instead. This will be removed in a feature release.\n   */\n  public static DetectorInitializeEventName = 'initialize';\n\n  /**\n   * @deprecated Use 'DetectEventName' instead. This will be removed in a feature release.\n   */\n  public static PreviewEventName = 'preview';\n\n  /**\n   * @deprecated RetakeEventName will be removed in a future release and will have no replacement.\n   */\n  public static RetakeEventName = 'retake';\n\n  private parent: HTMLElement;\n\n  constructor(parent: HTMLElement) {\n    this.parent = parent;\n  }\n\n  public dispatchInitialized() {\n    const event = new CustomEvent(\n      FaceCameraEventDispatcher.InitializeEventName,\n      {\n        bubbles: true,\n        composed: true,\n      }\n    );\n    const deprecatedEvent = new CustomEvent(\n      FaceCameraEventDispatcher.DetectorInitializeEventName,\n      {\n        bubbles: true,\n        composed: true,\n      }\n    );\n    this.parent.dispatchEvent(event);\n\n    console.warn(\"DetectorInitializeEventName is deprecated.  Use 'InitializeEventName' instead.\");\n    this.parent.dispatchEvent(deprecatedEvent);\n  }\n\n  public dispatchBeforeOpened() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.BeforeOpenEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchOpened() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.OpenEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchDetected(detectionErrors: string[]) {\n    const event = new CustomEvent(FaceCameraEventDispatcher.DetectEventName, {\n      bubbles: true,\n      composed: true,\n      detail: { errors: detectionErrors },\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchBeforeCaptured() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.BeforeCaptureEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchCapture(imageBase64: string, encryptedFile: Blob | null) {\n    if (!imageBase64) {\n      this.dispatchError(\n        UnexpectedError('Capture called with missing result image')\n      );\n    }\n    const event = new CustomEvent(FaceCameraEventDispatcher.CaptureEventName, {\n      bubbles: true,\n      composed: true,\n      detail: {\n        imageBase64,\n        encryptedFile,\n      },\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchClosed() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.CloseEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n\n  public dispatchError(error: FaceCameraError) {\n    const event = new CustomEvent(FaceCameraEventDispatcher.FailureEventName, {\n      bubbles: true,\n      composed: true,\n      detail: {\n        error,\n      },\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  /**\n   * @deprecated This will be removed in a future release and has no replacement.\n   */\n  public dispatchRetake() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.RetakeEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    console.warn(\"RetakeEventName is deprecated and will be removed in a future release\");\n    this.parent.dispatchEvent(event);\n  }\n\n  /**\n   * @deprecated Use dispatchDetected instead. This will be removed in a  future release.\n   */\n  public dispatchPreview() {\n    const deprecatedEvent = new CustomEvent(FaceCameraEventDispatcher.PreviewEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    console.warn(\"PreviewEventName is deprecated.  Use 'DetectEventName' instead.\");\n    this.parent.dispatchEvent(deprecatedEvent);\n  }\n}\n"],"names":["PermissionNotGrantedError","message","code","UnexpectedError","isLiveCaptureSupported","navigator","console","error","resizeImageFromBlob","imageBlob","Promise","resolve","imageElement","document","createElement","onload","data","canvasElement","MAX_WIDTH","MAX_HEIGHT","width","height","context","getContext","drawImage","toDataURL","clearRect","URL","revokeObjectURL","src","createObjectURL","DocumentType","DocumentState","FaceDetectionState","SmartCaptureHost$1","constructor","this","createWorker","workerScriptUrl","reject","smartCaptureWorker","createCrossDomainWorker","makeRequest","then","catch","checkImage","image","requestMessage","requestData","requestId","Date","getTime","toString","responseHandler","id","removeEventListener","errorHandler","e","addEventListener","postMessage","workerUrl","worker","testSameOrigin","Worker","type","onerror","event","preventDefault","createWorkerFallback","_","blob","Blob","blobBuilder","window","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","blobUrl","webkitURL","e1","log","url","loc","location","a","href","hostname","port","protocol","SmartCaptureModule","_initialized","_initializing","barcodeReaderId","hiddenCanvas","init","async","__WORKER_PATH__","SmartCaptureHost","_b","Error","addBarcodeReaderDiv","getElementById","barcodeReaderDiv","style","display","body","appendChild","processEncodedFrame","img","result","quality","coords","corners","coordinateCheck","mapCorners","undefined","dimensions","isGood","isAdequateDpi","resolutionCheck","isSharp","blurCheck","isGlareFree","glareCheck","failedChecks","imageDataToBlob","imageData","w","h","hiddenContext","putImageData","toBlob","detect","imgData","asBlob","buffer","arrayBuffer","croppedImg","crop","imgBlob","captureData","_c","Image","top","Math","min","topLeft","y","topRight","bot","max","bottomLeft","bottomRight","left","x","right","getImageData","addImageProcess","isInitialized","isInitializing","_SmartCaptureModule_instance","value","getInstance","__classPrivateFieldGet","_a","__classPrivateFieldSet","workerGlobalContext","onError","onMessage","onPerformQualityCheck","close","onInitialize","smartCapture","stickman_module","checkQuality","response","resolveCheck","name","succesfulChecks","checkPassed","includes","checkFailed","smResult","analyse_encoded_image","document_bounds","failed_checks","is_good","successful_checks","JSON","parse","self","FaceCameraEventDispatcher","parent","dispatchInitialized","CustomEvent","InitializeEventName","bubbles","composed","deprecatedEvent","DetectorInitializeEventName","dispatchEvent","warn","dispatchBeforeOpened","BeforeOpenEventName","dispatchOpened","OpenEventName","dispatchDetected","detectionErrors","DetectEventName","detail","errors","dispatchBeforeCaptured","BeforeCaptureEventName","dispatchCapture","imageBase64","encryptedFile","dispatchError","CaptureEventName","dispatchClosed","CloseEventName","FailureEventName","dispatchRetake","RetakeEventName","dispatchPreview","PreviewEventName","LiveFaceCamera","LitElement","liveCameraRef","createRef","eventDispatcher","lastDetectionState","isFlashing","environment","isOpen","hints","detectionState","FaceNotFound","isInPreview","detectionText","faceState","NotInitialized","notInitializedHint","_d","faceNotFoundHint","TooManyFaces","_f","_e","tooManyFacesHint","FaceAngleTooLarge","_h","_g","faceAngleTooLargeHint","ProbabilityTooSmall","_k","_j","probabilityTooSmallHint","FaceTooSmall","_m","_l","faceTooSmallHint","FaceCloseToBorder","_p","_o","faceCloseToBorderHint","isMobileDevice","test","userAgent","connectedCallback","super","loadLibrary","library","import","disconnectedCallback","updated","changedProperties","has","Event","_onInitialized","stopPropagation","_onBeforeOpened","_onOpened","oval","shadowRoot","querySelector","initializer","sidepanel","liveface","hint","classList","remove","add","openCamera","_onDetection","errorStates","setTimeout","_onBeforeCaptured","_onCaptured","capturedModal","photo","split","_onClosed","_onFailure","_onPreview","_onRetake","_closeCamera","closeCamera","liveCamera","html","ref","render","styles","css","__decorate","property","String","prototype","Boolean","Object","state","customElement"],"mappings":"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"}