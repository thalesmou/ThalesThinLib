{"version":3,"file":"index.es.js","sources":["../../../src/face/error/FaceCameraError.ts","../../../src/helper/MetaDataHelper.ts","../../../src/helper/index.ts","../../../src/image/resizer.ts","../../../src/image/DetectResponse.ts","../../../src/image/smart-capture/SmartCaptureHost.ts","../../../src/face/components/live-face-camera.ts","../../../src/image/SmartCaptureModule.ts","../../../src/image/smart-capture/SmartCaptureWorker.ts","../../../src/face/components/FaceCameraEventDispatcher.ts","../../../src/document/error/DocumentCameraError.ts","../../../src/document/WebRtcCamera.ts","../../../src/document/components/cameraStyles.ts","../../../src/document/components/canvasUtils.ts","../../../src/document/components/icons.ts","../../../src/document/components/DocumentCameraEventDispatcher.ts","../../../src/document/components/live-document-camera.ts","../../../src/auth/utils.ts"],"sourcesContent":["export type FaceCameraError = {\n  code: number;\n  message: string;\n};\n\nexport const PermissionNotGrantedError = (\n  message: string\n): FaceCameraError => ({ code: 1, message });\n\nexport const UnexpectedError = (message: string): FaceCameraError => ({\n  code: 2,\n  message: `Unexpected error: ${message}`,\n});\n","/* eslint no-param-reassign: 0 */\n// @ts-ignore\nimport * as piexif from 'piexifjs';\n\nexport type SDKMetadata = {\n  make?: string;\n  model?: string;\n  software?: string;\n  imageDescription?: string;\n  dateTimeOriginal?: string;\n  userComment?: string;\n};\n\nexport function addMetadata(imgBase64: string, metadata?: SDKMetadata) {\n  // if (!isInitialized) { //todo if still needed\n  //   unexpectedError('SDK was not initialized');\n  //   return;\n  // }\n  if (!metadata) {\n    metadata = {};\n  }\n  if (!metadata.make) {\n    metadata.make = navigator.platform;\n  }\n  if (!metadata.model) {\n    metadata.model = navigator.userAgent;\n  }\n  if (!metadata.software) {\n    metadata.software = `Smart Capture Web SDK ${__SDK_VERSION__}`;\n  }\n  if (!metadata.dateTimeOriginal) {\n    metadata.dateTimeOriginal = new Date().toUTCString();\n  }\n  if (!metadata.userComment) {\n    metadata.userComment = '='.repeat(100); // currently unused\n  }\n\n  // @ts-ignore\n  const zeroth = {};\n  // @ts-ignore\n  const exif = {};\n  // @ts-ignore\n  zeroth[piexif.ImageIFD.Make] = metadata.make;\n  // @ts-ignore\n  zeroth[piexif.ImageIFD.Model] = metadata.model;\n  // @ts-ignore\n  zeroth[piexif.ImageIFD.Software] = metadata.software;\n  if (metadata.imageDescription) {\n    // @ts-ignore\n    zeroth[piexif.ImageIFD.ImageDescription] = metadata.imageDescription;\n  }\n  // @ts-ignore\n  exif[piexif.ExifIFD.DateTimeOriginal] = metadata.dateTimeOriginal;\n  // @ts-ignore\n  exif[piexif.ExifIFD.UserComment] = metadata.userComment;\n\n  const exifObj = { '0th': zeroth, Exif: exif };\n  // @ts-ignore\n  const exifStr = piexif.dump(exifObj);\n  // @ts-ignore\n  return piexif.insert(exifStr, imgBase64);\n}\n\n// import piexif, { IExifElement, TagValues } from 'piexif-ts';\n\n// export type SDKMetadata = {\n//     make?: string,\n//     model?: string,\n//     software: string,\n//     imageDescription?: string,\n//     dateTimeOriginal?: string,\n//     userComment?: string\n// }\n\n// export function addMetadata(imgBase64: string, metadata: SDKMetadata) {\n//     // if (!isInitialized) { //todo if still needed\n//     //   unexpectedError('SDK was not initialized');\n//     //   return;\n//     // }\n//     let zeroth: IExifElement = {};\n//     let exif: IExifElement = {};\n//     zeroth[TagValues.ImageIFD.Make] = metadata.make;\n//     zeroth[TagValues.ImageIFD.Model] = metadata.model;\n//     zeroth[TagValues.ImageIFD.Software] = metadata.software;\n//     if (metadata.imageDescription) {\n//       zeroth[TagValues.ImageIFD.ImageDescription] = metadata.imageDescription;\n//     }\n//     exif[TagValues.ExifIFD.DateTimeOriginal] = metadata.dateTimeOriginal;\n//     exif[TagValues.ExifIFD.UserComment] = metadata.userComment;\n\n//     let exifObj = { '0th': zeroth, 'Exif': exif };\n//     let exifStr = piexif.dump(exifObj);\n//     return piexif.insert(exifStr, imgBase64);\n//   }\n","export { addMetadata, SDKMetadata } from './MetaDataHelper';\n\nexport const isIpadIOS13OrAbove = () =>\n  navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;\n\nexport const isIOS = (): boolean =>\n  /iPad|iPhone|iPod/.test(navigator.platform) || isIpadIOS13OrAbove();\n\nexport const iOSversion = (): number[] => {\n  if (/iP(hone|od|ad)/.test(navigator.platform)) {\n    // supports iOS 2.0 and later: <http://bit.ly/TJjs1V>\n    try {\n      const v = navigator.appVersion.match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n      if (v === null) {\n        return [-1];\n      }\n      return [\n        parseInt(v[1], 10),\n        parseInt(v[2], 10),\n        parseInt(v[3] || '0', 10),\n      ];\n    } catch (_) {\n      return [-1];\n    }\n  }\n  return [-1];\n};\n\nexport const isiOS144Plus = (): boolean => {\n  const ver = iOSversion();\n  return ver && ver.length >= 2 && ver[0] === 14 && ver[1] >= 4;\n};\n\nexport const isiOS15 = (): boolean => {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] === 15;\n};\n\nexport function isiOS163OrLess() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] === 16 && ver[1] < 4;\n}\n\nexport function isiOS164Plus() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] >= 16 && ver[1] >= 4;\n}\n\nexport function isiOS17() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] >= 17;\n}\n\nexport const isDeviceAffectedByIOS16Issue = (): boolean => {\n  const decodedCookie = decodeURIComponent(document.cookie);\n  if (decodedCookie.includes('ForceRegularCapture=true')) {\n    return false;\n  }\n  if (decodedCookie.includes('ForceDistantCapture=true')) {\n    return true;\n  }\n  if (isiOS163OrLess()) {\n\n    const dims = [screen.width, screen.height];\n    const long = Math.max(...dims);\n    const short = Math.min(...dims);\n    if (long === 852 && short === 393) {\n      // 14 pro\n      return true;\n    }\n    if (long === 932 && short === 430) {\n      // 14 pro max\n      return true;\n    }\n    if (long === 844 && short === 390) {\n      // 13 pro\n      return true;\n    }\n    if (long === 926 && short === 428) {\n      // 13 pro max\n      return true;\n    }\n  }\n  return false;\n};\n\nexport const isFirefox = (): boolean =>\n  navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const isSamsungNote10OrS10OrNewer = async () => {\n  const navData: any = navigator;\n  let deviceModel: any = '';\n\n  if (navData.userAgentData?.getHighEntropyValues) {\n    const dm = await navData.userAgentData.getHighEntropyValues(['model']);\n    if (typeof dm === 'string') {\n      deviceModel = dm;\n    } else if (typeof dm.model === 'string') {\n      deviceModel = dm.model;\n    }\n  } else {\n    deviceModel = navigator.userAgent;\n  }\n\n  const matchedModelNumber = deviceModel.match(/SM-[N|G|S]\\d{3}/);\n  if (!matchedModelNumber) {\n    return false;\n  }\n\n  const modelNumber = parseInt(matchedModelNumber[0].match(/\\d{3}/)[0], 10);\n  const smallerModelNumber = deviceModel.match(/SM-S\\d{3}/) ? 900 : 970; // S10e\n  return !Number.isNaN(modelNumber) && modelNumber >= smallerModelNumber;\n};\n\nexport const isChromeForIOS = () => {\n  const { userAgent } = window.navigator;\n  const isWebkit = userAgent.indexOf('WebKit') > -1;\n  const isChrome = userAgent.indexOf('CriOS') > -1;\n  return isWebkit && isChrome && isIOS();\n};\n\nexport const isLiveCaptureSupported = (): boolean =>{\n  if('mediaDevices' in navigator){\n    return true\n  }\n  console.error(\"Camera not available\");\n  return false\n}\n\nexport const isBackCameraLabel = (cameraLabel: string): boolean => {\n  const backCameraKeywords = [\n    'rear',\n    'back',\n    'rück',\n    'arrière',\n    'trasera',\n    'trás',\n    'traseira',\n    'posteriore',\n    '后面',\n    '後面',\n    '背面',\n    'задней',\n    'الخلفية',\n    '후',\n    'arka',\n    'achterzijde',\n    'หลัง',\n    'baksidan',\n    'bagside',\n    'sau',\n    'bak',\n    'tylny',\n    'takakamera',\n    'belakang',\n    'אחורית',\n    'πίσω',\n    'spate',\n    'hátsó',\n    'zadní',\n    'darrere',\n    'zadná',\n    'задня',\n    'stražnja',\n    'belakang',\n    'बैक',\n  ];\n  return backCameraKeywords.some(keyword => cameraLabel.includes(keyword));\n};\n\nexport const arrayBufferToBase64 = (buffer: ArrayBuffer): string => {\n  let binary = '';\n  const bytes = new Uint8Array(buffer);\n  const len = bytes.byteLength;\n  for (let i = 0; i < len; i += 1) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return window.btoa(binary);\n};\nexport const deviceOS = (): string => (isIOS() ? 'iOS' : 'Android');\n\nexport const sdkName = 'Docs & Bio Mobile Web SDK 1.0';\n","const onload: (imageElement: HTMLImageElement) => string = (\n  imageElement: HTMLImageElement\n) => {\n  const canvasElement = document.createElement('canvas');\n  let MAX_WIDTH = 1080;\n  let MAX_HEIGHT = 720;\n  const { width, height } = imageElement;\n  const context = canvasElement.getContext('2d');\n\n  const smallerDimension = width > height ? height : width;\n\n  if (smallerDimension > MAX_HEIGHT) {\n    if (width < height) {\n      const aspectRatio = height / width;\n      MAX_WIDTH = MAX_HEIGHT;\n      MAX_HEIGHT = MAX_WIDTH * aspectRatio;\n    } else {\n      const aspectRatio = width / height;\n      MAX_WIDTH = MAX_HEIGHT * aspectRatio;\n    }\n  } else {\n    MAX_WIDTH = imageElement.width;\n    MAX_HEIGHT = imageElement.height;\n  }\n\n  canvasElement.width = MAX_WIDTH;\n  canvasElement.height = MAX_HEIGHT;\n\n  context?.drawImage(imageElement, 0, 0, MAX_WIDTH, MAX_HEIGHT);\n  const data = canvasElement.toDataURL('image/jpeg', 0.8);\n  context?.clearRect(0, 0, MAX_WIDTH, MAX_HEIGHT);\n  return data;\n};\n\nexport const resizeImageFromBlob = (imageBlob: Blob): Promise<string> =>\n  new Promise(resolve => {\n    const imageElement = document.createElement('img');\n\n    imageElement.onload = () => {\n      const data = onload(imageElement);\n      URL.revokeObjectURL(imageElement.src);\n      resolve(data);\n    };\n    imageElement.src = URL.createObjectURL(imageBlob);\n  });\n\nexport const resizeImageFromString = (imageSrc: string): Promise<string> =>\n  new Promise(resolve => {\n    const imageElement = document.createElement('img');\n\n    imageElement.onload = () => {\n      const data = onload(imageElement);\n      resolve(data.split('base64,')[1]);\n    };\n    imageElement.src = imageSrc;\n  });\n","export enum DocumentType {\n  ID1,\n  ID2,\n  ID3,\n  OTHER,\n  NONE,\n}\n\nexport enum DocumentState {\n  SMALL_DOCUMENT,\n  OUT_OF_FRAME_DOCUMENT,\n  GOOD_DOCUMENT,\n}\n\nexport type Dimension = {\n  width: number;\n  height: number;\n};\n\nexport type Corner = {\n  x: number;\n  y: number;\n};\n\nexport type MappedCorners = {\n  topLeft: Corner;\n  topRight: Corner;\n  bottomLeft: Corner;\n  bottomRight: Corner;\n};\n\nexport type DetectResponse = {\n  isGood: boolean;\n  image?: ImageData;\n  state?: DocumentState;\n  dimensions?: Dimension;\n  isAdequateDpi?: boolean;\n  isSharp?: boolean;\n  isGlareFree?: boolean;\n  quality?: Object;\n  coords?: Object;\n  corners?: MappedCorners;\n  failedChecks: String[];\n};\n","/* eslint no-promise-executor-return: 0 */\nimport { SmartCaptureWorkerMessages } from './enums/SmartCaptureWorkerMessages';\nimport { IImageResult } from './interfaces/IImage';\nimport { IWorkerMessageEvent } from './interfaces/IMessage';\n\nexport class SmartCaptureHost {\n  private smartCaptureWorker?: Worker;\n\n  public createWorker = (workerScriptUrl: string): Promise<void> =>\n    new Promise((resolve, reject) => {\n      if (this.smartCaptureWorker) {\n        return this.makeRequest(SmartCaptureWorkerMessages.Initialize, null)\n          .then(resolve)\n          .catch(reject);\n      }\n      this.smartCaptureWorker = this.createCrossDomainWorker(workerScriptUrl);\n      return this.makeRequest(SmartCaptureWorkerMessages.Initialize, null)\n        .then(resolve)\n        .catch(reject);\n    });\n\n  private createCrossDomainWorker(workerUrl: string): Worker | undefined {\n    let worker;\n    try {\n      if (this.testSameOrigin(workerUrl)) {\n        worker = new Worker(workerUrl, { type: 'module' });\n        worker.onerror = event => {\n          event.preventDefault();\n          worker = this.createWorkerFallback(workerUrl);\n        };\n      } else {\n        worker = this.createWorkerFallback(workerUrl);\n      }\n    } catch (_) {\n      worker = this.createWorkerFallback(workerUrl);\n    }\n    return worker;\n  }\n\n  private createWorkerFallback(workerUrl: string): Worker | undefined {\n    let worker;\n    try {\n      let blob;\n      try {\n        // TODO: This does not work as expected. We cannot use importScripts with module\n        blob = new Blob([`importScripts('${workerUrl}');`], { type: 'module' });\n      } catch (_) {\n        const blobBuilder = new ((window && (window as any).BlobBuilder) ||\n          (window && (window as any).WebKitBlobBuilder) ||\n          (window && (window as any).MozBlobBuilder))();\n        blobBuilder.append(`importScripts('${workerUrl}');`);\n        blob = blobBuilder.getBlob('module');\n      }\n\n      const url =\n        (window && (window as any).URL) ||\n        (window && (window as any).webkitURL);\n      const blobUrl = url.createObjectURL(blob);\n      return new Worker(blobUrl);\n    } catch (e1) {\n      console.log('WorkerFallback', e1);\n    }\n    return worker;\n  }\n\n  public checkImage = (image: any): Promise<IImageResult> =>\n    this.makeRequest(SmartCaptureWorkerMessages.PerformQualityCheck, { image });\n\n  private makeRequest = <InputType = any, OutputType = any>(\n    requestMessage: SmartCaptureWorkerMessages,\n    requestData: InputType,\n    requestId: string = new Date().getTime().toString()\n  ): Promise<OutputType> =>\n    new Promise((resolve, reject) => {\n      if (this.smartCaptureWorker) {\n        const responseHandler = ({ data }: IWorkerMessageEvent<OutputType>) => {\n          if (data.id === requestId) {\n            this.smartCaptureWorker!.removeEventListener(\n              'message',\n              responseHandler\n            );\n            this.smartCaptureWorker!.removeEventListener('error', errorHandler);\n\n            switch (data.message) {\n              case SmartCaptureWorkerMessages.Error:\n                return reject();\n              default:\n                return resolve(data.data);\n            }\n          }\n          return reject();\n        };\n\n        const errorHandler = (e: any) => {\n          this.smartCaptureWorker!.removeEventListener(\n            'message',\n            responseHandler\n          );\n          this.smartCaptureWorker!.removeEventListener('error', errorHandler);\n          return reject(e);\n        };\n\n        this.smartCaptureWorker.addEventListener('message', responseHandler);\n        this.smartCaptureWorker.addEventListener('error', errorHandler);\n\n        this.smartCaptureWorker!.postMessage({\n          id: requestId,\n          message: requestMessage,\n          data: requestData,\n        });\n      } else {\n        reject();\n      }\n    });\n\n  private testSameOrigin(url: string) {\n    const loc = window.location;\n    const a = document.createElement('a');\n    a.href = url;\n    return (\n      a.hostname === loc.hostname &&\n      a.port === loc.port &&\n      a.protocol === loc.protocol\n    );\n  }\n}\n\n// TODO: Ideally this string wants to come from webpack...\nexport default new SmartCaptureHost();\n","import { html, css, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ref, createRef, Ref } from 'lit/directives/ref.js';\nimport { FaceDetectionHint } from './FaceDetectionHint.js';\nimport {\n  PermissionNotGrantedError,\n  UnexpectedError,\n} from '../error/index';\nimport { /* addMetadata, */ isLiveCaptureSupported } from '../../helper/index';\nimport { resizeImageFromBlob } from '../../image/index';\nimport { FaceCameraEventDispatcher } from './FaceCameraEventDispatcher';\nexport enum FaceDetectionState {\n  NotInitialized = 'NOT_INITIALIZED',\n  FaceNotFound = 'FACE_NOT_FOUND',\n  TooManyFaces = 'TOO_MANY_FACES',\n  FaceAngleTooLarge = 'FACE_ANGLE_TOO_LARGE',\n  ProbabilityTooSmall = 'PROBABILITY_TOO_SMALL',\n  FaceTooSmall = 'FACE_TOO_SMALL',\n  FaceCloseToBorder = 'FACE_CLOSE_TO_BORDER',\n}\n\nfunction loadIDRND(environment: string) {\n  if (environment === 'development') {\n    return import('idlive-face-capture-web-development');\n  }\n  return import('idlive-face-capture-web');\n}\n\n@customElement('live-face-camera')\nexport class LiveFaceCamera extends LitElement {\n  public static readonly InitializeEventName = FaceCameraEventDispatcher.InitializeEventName;\n  public static readonly BeforeOpenEventName = FaceCameraEventDispatcher.BeforeOpenEventName;\n  public static readonly OpenEventName = FaceCameraEventDispatcher.OpenEventName;\n  public static readonly DetectEventName = FaceCameraEventDispatcher.DetectEventName;\n  public static readonly BeforeCaptureEventName = FaceCameraEventDispatcher.BeforeCaptureEventName;\n  public static readonly CaptureEventName = FaceCameraEventDispatcher.CaptureEventName;\n  public static readonly CloseEventName = FaceCameraEventDispatcher.CloseEventName;\n  public static readonly FailureEventName = FaceCameraEventDispatcher.FailureEventName;\n\n  /**\n   * @deprecated Use 'InitializeEventName' instead. This will be removed in a feature release.\n   */\n  public static readonly DetectorInitializeEventName =\n    FaceCameraEventDispatcher.DetectorInitializeEventName;\n\n  /**\n   * @deprecated Use 'DetectEventName' instead. This will be removed in a feature release.\n   */\n  public static readonly PreviewEventName = FaceCameraEventDispatcher.PreviewEventName;\n\n  /**\n   * @deprecated RetakeEventName will be removed in a future release and will have no replacement.\n   */\n  public static readonly RetakeEventName = FaceCameraEventDispatcher.RetakeEventName;\n\n  private readonly liveCameraRef: Ref<HTMLElement> = createRef();\n\n  private readonly eventDispatcher: FaceCameraEventDispatcher =\n    new FaceCameraEventDispatcher(this);\n\n  private lastDetectionState: FaceDetectionState | null = null;\n  private isFlashing: boolean = false;\n\n  @property({ type: String})\n  environment: 'development' | 'production' = 'production';\n\n  @property({ type: Boolean })\n  isOpen: boolean = false;\n\n  @property({ type: Object })\n  hints: FaceDetectionHint | undefined = undefined;\n\n  @state()\n  detectionState: FaceDetectionState = FaceDetectionState.FaceNotFound;\n\n  @state()\n  isInPreview: boolean = false;\n\n  detectionText: (faceState: FaceDetectionState) => string = (\n    faceState: FaceDetectionState,\n  ) => {\n    switch (faceState) {\n      case FaceDetectionState.NotInitialized:\n        return this.hints?.notInitializedHint ?? 'Tap to capture';\n      case FaceDetectionState.FaceNotFound:\n        return this.hints?.faceNotFoundHint ?? 'Face not found';\n      case FaceDetectionState.TooManyFaces:\n        return this.hints?.tooManyFacesHint ?? 'Too many faces';\n      case FaceDetectionState.FaceAngleTooLarge:\n        return this.hints?.faceAngleTooLargeHint ?? 'Face not straight on';\n      case FaceDetectionState.ProbabilityTooSmall:\n        return this.hints?.probabilityTooSmallHint ?? 'Probability too small';\n      case FaceDetectionState.FaceTooSmall:\n        return this.hints?.faceTooSmallHint ?? 'Face too far';\n      case FaceDetectionState.FaceCloseToBorder:\n        return this.hints?.faceCloseToBorderHint ?? 'Face too close';\n      default:\n        return '';\n    }\n  };\n\n  static readonly styles = css`\n\n    :host {\n          display: flex;\n\n      width: 100%;\n      height: 100%;\n    }\n      .warningIcon{\n      width: 1.5vw;\n      height: 1.5vw;\n    }\n  .hint, .initializer {\n  white-space: nowrap;\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n  font-family: 'Inter';\n  color: rgb(255, 255, 255);\n  text-align: center;\n  font-weight: normal;\n}\n\n.hint {\n  bottom: -10vh; /* Adjust this value as needed */\n  font-size: 1.5vw;\n}\n  .hint.done {\n  display: none;\n}\n\n.initializer {\n  top: -10vh; /* Adjust this value as needed */\n  font-size: 1.5vw;\n}\n      .hint2 {\n      justify-content: center;\n      align-items: center;\n\n      z-index: 101;\n      font-family: 'Inter';\n\n      font-size: 2vw;\n\n      color: rgb(255, 255, 255);\n      bottom: 5vh;\n      text-align: center;\n      font-weight: normal;\n    }\n\n    .oval {\n      z-index: 100;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      position: absolute;\n      width: 50vh;\n      height: 70%;\n      border: 1.1vw solid white;\n      border-radius: 70vw;\n      background: transparent;\n      box-shadow: 0 0 0 9999px rgba(0, 0, 10, 0.6);\n      transition: .5s;\n    }\n     .capturedModal{\n\n      font-size: 1.5vw;\n      display:none;\n      text-align: center;\n      justify-content: center;\n      align-items: center;\n      color:white;\n      z-index: 100;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      position: absolute;\n      width: 20vw;\n      height: 4vw;\n      border-radius: 8px;\n      background: rgba(0,0,10,0.6);\n      transition: 1s;\n      }\n      .capturedModal.done {\n      display: flex;\n\n    }\n    /* Adjust for portrait mode */\n    @media (orientation: portrait) {\n      .oval {\n        width: 70vw;\n        height: 100vw;\n        border-radius: 140vw;\n      }\n      .hint {\n        font-size: 100%;\n        bottom: -8vh;\n          font-size: 2vh;\n\n      }\n      .initializer {\n        top: -8vh; /* Adjust this value as needed */\n\n      font-size: 2vh;\n      white-space: nowrap;\n      }\n      .warningIcon{\n        width:6vw;\n        height: 6vw;\n\n      }\n      .capturedModal{\n        width: 40vw;\n        height: 8vw;\n        font-size: 3vw;\n      }\n      .capturedModal svg{\n        width: 3vw;\n        height: 3vw;\n      }\n    }\n    svg {\n      vertical-align: middle;\n      margin-bottom: .5vw;\n    }\n    .liveface{\n      height:100%;\n      width:100%;\n      position:absolute;\n      top:0\n    }\n\n    .oval.error {\n      transition: 1s;\n      border-color: orange;\n    }\n    .sidepanel{\n      z-index: 103;\n      display: none;\n      position: absolute;\n      background: rgba(0,0,10,1);\n      height: 100%;\n      width: 40%;\n      right: 0%;\n    }\n    .oval.done {\n      border-color: rgb(144, 238, 144);\n    }\n\n    @media (orientation: landscape) {\n      .oval.mobile {\n      left: 23%;\n      height: 80%;\n\n      transform: translate(-20%, -50%);    }\n      .sidepanel.mobile{\n        display: flex;\n        top: 0;\n        text-align: center;\n        justify-content: center;\n        align-items: center;\n      }\n      .liveface.mobile{\n        width:80%;\n        transform: translate(-25%, 0);\n\n      }\n      .hint.mobile{\n       display: none;\n      }\n      .initializer.mobile{\n        display: none;\n      }\n    }\n    .capturedModal svg {\n      margin-right: 8px;\n    }\n    .backButton{\n    position:absolute;\n    z-index:101;\n    top:4vh;\n\n    left:5vw;\n    }\n  `;\n  private isMobileDevice(): boolean {\n    return /Android|iPhone|iPad/i.test(navigator.userAgent);\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n    this.loadLibrary().then(() => console.log('Library loaded successfully.')).catch((error) => console.error('Error loading library', error));\n  }\n\n  private async loadLibrary() {\n    try {\n      const library = await loadIDRND(this.environment);\n      console.log(`${this.environment} library loaded`, library);\n    } catch (error) {\n      console.log(`Failed to load the ${this.environment} library`, error);\n    }\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    if (!changedProperties.has('isOpen')) {\n      return;\n    }\n    if (isLiveCaptureSupported()) {\n      if (this.isOpen) {\n        this.liveCameraRef.value?.dispatchEvent(new Event('open'));\n      } else {\n        this.liveCameraRef.value?.dispatchEvent(new Event('close'));\n      }\n    } else if (this.isOpen) { /* empty */ }\n  }\n\n  private _onInitialized(e: CustomEvent) {\n    e.stopPropagation();\n    console.log(\"Initialized\")\n    this.eventDispatcher.dispatchInitialized();\n  }\n\n  private _onBeforeOpened(e: CustomEvent) {\n    e.stopPropagation();\n    this.eventDispatcher.dispatchBeforeOpened();\n  }\n\n  private _onOpened(e: CustomEvent) {\n    const oval = this.shadowRoot?.querySelector('.oval');\n    const initializer = this.shadowRoot?.querySelector('.initializer');\n    const sidepanel = this.shadowRoot?.querySelector('.sidepanel');\n    const liveface = this.shadowRoot?.querySelector('.liveface');\n    const hint = this.shadowRoot?.querySelector('.hint');\n\n    oval?.classList.remove('error')\n    sidepanel?.classList.remove('mobile');\n      liveface?.classList.remove('mobile');\n      oval?.classList.remove('mobile');\n\n    if (this.isMobileDevice()) {\n      console.log(\"Detected mobile device\" )\n\n      sidepanel?.classList.add('mobile');\n      liveface?.classList.add('mobile');\n      oval?.classList.add('mobile');\n      hint?.classList.add('mobile');\n      initializer?.classList.add('mobile');\n\n    }else{\n\n      console.log(\"Detected desktop device\")\n      // if(initializer)\n      //   initializer.innerHTML ='Desktop';\n\n    }\n    e.stopPropagation();\n    (this.liveCameraRef.value as any).openCamera();\n    this.eventDispatcher.dispatchOpened();\n  }\n\n  private _onDetection(e: CustomEvent) {\n    e.stopPropagation();\n    const { errors } = e.detail[0]\n    const detectionText =errors[0];\n    if (detectionText !== undefined) {\n      this.detectionState = detectionText as FaceDetectionState;\n    }\n\n    // Update the border color based on the detection state\n    const oval = this.shadowRoot?.querySelector('.oval');\n    const errorStates = [\n      FaceDetectionState.NotInitialized,\n      FaceDetectionState.FaceNotFound,\n      FaceDetectionState.TooManyFaces,\n      FaceDetectionState.FaceAngleTooLarge,\n      FaceDetectionState.ProbabilityTooSmall,\n      FaceDetectionState.FaceTooSmall,\n      FaceDetectionState.FaceCloseToBorder\n    ];\n\n    if (this.detectionState !== this.lastDetectionState) {\n      if (errorStates.includes(this.detectionState)) {\n        if (!this.isFlashing) {\n          this.isFlashing = true;\n          oval?.classList.add('error');\n          setTimeout(() => {\n            //oval?.classList.remove('error');\n            this.isFlashing = false;\n          }, 300); // 0.3-second delay\n        }\n      }\n      this.lastDetectionState = this.detectionState;\n    }\n    this.eventDispatcher.dispatchDetected(errors);\n  }\n\n  private _onBeforeCaptured(e: CustomEvent) {\n    e.stopPropagation();\n    this.eventDispatcher.dispatchBeforeCaptured();\n  }\n\n  private _onCaptured(e: CustomEvent) {\n    const oval = this.shadowRoot?.querySelector('.oval');\n    const capturedModal = this.shadowRoot?.querySelector('.capturedModal');\n    const hint = this.shadowRoot?.querySelector('.hint');\n\n\n\n    oval?.classList.remove('error');\n    oval?.classList.add('done');\n    hint?.classList.add('done');\n    capturedModal?.classList.add('done');\n\n    setTimeout(() => {\n      e.stopPropagation();\n      this.isInPreview = false;\n      this.isOpen = false;\n\n      const imageBlob: Blob = e.detail[0].photo;\n      resizeImageFromBlob(imageBlob).then(imageBase64 => {\n        this.eventDispatcher.dispatchCapture(\n          imageBase64.split('base64,')[1],\n          e.detail[0].encryptedFile,\n        );\n      });\n      oval?.classList.remove('done');\n      capturedModal?.classList.remove('done');\n      hint?.classList.remove('done');\n\n\n    }, 1000); // 0.3-second delay\n\n  }\n\n  private _onClosed(e: CustomEvent) {\n    e.stopPropagation();\n    this.isOpen = false;\n    this.eventDispatcher.dispatchClosed();\n  }\n\n  private _onFailure(e: CustomEvent) {\n    e.stopPropagation();\n    this.isOpen = false;\n    if (e.type === 'error') {\n      this.eventDispatcher.dispatchError(\n        PermissionNotGrantedError(e.detail.error),\n      );\n    } else {\n      this.eventDispatcher.dispatchError(UnexpectedError(e.detail.error));\n    }\n  }\n\n  private _onPreview(e: CustomEvent) {\n    e.stopPropagation();\n    this.isInPreview = true;\n    this.eventDispatcher.dispatchPreview();\n  }\n\n  private _onRetake(e: CustomEvent) {\n    e.stopPropagation();\n    this.isInPreview = false;\n    this.eventDispatcher.dispatchRetake();\n  }\n\n  private _closeCamera(e: Event) {\n    e.stopPropagation();\n    (this.liveCameraRef.value as any).closeCamera();\n\n    this.isInPreview = false;\n    this.isOpen = false;\n  }\n\n  liveCamera() {\n    return html`\n      <div class=\"backButton\" @click=${this._closeCamera} style=\"cursor: pointer;\">\n      <svg width=\"2rem\" height=\"2rem\"  viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M15 18L9 12L15 6\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n      </svg>\n    </div>\n\n      <div class=\"sidepanel\"><div\n        id=\"face-camera-detection-text\"\n        class=\"hint2\"\n        ?hidden=${!this.isOpen || this.isInPreview}\n      >\n        <svg  width=\"3vw\" height=\"3vw\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12 1C12.3788 1 12.725 1.214 12.8944 1.55279L22.8944 21.5528C23.0494 21.8628 23.0329 22.2309 22.8507 22.5257C22.6684 22.8205 22.3466 23 22 23H2C1.65342 23 1.33156 22.8205 1.14935 22.5257C0.967144 22.2309 0.95058 21.8628 1.10557 21.5528L11.1056 1.55279C11.275 1.214 11.6212 1 12 1ZM20.382 21L12 4.23607L3.61804 21H20.382ZM12 9C12.5523 9 13 9.44771 13 10V14C13 14.5523 12.5523 15 12 15C11.4477 15 11 14.5523 11 14V10C11 9.44771 11.4477 9 12 9ZM12 19C12.5523 19 13 18.5523 13 18C13 17.4477 12.5523 17 12 17C11.4477 17 11 17.4477 11 18C11 18.5523 11.4477 19 12 19Z\" fill=\"#F88618\"/>\n        </svg>\n${this.detectionText(this.detectionState)}\n      </div></div>\n\n      <div class=\"oval\">\n        <div class=\"initializer\" >Place your face within the oval</div>\n\n        <div\n\n        id=\"face-camera-detection-text\"\n        class=\"hint\"\n        ?hidden=${!this.isOpen || this.isInPreview}\n      >\n        <svg class=\"warningIcon\"  viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12 1C12.3788 1 12.725 1.214 12.8944 1.55279L22.8944 21.5528C23.0494 21.8628 23.0329 22.2309 22.8507 22.5257C22.6684 22.8205 22.3466 23 22 23H2C1.65342 23 1.33156 22.8205 1.14935 22.5257C0.967144 22.2309 0.95058 21.8628 1.10557 21.5528L11.1056 1.55279C11.275 1.214 11.6212 1 12 1ZM20.382 21L12 4.23607L3.61804 21H20.382ZM12 9C12.5523 9 13 9.44771 13 10V14C13 14.5523 12.5523 15 12 15C11.4477 15 11 14.5523 11 14V10C11 9.44771 11.4477 9 12 9ZM12 19C12.5523 19 13 18.5523 13 18C13 17.4477 12.5523 17 12 17C11.4477 17 11 17.4477 11 18C11 18.5523 11.4477 19 12 19Z\" fill=\"#F88618\"/>\n        </svg>\n  ${this.detectionText(this.detectionState)}\n        </div>\n      </div>\n\n      <div class=\"capturedModal\">\n        <svg width=\"1.5vw\" height=\"1.5vw\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <g clip-path=\"url(#clip0_6455_142)\">\n            <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.5 12C2.5 6.47715 6.97715 2 12.5 2C18.0228 2 22.5 6.47715 22.5 12C22.5 17.5228 18.0228 22 12.5 22C6.97715 22 2.5 17.5228 2.5 12ZM12.5 0C5.87258 0 0.5 5.37258 0.5 12C0.5 18.6274 5.87258 24 12.5 24C19.1274 24 24.5 18.6274 24.5 12C24.5 5.37258 19.1274 0 12.5 0ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L9.20711 12.2929C8.81658 11.9024 8.18342 11.9024 7.79289 12.2929C7.40237 12.6834 7.40237 13.3166 7.79289 13.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z\" fill=\"#78D278\"/>\n          </g>\n          <defs>\n            <clipPath id=\"clip0_6455_142\">\n              <rect width=\"80\" height=\"80\" fill=\"white\" transform=\"translate(0.5)\"/>\n            </clipPath>\n          </defs>\n        </svg>\n        Photo captured\n      </div>\n\n      <div class=\"liveface\">\n        <idlive-face-capture\n        mask_hidden\n        ${ref(this.liveCameraRef)}\n        @initialize=${this._onInitialized}\n        @beforeOpen=${this._onBeforeOpened}\n        @open=${this._onOpened}\n        @detection=${this._onDetection}\n        @beforeCapture=${this._onBeforeCaptured}\n        @capture=${this._onCaptured}\n        @close=${this._onClosed}\n        @error=${this._onFailure}\n\n        @makePhoto=${this._onPreview}\n        @retakePhoto=${this._onRetake}\n      >\n      </idlive-face-capture>\n      </div>\n    `;\n  }\n\n\n  render() {\n    return isLiveCaptureSupported() ? this.liveCamera() : html``;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'live-face-camera': LiveFaceCamera;\n  }\n}\n","/* eslint no-promise-executor-return: 0 */\n/* eslint prefer-promise-reject-errors: 0 */\n/* eslint consistent-return: 0 */\nimport SmartCaptureHost from './smart-capture/SmartCaptureHost';\nimport { DetectResponse, MappedCorners } from './DetectResponse';\nimport { ISmartCaptureModule } from './interfaces/ISmartCaptureModule';\nimport { CaptureResponse } from '../document/CaptureResponse';\n\nexport class SmartCaptureModule implements ISmartCaptureModule {\n\n  static #instance: SmartCaptureModule | undefined;\n\n  private constructor() {\n    this.addBarcodeReaderDiv(this.barcodeReaderId);\n  }\n\n\n  static getInstance: () => SmartCaptureModule = () => {\n    if (!SmartCaptureModule.#instance) {\n      SmartCaptureModule.#instance = new SmartCaptureModule();\n    }\n    return SmartCaptureModule.#instance;\n  };\n\n  private _initialized = false;\n  get isInitialized() {\n    return this._initialized;\n  }\n  private _initializing = false;\n  get isInitializing() {\n    return this._initializing;\n  }\n\n  private barcodeReaderId: string = 'barcode-reader';\n\n  private hiddenCanvas: HTMLCanvasElement = document.createElement('canvas');\n\n  init: () => Promise<boolean> = async () => {\n    if (this._initialized) {\n      return true;\n    }\n    if (!this._initializing) {\n      this._initializing = true;\n      const workerScriptUrl = new URL(__WORKER_PATH__, import.meta.url).href;\n      try {\n        await SmartCaptureHost.createWorker(workerScriptUrl);\n        this._initializing = false;\n        this._initialized = true;\n        return true;\n      } catch {\n        this._initializing = false;\n        this._initialized = false;\n        throw new Error('Create Worker Failed');\n      }\n    } else {\n      return false;\n    }\n  };\n\n  private addBarcodeReaderDiv: (barcodeReaderId: string) => void = (\n    barcodeReaderId: string\n  ) => {\n    if (document.getElementById(barcodeReaderId)) {\n      return;\n    }\n    const barcodeReaderDiv = document.createElement('div');\n    barcodeReaderDiv.id = barcodeReaderId;\n    barcodeReaderDiv.style.display = 'none';\n    document.body.appendChild(barcodeReaderDiv);\n  };\n\n  private processEncodedFrame: (img: ArrayBuffer) => Promise<DetectResponse> =\n    async (img: ArrayBuffer) => {\n      const result = await SmartCaptureHost.checkImage(img);\n      if (result && result.quality && result.coords) {\n        const corners = result.quality.coordinateCheck\n          ? this.mapCorners(result.coords)\n          : undefined;\n        const dimensions = {\n          width: result.coords.width,\n          height: result.coords.height,\n        };\n        // let type = DocumentType.ID1; //todo how can we detect this now\n        const response: DetectResponse = {\n          isGood: result.isGood,\n          // type: type,\n          dimensions,\n          isAdequateDpi: result.quality.resolutionCheck,\n          // isCorrectAspectRatio: this.isCorrectAspectRatio(dimensions, type),\n          corners,\n          isSharp: result.quality.blurCheck,\n          isGlareFree: result.quality.glareCheck,\n          failedChecks: result.failedChecks,\n        };\n        return response;\n      }\n      throw new Error('Part of result was null');\n    };\n\n  // private isCorrectAspectRatio(dimens: Dimension, cardType: DocumentType) {\n  //   let aspectRatio = dimens.width/dimens.height;\n  //   let isCorrectAspectRatio = false;\n  //   let tolerancePercentage = 5.0;\n  //   let expectedPassportAspectRatio = 1.42;\n  //   let expectedID1AspectRatio = 1.58870;\n  //   let expectedID2AspectRatio  = 1.41915551;\n  //   if (cardType == DocumentType.ID3) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedPassportAspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedPassportAspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   } else if (cardType == DocumentType.ID1) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedID1AspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedID1AspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   } else if (cardType == DocumentType.ID2) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedID2AspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedID2AspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   }\n  //   return isCorrectAspectRatio;\n  // }\n\n  private mapCorners(coords: {\n    height: number;\n    width: number;\n    x: number;\n    y: number;\n  }): MappedCorners {\n    return {\n      topLeft: {\n        x: coords.x,\n        y: coords.y,\n      },\n      topRight: {\n        x: coords.x + coords.width,\n        y: coords.y,\n      },\n      bottomRight: {\n        x: coords.x + coords.width,\n        y: coords.y + coords.height,\n      },\n      bottomLeft: {\n        x: coords.x,\n        y: coords.y + coords.height,\n      },\n    };\n  }\n\n  private imageDataToBlob: (imageData: ImageData) => Promise<Blob> = async (\n    imageData: ImageData\n  ) => {\n    const w = imageData.width;\n    const h = imageData.height;\n    const { hiddenCanvas } = this;\n    const hiddenContext = this.hiddenCanvas.getContext('2d');\n\n    if (!hiddenContext) {\n      throw new Error('Hidden Context Missing');\n    }\n    hiddenCanvas.width = w;\n    hiddenCanvas.height = h;\n    hiddenContext.putImageData(imageData, 0, 0);\n    const blob: Blob | null = await new Promise(resolve =>\n      hiddenCanvas.toBlob(resolve)\n    );\n    if (blob) return blob;\n    throw new Error('Canvas To Blob Errored');\n  };\n\n  detect: (imgData: CaptureResponse) => Promise<DetectResponse> = async (\n    imgData: CaptureResponse\n  ) => {\n    if (imgData.imageData) {\n      const asBlob = await this.imageDataToBlob(imgData.imageData);\n      const buffer = await asBlob.arrayBuffer();\n      const result = await this.processEncodedFrame(buffer);\n      if (result.isGood) {\n        const croppedImg = await this.crop(buffer, result);\n        result.image = croppedImg;\n        return result;\n      }\n      return result;\n    }\n    throw new Error('Image Data Was Null');\n  };\n\n  crop: (\n    imgBlob: ArrayBuffer,\n    captureData: DetectResponse\n  ) => Promise<ImageData> = async (\n    imgBlob: ArrayBuffer,\n    captureData: DetectResponse\n  ) => {\n    if (!imgBlob || !captureData.corners) {\n      throw new Error('Image or Corners Missing');\n    }\n\n    const { hiddenCanvas } = this;\n    const hiddenContext = this.hiddenCanvas.getContext('2d');\n\n    if (!hiddenContext) {\n      throw new Error('Hidden Context Missing');\n    }\n\n    if (captureData.dimensions?.width && captureData.dimensions?.height) {\n      const blob = new Blob([imgBlob], { type: 'image/jpeg' });\n      const img = new Image();\n\n      const addImageProcess = (src: string) =>\n        new Promise<ImageData>((resolve, reject) => {\n\n          img.onload = function () {\n            if (captureData.corners) {\n              const top = Math.min(\n                captureData.corners.topLeft.y,\n                captureData.corners.topRight.y\n              );\n              const bot = Math.max(\n                captureData.corners.bottomLeft.y,\n                captureData.corners.bottomRight.y\n              );\n              const left = Math.min(\n                captureData.corners.topLeft.x,\n                captureData.corners.bottomLeft.x\n              );\n              const right = Math.max(\n                captureData.corners.topRight.x,\n                captureData.corners.bottomRight.x\n              );\n\n              hiddenCanvas.height = bot - top;\n              hiddenCanvas.width = right - left;\n              hiddenContext.drawImage(\n                img,\n                left,\n                top,\n                right - left,\n                bot - top,\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              const data = hiddenContext.getImageData(\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              hiddenContext.clearRect(\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              hiddenCanvas.height = 1;\n              hiddenCanvas.width = 1;\n\n              resolve(data);\n            }\n          };\n          img.onerror = reject;\n          img.src = src;\n        });\n\n      return addImageProcess(URL.createObjectURL(blob));\n    }\n    throw new Error('Width or Height Missing');\n  };\n}\n","/* eslint camelcase: 0 */\n/* eslint no-promise-executor-return: 0 */\nimport stickman_module from '@gbgplc/stickman-wasm';\nimport { SmartCaptureWorkerMessages } from './enums/SmartCaptureWorkerMessages';\nimport { IWorkerMessageEvent, IWorkerMessage } from './interfaces/IMessage';\n\nexport class SmartCaptureWorker {\n  private smartCapture?: any;\n  private workerGlobalContext: any;\n\n  constructor(workerGlobalContext: any) {\n    this.workerGlobalContext = workerGlobalContext;\n\n    this.workerGlobalContext.addEventListener('message', this.onMessage);\n    this.workerGlobalContext.addEventListener('error', this.onError);\n  }\n\n  private postMessage = (\n    id: string,\n    message: SmartCaptureWorkerMessages,\n    data?: any\n  ): Promise<void> =>\n    new Promise(resolve =>\n      resolve(\n        this.workerGlobalContext.postMessage({\n          id,\n          message,\n          data,\n        } as IWorkerMessage)\n      )\n    );\n\n  private onError = (e: Error) =>\n    this.postMessage('', SmartCaptureWorkerMessages.Error, { ...e });\n\n\n  private onMessage = ({ data }: IWorkerMessageEvent) => {\n    switch (data.message) {\n      case SmartCaptureWorkerMessages.PerformQualityCheck:\n        return this.onPerformQualityCheck(data.id, data.data);\n      case SmartCaptureWorkerMessages.Terminate:\n        return this.postMessage(\n          data.id,\n          SmartCaptureWorkerMessages.Terminate\n        ).then(() => this.workerGlobalContext.close());\n      case SmartCaptureWorkerMessages.Initialize:\n        return this.onInitialize()\n          .then(() =>\n            this.postMessage(data.id, SmartCaptureWorkerMessages.ReadyToProcess)\n          )\n          .catch(() =>\n            this.postMessage(data.id, SmartCaptureWorkerMessages.Error)\n          );\n      default:\n    }\n  };\n\n  private onInitialize = () =>\n    new Promise(resolve => {\n      if (this.smartCapture) {\n        return resolve(this.smartCapture);\n      }\n      return stickman_module().then((smartCapture: any) => {\n        this.smartCapture = smartCapture;\n\n        return resolve(smartCapture);\n      });\n    });\n\n  private onPerformQualityCheck = (id: string, { image }: { image: any }) => {\n    this.checkQuality(image)\n      .then(response =>\n        this.postMessage(id, SmartCaptureWorkerMessages.CheckComplete, response)\n      )\n      .catch((e: any) =>\n        this.postMessage(id, SmartCaptureWorkerMessages.CheckFailed, e.message)\n      );\n  };\n\n  private resolveCheck = (\n    name: string,\n    succesfulChecks: any,\n    failedChecks: any\n  ) => {\n    const checkPassed = succesfulChecks.includes(name);\n    const checkFailed = failedChecks.includes(name);\n    if (!checkPassed && !checkFailed) {\n      return null;\n    }\n    return checkPassed;\n  };\n\n  private checkQuality = (image: any) => {\n    const smResult = this.smartCapture.analyse_encoded_image(image);\n    const { document_bounds, failed_checks, is_good, successful_checks } =\n      JSON.parse(smResult);\n    const result = Promise.resolve({\n      isGood: is_good,\n      quality: {\n        blurCheck: this.resolveCheck(\n          'BlurCheck',\n          successful_checks,\n          failed_checks\n        ),\n        glareCheck: this.resolveCheck(\n          'GlareCheck',\n          successful_checks,\n          failed_checks\n        ),\n        resolutionCheck: this.resolveCheck(\n          'LowResolutionCheck',\n          successful_checks,\n          failed_checks\n        ),\n        coordinateCheck: this.resolveCheck(\n          'FullDocumentInViewCheck',\n          successful_checks,\n          failed_checks\n        ),\n      },\n      failedChecks: failed_checks,\n      coords: document_bounds,\n    });\n\n    return result;\n  };\n}\n\nexport default new SmartCaptureWorker(self);\n","import { FaceCameraError, UnexpectedError } from '../error/index';\n\nexport class FaceCameraEventDispatcher {\n\n  public static InitializeEventName = 'initialize';\n  public static BeforeOpenEventName = 'beforeOpen';\n  public static OpenEventName = 'open';\n  public static DetectEventName = 'detect';\n  public static BeforeCaptureEventName = 'beforeCapture';\n  public static CaptureEventName = 'capture';\n  public static CloseEventName = 'close';\n  public static FailureEventName = 'failure';\n\n  /**\n   * @deprecated Use 'InitializeEventName' instead. This will be removed in a feature release.\n   */\n  public static DetectorInitializeEventName = 'initialize';\n\n  /**\n   * @deprecated Use 'DetectEventName' instead. This will be removed in a feature release.\n   */\n  public static PreviewEventName = 'preview';\n\n  /**\n   * @deprecated RetakeEventName will be removed in a future release and will have no replacement.\n   */\n  public static RetakeEventName = 'retake';\n\n  private parent: HTMLElement;\n\n  constructor(parent: HTMLElement) {\n    this.parent = parent;\n  }\n\n  public dispatchInitialized() {\n    const event = new CustomEvent(\n      FaceCameraEventDispatcher.InitializeEventName,\n      {\n        bubbles: true,\n        composed: true,\n      }\n    );\n    const deprecatedEvent = new CustomEvent(\n      FaceCameraEventDispatcher.DetectorInitializeEventName,\n      {\n        bubbles: true,\n        composed: true,\n      }\n    );\n    this.parent.dispatchEvent(event);\n\n    console.warn(\"DetectorInitializeEventName is deprecated.  Use 'InitializeEventName' instead.\");\n    this.parent.dispatchEvent(deprecatedEvent);\n  }\n\n  public dispatchBeforeOpened() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.BeforeOpenEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchOpened() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.OpenEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchDetected(detectionErrors: string[]) {\n    const event = new CustomEvent(FaceCameraEventDispatcher.DetectEventName, {\n      bubbles: true,\n      composed: true,\n      detail: { errors: detectionErrors },\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchBeforeCaptured() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.BeforeCaptureEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchCapture(imageBase64: string, encryptedFile: Blob | null) {\n    if (!imageBase64) {\n      this.dispatchError(\n        UnexpectedError('Capture called with missing result image')\n      );\n    }\n    const event = new CustomEvent(FaceCameraEventDispatcher.CaptureEventName, {\n      bubbles: true,\n      composed: true,\n      detail: {\n        imageBase64,\n        encryptedFile,\n      },\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchClosed() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.CloseEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n\n  public dispatchError(error: FaceCameraError) {\n    const event = new CustomEvent(FaceCameraEventDispatcher.FailureEventName, {\n      bubbles: true,\n      composed: true,\n      detail: {\n        error,\n      },\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  /**\n   * @deprecated This will be removed in a future release and has no replacement.\n   */\n  public dispatchRetake() {\n    const event = new CustomEvent(FaceCameraEventDispatcher.RetakeEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    console.warn(\"RetakeEventName is deprecated and will be removed in a future release\");\n    this.parent.dispatchEvent(event);\n  }\n\n  /**\n   * @deprecated Use dispatchDetected instead. This will be removed in a  future release.\n   */\n  public dispatchPreview() {\n    const deprecatedEvent = new CustomEvent(FaceCameraEventDispatcher.PreviewEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    console.warn(\"PreviewEventName is deprecated.  Use 'DetectEventName' instead.\");\n    this.parent.dispatchEvent(deprecatedEvent);\n  }\n}\n","export const SEQUENCE_BREAK_CODE = 'sequence-break';\nexport const START_FAIL_CODE = 'start-fail';\nexport const RUNTIME_ERROR_CODE = 'runtime-error';\nexport const HEIC_NOT_SUPPORTED_CODE = 'heic-not-supported';\n\nexport const SEQUENCE_BREAK_TEXT_IOS_15 =\n  'Camera capture failed due to unexpected sequence break. This usually indicates the camera closed or froze unexpectedly. In iOS 15+ this is intermittently occurs due to a GPU Highwater failure. Swap to manual capture until the user fully reloads the browser. Attempting to continue to use live capture can lead to further Highwater errors and can cause to OS to cut off the webpage.';\nexport const SEQUENCE_BREAK_TEXT_OTHER =\n  'Camera capture failed due to unexpected sequence break. This usually indicates the camera closed or froze unexpectedly. Swap to manual capture until the user fully reloads the browser.';\nexport const HEIC_NOT_SUPPORTED_TEXT =\n  'HEIC image processing failed. Please use the version that supports HEIC files if HEIC is expected.';\n\nexport type DocCameraError = {\n  code: string;\n  message: string;\n};\n\nexport const SequenceBreak = (isIOS: boolean = true): DocCameraError => ({\n  code: SEQUENCE_BREAK_CODE,\n  message: isIOS ? SEQUENCE_BREAK_TEXT_IOS_15 : SEQUENCE_BREAK_TEXT_OTHER,\n});\n\nexport const StartFail = (message: string): DocCameraError => ({\n  code: START_FAIL_CODE,\n  message,\n});\n\nexport const RuntimeError = (message: string): DocCameraError => ({\n  code: RUNTIME_ERROR_CODE,\n  message,\n});\n\nexport const HeicNotSupported = (message?: string): DocCameraError => {\n  if (message) {\n    return { code: HEIC_NOT_SUPPORTED_CODE, message };\n  }\n  return { code: HEIC_NOT_SUPPORTED_CODE, message: HEIC_NOT_SUPPORTED_TEXT };\n};\n","import { RuntimeError, SequenceBreak, StartFail } from './error/index';\nimport {\n  isIOS,\n  isBackCameraLabel,\n  isSamsungNote10OrS10OrNewer,\n  isiOS15,\n  isiOS17,\n  isIpadIOS13OrAbove,\n  isDeviceAffectedByIOS16Issue,\n  isiOS164Plus,\n} from '../helper/index';\nimport { ILiveDocumentCamera } from './LiveDocumentCameraInterface';\nimport { DetectResponse } from '../image/index';\nimport { ISmartCaptureModule } from '../image/interfaces/ISmartCaptureModule';\nimport { CaptureResponse } from './CaptureResponse';\nimport { DetectedFrame } from './DetectedFrame';\n\nexport const MAX_VIDEO_WIDTH_IOS_15 = 1920;\n\nexport enum CameraState {\n  MoveCloser,\n  OutOfFrame,\n  FixGlare,\n  FixBlur,\n  Countdown,\n  Capturing,\n  TapToCapture,\n}\n\n// TODO: organize methods into categories like in the camera component after all methods are set up.\nexport class WebRtcCamera {\n  private hiddenCanvas: HTMLCanvasElement = document.createElement('canvas');\n\n  // willReadFrequently is only enabled on Android since it's not implemented on iOS\n  private hiddenContext: CanvasRenderingContext2D | null =\n    this.hiddenCanvas.getContext('2d', { willReadFrequently: !isIOS() });\n\n  private isStarted: boolean = false;\n  private isDetecting: boolean = false;\n  private detectTimeout?: ReturnType<typeof setTimeout>;\n  private isCapturing = false;\n  private parent: ILiveDocumentCamera;\n  private smartCaptureModule: ISmartCaptureModule;\n  private player?: HTMLVideoElement;\n  private lastFrameDetected: DetectedFrame = {\n    imgData: undefined,\n    detectResponse: undefined,\n  };\n\n  private restartDetectionBind =\n    this.restartDetectionAfterBrowserResume.bind(this);\n  private visibilityChangeBind = this.onVisibilityChange.bind(this);\n  private metaDataBind = this.onLoadedMetaData.bind(this);\n  runDetectionBind = this.runDetection.bind(this);\n\n  constructor(\n    parent: ILiveDocumentCamera,\n    smartCaptureModule: ISmartCaptureModule\n  ) {\n    this.parent = parent;\n    this.smartCaptureModule = smartCaptureModule;\n    this.initSmartCapture();\n  }\n\n  private initSmartCapture() {\n    if (\n      !this.smartCaptureModule.isInitialized &&\n      !this.smartCaptureModule.isInitializing\n    ) {\n      this.smartCaptureModule.init().catch(() => {\n        this.parent.onError(\n          RuntimeError('Smart Capture Module failed to init.')\n        );\n      });\n    }\n  }\n\n  private videoConstraints: MediaTrackConstraints = {\n    facingMode: { ideal: 'environment' },\n    // 1.3333 aspect ratio and lower ideal height seems to result in better focus and higher dpi on ios devices.\n    // I believe this is because the true ratio of the camera is 4:3 so this ratio means people do not need to get as close\n    // to the id to get good dpi. Cameras might struggle to focus at very close angles.\n    aspectRatio: 4 / 3,\n    // This might help performance, especially on low end devices. Might be less important after apple fixes the ios 15 bug,\n    // but right now we want to do as little redraws as possible to avoid GPU load.\n    // 20221110 update removing this as this did not seem to be relevant and might be negatively affecting firefox\n    // frameRate: { min: 10, ideal: 15, max: 15 }\n  };\n\n  private cameraConstraints: MediaStreamConstraints = {\n    video: this.videoConstraints,\n  };\n\n  private async finalizeCameraConstraints() {\n    if (isIOS()) {\n      if (isDeviceAffectedByIOS16Issue()) {\n        // Need to bump resolution since we will be capturing from further away\n        // Also change aspect ratio to make it seem like the id is closer from user's pov.\n        this.videoConstraints.aspectRatio =\n          (Math.max(window.innerWidth, window.innerHeight) * 1.0) /\n          Math.min(window.innerWidth, window.innerHeight);\n        this.videoConstraints.height = { min: 1440, ideal: 2880 };\n      } else if (isiOS15()) {\n        this.videoConstraints.width = {\n          min: MAX_VIDEO_WIDTH_IOS_15,\n          ideal: MAX_VIDEO_WIDTH_IOS_15,\n        };\n      } else {\n        this.videoConstraints.height = { min: 1440, ideal: 1440 };\n        if (isiOS17()) {\n          this.videoConstraints.zoom = 1.6;\n        }\n      }\n    } else {\n      this.videoConstraints.height = { min: 720, ideal: 1440 };\n      if (await isSamsungNote10OrS10OrNewer()) {\n        // We found out that some triple camera Samsung devices (S10, S20, Note 20, etc) capture images blurry at edges.\n        // Zooming to 2X, matching the telephoto lens, doesn't solve it completely but mitigates it.\n        this.videoConstraints.zoom = 2.0;\n      }\n    }\n  }\n  async startCamera() {\n    this.player = this.parent.getPlayer();\n    if (!this.player) {\n      this.parent.onError(StartFail('Required internal element was null'));\n      return;\n    }\n\n    if (!this.isStarted) {\n      await this.finalizeCameraConstraints();\n      await this.startCameraInternal();\n    }\n  }\n\n  /**\n   * Attempts to get the best back facing camera and then start it.\n   *\n   * getDevice will not always return accurate data until after get user media has been called once. So the first time this is called it starts the camera fitting the constraints, but after starting that camera it checks with get devices if there is a better camera fitting our constraints. If there is it will add its ID to the constraints can perform this function again, this time not checking with get devices.\n   *\n   * @param iteration the current attempt number to search for the proper camera device.\n   */\n  private async startCameraInternal(iteration = 0) {\n    const maxIterations = 2;\n    const video = this.cameraConstraints.video as MediaTrackConstraints;\n    // Realistically this would never be set on the first call and always set on the second one, however\n    // it makes sense to check it just in case the implementor is overriding our ID selection and specifying their own.\n    const getDeviceWasAbleToReadLabels = Boolean(video.deviceId);\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia(\n        this.cameraConstraints\n      );\n      if (!getDeviceWasAbleToReadLabels && iteration < maxIterations) {\n        // Check if there is a better camera to use once we have permissions\n        const device = await this.getDevice();\n        if (\n          device &&\n          device.deviceId !== stream.getVideoTracks()[0].getSettings().deviceId\n        ) {\n          this.videoConstraints.deviceId = device.deviceId;\n          this.stopMediaTracks(stream);\n          await this.startCameraInternal(iteration + 1);\n        } else {\n          await this.enableCamera(stream);\n        }\n      } else {\n        await this.enableCamera(stream);\n      }\n    } catch (error) {\n      const userMediaError = error as DOMException;\n      this.parent.onError(StartFail(userMediaError.message));\n    }\n  }\n\n  private async enableCamera(stream: MediaStream) {\n    this.isStarted = true;\n    if (this.player) this.player.srcObject = stream;\n    await this.addEvents();\n    this.parent.onCameraEnabled();\n  }\n\n  stopDetection() {\n    clearTimeout(this.detectTimeout);\n  }\n\n  endCamera() {\n    this.isStarted = false;\n    this.isDetecting = false;\n    if (this.detectTimeout) {\n      this.stopDetection();\n      this.detectTimeout = undefined;\n    }\n\n    this.isCapturing = false;\n\n    this.removeEvents();\n\n    if (this.player) {\n      this.player.pause();\n      const srcStream = this.player.srcObject as MediaStream;\n      if (srcStream) {\n        this.stopMediaTracks(srcStream);\n      }\n    }\n\n    // This is just in case the camera is reused somehow on a different device.\n    this.videoConstraints.deviceId = undefined;\n  }\n\n  private async addEvents() {\n    if (this.player) {\n      this.player.addEventListener('play', this.restartDetectionBind);\n      this.player.addEventListener('loadedmetadata', this.metaDataBind);\n    }\n    if (await isSamsungNote10OrS10OrNewer()) {\n      document.addEventListener('visibilitychange', this.visibilityChangeBind);\n    }\n  }\n\n  private async removeEvents() {\n    if (this.player) {\n      this.player.removeEventListener('play', this.restartDetectionBind);\n      this.player.removeEventListener('loadedmetadata', this.metaDataBind);\n    }\n    if (await isSamsungNote10OrS10OrNewer()) {\n      document.removeEventListener(\n        'visibilitychange',\n        this.visibilityChangeBind\n      );\n    }\n  }\n\n  // Once this function is called once it will start a detect loop.\n  private runDetection() {\n    if (!this.player || this.player.paused) {\n      this.detectTimeout = setTimeout(this.runDetectionBind, 100);\n      return;\n    }\n\n    this.processFrameForDetection();\n    this.detectTimeout = setTimeout(this.runDetectionBind, 100); // detecting at most 10 times a second, short circuits out very quickly if detect is running\n  }\n\n  // Sets up constraints to target the best camera. I think this is what the original implementer went off of:\n  // https://old.reddit.com/r/javascript/comments/8eg8w5/choosing_cameras_in_javascript_with_the/\n  // could be prone to error\n  private async getDevice(): Promise<MediaDeviceInfo | null> {\n    let devices;\n    try {\n      devices = await navigator.mediaDevices.enumerateDevices();\n    } catch {\n      return null;\n    }\n    let minSuffix: number;\n    let selectedDevice = null;\n    const dualWideCamera = devices.find(\n      d => d.label === 'Back Dual Wide Camera'\n    );\n    if (isiOS164Plus() && dualWideCamera) {\n      selectedDevice = dualWideCamera;\n    } else {\n      devices\n        .filter(device => device.kind === 'videoinput')\n        .forEach(device => {\n          if (!isBackCameraLabel(device.label)) {\n            return;\n          }\n          const split = device.label.split(',');\n          const cameraSuffixNumber = parseInt(\n            split[0][split[0].length - 1],\n            10\n          );\n          if (cameraSuffixNumber || cameraSuffixNumber === 0) {\n            if (minSuffix === undefined || minSuffix > cameraSuffixNumber) {\n              minSuffix = cameraSuffixNumber;\n              selectedDevice = device;\n            }\n          }\n        });\n    }\n    return selectedDevice;\n  }\n\n  // This is in a callback because we need the video to already be playing with the correct resolution\n  private onLoadedMetaData() {\n    if (\n      !this.player ||\n      this.player.videoWidth + this.player.videoHeight < 1000\n    ) {\n      this.endCamera();\n      this.parent.onError(StartFail('insufficient camera stream dimens'));\n    } else {\n      this.runDetectionBind();\n    }\n  }\n\n  // We need to restart the camera when navigator is sent to background at devices where the zoom constraint is applied,\n  // otherwise, zoom value is override when resuming capture\n  private async onVisibilityChange() {\n    if (!this.isStarted) {\n      return;\n    }\n\n    if (document.visibilityState === 'visible') {\n      this.endCamera();\n      await this.startCamera();\n    }\n  }\n\n  // We need this to re-create the detect timeout after browser is sent to background/resumed since the timer is throttled by the OS\n  private restartDetectionAfterBrowserResume() {\n    if (!this.detectTimeout) {\n      return;\n    }\n\n    this.stopDetection();\n    this.isDetecting = false;\n    this.runDetectionBind();\n  }\n\n  private stopMediaTracks(stream: MediaStream | undefined) {\n    if (stream) {\n      stream.getTracks().forEach(track => {\n        track.stop();\n      });\n    }\n  }\n\n  private sequenceBreak() {\n    this.parent.onError(SequenceBreak(isiOS15() || isIpadIOS13OrAbove()));\n  }\n\n  private processFrameForDetection() {\n    if (!this.isStarted || this.isDetecting || this.isCapturing) {\n      return;\n    }\n    if (!this.player || this.player.videoWidth === 0) {\n      this.sequenceBreak();\n      return;\n    }\n    if (!this.hiddenContext) {\n      this.parent.onError(RuntimeError('Required internal element was null'));\n      return;\n    }\n    this.isDetecting = true;\n\n    let newCanvasHeight = 0;\n    let newCanvasWidth = 0;\n\n    newCanvasWidth = this.player.videoWidth;\n    newCanvasHeight = this.player.videoHeight;\n\n    if (\n      newCanvasWidth !== this.hiddenCanvas.width ||\n      newCanvasHeight !== this.hiddenCanvas.height\n    ) {\n      this.hiddenCanvas.width = newCanvasWidth;\n      this.hiddenCanvas.height = newCanvasHeight;\n    }\n\n    if (this.isStarted) {\n      let imgData;\n      try {\n        this.hiddenContext.drawImage(\n          this.player,\n          0,\n          0,\n          this.player.videoWidth,\n          this.player.videoHeight,\n          0,\n          0,\n          this.hiddenCanvas.width,\n          this.hiddenCanvas.height\n        ); // This scales down to target size\n        imgData = this.hiddenContext.getImageData(\n          0,\n          0,\n          this.hiddenCanvas.width,\n          this.hiddenCanvas.height\n        );\n        this.hiddenContext.clearRect(\n          0,\n          0,\n          this.hiddenCanvas.width,\n          this.hiddenCanvas.height\n        );\n      } catch (_) {\n        this.sequenceBreak();\n        return;\n      }\n\n      this.detect({ imageData: imgData });\n    }\n  }\n\n  private async detect(imgData: CaptureResponse) {\n    if (!this.smartCaptureModule.isInitialized) {\n      this.initSmartCapture();\n      this.isDetecting = false;\n    } else {\n      try {\n        const detectResponse = await this.smartCaptureModule.detect(imgData);\n        this.lastFrameDetected.detectResponse = detectResponse;\n        this.lastFrameDetected.imgData = imgData.imageData;\n        this.handleLiveCapture(detectResponse);\n      } catch {\n        this.parent.onError(RuntimeError('Detect Errored Unexpectedly.'));\n      } finally {\n        this.isDetecting = false;\n      }\n    }\n  }\n\n  private handleLiveCapture(response: DetectResponse | undefined) {\n    if (response) {\n      if (response.isGood) {\n        this.parent.onDetect(response, CameraState.Capturing);\n      } else if (response.failedChecks.includes('FullDocumentInViewCheck')) {\n        this.parent.onDetect(response, CameraState.OutOfFrame);\n      } else if (!response.isAdequateDpi) {\n        this.parent.onDetect(response, CameraState.MoveCloser);\n      } else if (!response.isSharp) {\n        this.parent.onDetect(response, CameraState.FixBlur);\n      } else {\n        this.parent.onDetect(response, CameraState.FixGlare);\n      }\n    } else {\n      this.parent.onDetect(undefined, CameraState.OutOfFrame);\n    }\n  }\n\n  async triggerCapture(manualMode: boolean = false) {\n    this.stopDetection();\n\n    const lastFrameImgData = this.lastFrameDetected.imgData;\n    const lastFramedetectResponse = this.lastFrameDetected.detectResponse;\n\n    let imgData;\n    let detectResponse;\n    const isPortraitOrientation = window.matchMedia(\n      '(orientation: portrait)'\n    ).matches;\n\n    if (lastFrameImgData && lastFramedetectResponse && !manualMode) {\n      imgData = lastFrameImgData;\n      detectResponse = lastFramedetectResponse;\n    } else {\n      const { hiddenCanvas, hiddenContext, player } = this;\n\n      if (!hiddenCanvas || !hiddenContext || !player) {\n        this.parent.onError(RuntimeError('Required internal element was null'));\n        return;\n      }\n      try {\n        if (player.videoWidth === 0) {\n          throw new Error('width 0');\n        }\n        hiddenCanvas.width = player.videoWidth;\n        hiddenCanvas.height = player.videoHeight;\n\n        hiddenContext.drawImage(\n          player,\n          0,\n          0,\n          hiddenCanvas.width,\n          hiddenCanvas.height\n        );\n        imgData = hiddenContext.getImageData(\n          0,\n          0,\n          hiddenCanvas.width,\n          hiddenCanvas.height\n        );\n        hiddenContext.clearRect(0, 0, hiddenCanvas.width, hiddenCanvas.height);\n      } catch (_) {\n        this.sequenceBreak();\n        return;\n      }\n\n      detectResponse = await this.smartCaptureModule.detect({\n        imageData: imgData,\n      });\n    }\n\n    this.parent.onCapture({\n      isGood: detectResponse.isGood,\n      isAdequateDpi: detectResponse.isAdequateDpi,\n      isSharp: detectResponse.isSharp,\n      isGlareFree: detectResponse.isGlareFree,\n      failedChecks: detectResponse.failedChecks,\n      imageData: imgData,\n      imageWidth: imgData.width,\n      imageHeight: imgData.height,\n      isPortraitOrientation,\n    });\n  }\n}\n","import { css } from 'lit';\n\nexport const cameraStyles = css`\n  .video {\n    display: block;\n    image-orientation: none;\n    object-fit: contain;\n    width: 100%;\n  }\n  .canvas {\n    display: block;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    object-fit: contain;\n    width: 100%;\n    height: 100%;\n  }\n  .helpIcon {\n    position: absolute;\n    right: 12px;\n    bottom: 12px;\n  }\n  .root {\n    color: white;\n    background-color: #000d1a;\n    flex-grow: 50;\n    min-height: 100%;\n    min-width: 100%;\n    display: flex;\n  }\n  .container {\n    position: relative;\n    display: flex;\n  }\n  .container.landscape {\n    flex-direction: row;\n  }\n  .container.portrait {\n    flex-direction: column;\n  }\n  .feedbackContainer {\n    display: flex;\n    justify-content: space-between;\n    flex-direction: column;\n  }\n  .feedbackContainer.landscape {\n    min-width: 292px;\n    width: 60%;\n  }\n  .cameraPreviewContainer {\n    position: relative;\n    width: 100%;\n  }\n  .cameraPreviewInnerContainer {\n    box-sizing: border-box;\n  }\n  .cameraPreviewInnerContainerError {\n    border-color: #f88618;\n  }\n  .cameraPreviewInnerContainerSuccess {\n    border-color: #48bb78;\n  }\n  .guidanceContainer {\n    display: flex;\n    flex-direction: row;\n    padding: 16px;\n  }\n  .guidanceInnerContainer {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n  }\n  .guidanceInnerContainer.landscape {\n    flex-direction: column;\n  }\n  .guidanceIcon {\n    align-self: center;\n    max-height: 8vh;\n    margin-bottom: 16px;\n  }\n  .guidanceIcon.landscape {\n    align-self: flex-start;\n    height: 16vh;\n  }\n  .guidanceDescriptionContainer {\n    padding-left: 12px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n  }\n  .guidanceTitleContainer {\n    position: absolute;\n    bottom: 1vw;\n    width: 100%;\n    display: flex;\n    text-align: center;\n    flex-direction: row;\n    justify-content: center;\n  }\n  .guidanceTitle {\n    color: #fff;\n    font-size: 2vh;\n    font-weight: 600;\n    line-height: 24px;\n    padding-left: 8px;\n    align-self: center;\n  }\n  @media (max-width: 1400px) {\n    .guidanceTitle {\n      font-size: 1.5vh;\n    }\n  }\n  @media (max-width: 850px) {\n    .guidanceTitleContainer {\n      bottom: 2vw;\n    }\n    .guidanceTitle {\n      font-size: 1.5vh;\n    }\n  }\n\n  .guidanceDescription {\n    padding-top: 0.5vh;\n    align-items: center;\n  }\n  .cameraPreviewTransparentOverlay {\n    position: absolute;\n    left: 0;\n    top: 0;\n    z-index: 3;\n    height: 100%;\n    text-align: center;\n    display: flex;\n    justify-content: center;\n    align-content: center;\n    flex-direction: column;\n    width: 100%;\n    max-height: 70vh;\n    object-fit: contain;\n  }\n  .generalInfoContainer {\n    max-width: 95%;\n    padding: 5px 34px 0;\n    margin-top: 25px;\n    margin-left: auto;\n    margin-right: auto;\n    text-align: center;\n    padding-bottom: 10px;\n    font-size: 16px;\n    font-weight: 600;\n    line-height: 24px;\n    letter-spacing: 0.02em;\n  }\n  .manualActionsContainer {\n    display: flex;\n    flex-direction: row;\n    padding: 0 16px;\n    justify-content: space-between;\n  }\n\n  .action-caption {\n    font-size: 16px;\n    margin: 3px 0 16px 3px;\n    font-weight: 600;\n  }\n  .control {\n    align-items: center;\n    background-color: #fff;\n    border: 1px solid #444b53;\n    border-radius: 3px;\n    display: flex;\n    flex-direction: column;\n    transition: box-shadow 0.2s ease;\n  }\n  .controlSwitch {\n    background-color: transparent;\n    border: 0;\n    margin: 0;\n    padding: 0;\n    position: relative;\n    user-select: none;\n    width: fit-content;\n  }\n  .controlSwitchContainer {\n    background-color: #000;\n    border-radius: 5000px;\n    height: 20px;\n    width: 41px;\n  }\n  .disabledSwitch {\n    border: 2px solid #a1a8ae;\n  }\n  .enabledSwitch {\n    border: 2px solid #fff;\n  }\n  .controlSwitchContainer::after {\n    background-color: #fff;\n    border-radius: 50%;\n    content: '';\n    display: block;\n    height: 18px;\n    transform: translateY(1px) translateX(3px);\n    transition: 250ms ease transform, 250ms ease background-color;\n    width: 18px;\n  }\n  .controlSwitchIcon {\n    left: 2px;\n    position: absolute;\n    top: 2px;\n  }\n  input:checked + .controlSwitchContainer.disabledSwitch {\n    background-color: #a1a8ae;\n  }\n  input:checked + .controlSwitchContainer.enabledSwitch {\n    background-color: #fff;\n  }\n  input:checked + .controlSwitchContainer::after {\n    background-color: #000;\n    transform: translateY(1px) translateX(20px);\n  }\n  .controlSwitch input {\n    height: 2px;\n    opacity: 0;\n    position: absolute;\n    width: 2px;\n  }\n  .cameraCaptureContainer {\n    margin: 0 auto;\n    width: 48px;\n    height: 48px;\n  }\n  .cameraCaptureContainer.landscape {\n    margin: 0;\n  }\n  .cameraCaptureButton:hover {\n    cursor: pointer;\n  }\n\n  loading-spinner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n  }\n\n  .spinner {\n    margin: 0 auto;\n    width: 48px;\n    height: 48px;\n    border-radius: 50%;\n    display: inline-block;\n    position: relative;\n    background: linear-gradient(0deg, rgba(255, 61, 0, 0.2) 33%, #f88618 100%);\n    box-sizing: border-box;\n    animation: rotation 1s linear infinite;\n  }\n\n  .spinner::after {\n    content: '';\n    box-sizing: border-box;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 44px;\n    height: 44px;\n    border-radius: 50%;\n    background: #ffffff;\n    opacity: 0.5;\n  }\n\n  .cancel-button {\n    text-align: center;\n    vertical-align: center;\n    margin: 16px;\n    padding: 16px;\n    border-radius: 4px;\n    border: 1px;\n    border: 1px solid #9d3333;\n    font-size: 16px;\n    font-weight: 500;\n    line-height: 24px;\n    letter-spacing: 0.02em;\n    color: #9d3333;\n  }\n\n  .helpContainer {\n    position: absolute;\n    top: 0;\n    left: 0;\n    background-color: #fff;\n    border: 1px solid rgba(186, 189, 193, 1);\n    z-index: 9;\n    padding: 16px;\n    margin: 0;\n    width: -webkit-fill-available;\n  }\n\n  .closeHelp {\n    display: flex;\n    width: 116px;\n    justify-content: space-between;\n    color: rgb(0, 50, 100);\n    font-size: 16px;\n    font-weight: 500;\n    line-height: 24px;\n    letter-spacing: 0.02em;\n    margin-left: auto;\n  }\n\n  .helpTitle {\n    font-size: 18px;\n    font-weight: 600;\n    line-height: 28px;\n    text-align: left;\n    color: rgba(0, 13, 26, 1);\n    margin-top: 16px;\n  }\n\n  .helpText {\n    font-size: 14px;\n    font-weight: 400;\n    line-height: 20px;\n    letter-spacing: 0.01em;\n    text-align: left;\n    color: rgba(68, 75, 83, 1);\n    margin-top: 16px;\n  }\n\n  .tipsContainer {\n    display: flex;\n    flex-wrap: wrap;\n  }\n\n  .tipContainer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-top: 16px;\n    max-width: 230px;\n  }\n\n  .tipAnimation {\n    height: 84px;\n    width: 84px;\n    background-color: rgb(229, 230, 231);\n    margin-right: 16px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  @keyframes rotation {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n\n  @-webkit-keyframes rotation {\n    0% {\n      -webkit-transform: rotate(0deg);\n    }\n    100% {\n      -webkit-transform: rotate(360deg);\n    }\n  }\n\n  @-webkit-keyframes doc-rotation {\n    0% {\n      -webkit-transform: rotate(0deg);\n    }\n    100% {\n      -webkit-transform: rotate(90deg);\n    }\n  }\n`;\n","function drawCorner(\n  context: CanvasRenderingContext2D,\n  point: any,\n  offsetX: number,\n  offsetY: number,\n  color: string\n) {\n  context.strokeStyle = color;\n  context.lineWidth = 10;\n  context.lineJoin = 'miter';\n\n  context.beginPath();\n\n  const roundedX = point.x;\n  const roundedY = point.y;\n\n  context.moveTo(roundedX + offsetX, roundedY);\n  context.lineTo(roundedX, roundedY);\n  context.lineTo(roundedX, roundedY + offsetY);\n  context.stroke();\n}\n\nfunction drawCorners(\n  context: CanvasRenderingContext2D,\n  point: any,\n  index: number,\n  cornerColor: string\n) {\n  const currentOrientation = window.orientation;\n  const { width } = context.canvas;\n  let offsetX = width * 0.07;\n  let offsetY = width * 0.07;\n\n  if (currentOrientation !== 0) {\n    offsetX = width * 0.07;\n    offsetY = width * 0.07;\n  }\n\n  // Modify offsets for specific corners\n  switch (index.toString()) {\n    case '1': // Top-right corner\n      offsetX = -offsetX; // Flip horizontally\n      break;\n    case '2': // Bottom-right corner\n      offsetX = -offsetX; // Flip horizontally\n      offsetY = -offsetY; // Flip vertically\n      break;\n    case '3': // Bottom-left corner\n      offsetY = -offsetY; // Flip vertically\n      break;\n    default: // Top-left corner\n      break;\n  }\n  drawCorner(context, point, offsetX, offsetY, cornerColor);\n}\n\nexport const drawDocumentRectangle = (\n  context: CanvasRenderingContext2D,\n  cornerColor: string\n): void => {\n  context.fillStyle = 'rgba(0, 0, 0, 0.5)';\n  context.lineWidth = 10;\n\n  const { width, height } = context.canvas;\n  const center = {\n    x: width / 2,\n    y: height / 2\n  };\n\n  let targetWidth;\n  let targetHeight;\n\n  if (width >= height) {\n    targetWidth = 0.85 * width;\n    targetHeight = (0.85 * width) / 1.5887;\n    if (targetHeight > 0.85 * height) {\n      targetWidth = (targetWidth / targetHeight) * 0.85 * height;\n      targetHeight = 0.85 * height;\n    }\n    console.log('Normal, Width:' + width + ' Height:' + height);\n  } else {\n    targetWidth = (0.85 * height) / 1.5;\n    targetHeight = 0.82 * height;\n    if (targetWidth > 0.85 * width) {\n      targetHeight = (targetHeight / targetWidth) * 0.85 * width;\n      targetWidth = 0.85 * width;\n    }\n    console.log('Weird, Width:' + width + ' Height:' + height);\n\n  }\n\n  const offsetX = targetWidth / 2;\n  const offsetY = targetHeight / 2;\n\n  const defaultCorners = [\n    { x: center.x - offsetX, y: center.y - offsetY },\n    { x: center.x + offsetX, y: center.y - offsetY },\n    { x: center.x + offsetX, y: center.y + offsetY },\n    { x: center.x - offsetX, y: center.y + offsetY }\n  ];\n\n  // Draw surrounding masks\n  context.fillRect(0, 0, width, defaultCorners[0].y);\n  context.fillRect(0, defaultCorners[0].y, defaultCorners[0].x, height);\n  context.fillRect(\n    defaultCorners[1].x,\n    defaultCorners[1].y,\n    defaultCorners[0].y,\n    height\n  );\n  context.fillRect(\n    defaultCorners[3].x,\n    defaultCorners[3].y,\n    defaultCorners[1].x - defaultCorners[0].x,\n    defaultCorners[0].y\n  );\n\n  defaultCorners.forEach((point, i) => {\n    drawCorners(context, point, i, cornerColor);\n  });\n};\n\nexport const drawAutoCaptureHint = (\n  context: CanvasRenderingContext2D,\n  hint: Boolean,\n  ShouldShowAlert: Boolean,\n  autoCaptureText: string,\n  alertText: string,\n  autoCaptureOnText: string,\n  autoCaptureOffText: string\n): void => {\n  const { width, height } = context.canvas;\n  let paddingTop = ShouldShowAlert ? height * 0.035 : height * 0.055;\n  if (width > height) {\n    paddingTop = height * 0.055;\n  }\n  context.fillStyle = 'rgba(255, 255, 255)';\n  context.font =\n    'bold 50px \"Haas Grot Text R Web\", \"Helvetica Neue\", Helvetica, Arial, sans-serif';\n  context.textAlign = 'center';\n  context.fillText(\n    `${autoCaptureText}  - ${hint ? autoCaptureOnText : autoCaptureOffText}`,\n    context.canvas.width / 2,\n    paddingTop\n  );\n  if (ShouldShowAlert)\n    context.fillText(\n      alertText,\n      context.canvas.width / 2,\n      paddingTop + 60\n    );\n};\n","import { TemplateResult, html } from 'lit';\n\nexport const warningIcon: TemplateResult = html`\n  <svg\n    width=\"22\"\n    height=\"22\"\n    viewBox=\"0 0 22 22\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Warning icon\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M11 0C11.3788 0 11.725 0.214002 11.8944 0.552786L21.8944 20.5528C22.0494 20.8628 22.0329 21.2309 21.8507 21.5257C21.6684 21.8205 21.3466 22 21 22H1C0.653423 22 0.331557 21.8205 0.14935 21.5257C-0.0328564 21.2309 -0.0494204 20.8628 0.105574 20.5528L10.1056 0.552786C10.275 0.214002 10.6212 0 11 0ZM19.382 20L11 3.23607L2.61804 20H19.382ZM11 8C11.5523 8 12 8.44771 12 9V13C12 13.5523 11.5523 14 11 14C10.4477 14 10 13.5523 10 13V9C10 8.44771 10.4477 8 11 8ZM11 18C11.5523 18 12 17.5523 12 17C12 16.4477 11.5523 16 11 16C10.4477 16 10 16.4477 10 17C10 17.5523 10.4477 18 11 18Z\"\n      fill=\"#F88618\"\n    ></path>\n  </svg>\n`;\n\nexport const capturedIcon: TemplateResult = html`\n  <style>\n    svg.overlay {\n      position: absolute;\n      top: calc(50% - 24px);\n      left: calc(50% - 24px);\n      width: 48px;\n      height: 48px;\n    }\n  </style>\n  <svg\n    class=\"overlay\"\n    width=\"48\"\n    height=\"48\"\n    viewBox=\"0 0 48 48\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Document captured icon\"\n  >\n    <circle cx=\"24\" cy=\"24\" r=\"24\" fill=\"#000D1A\" fill-opacity=\"0.5\" />\n    <circle\n      cx=\"24\"\n      cy=\"24\"\n      r=\"18\"\n      fill=\"white\"\n      stroke=\"#78D278\"\n      stroke-width=\"4\"\n      stroke-linecap=\"round\"\n    />\n    <path\n      d=\"M16.7266 25.8181L20.3629 29.4545L31.272 18.5454\"\n      stroke=\"#78D278\"\n      stroke-width=\"4\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n`;\n\nexport const helpIcon: TemplateResult = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Help\"\n  >\n    <g clip-path=\"url(#clip0_3497_1833)\">\n      <path\n        d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\"\n        stroke=\"white\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n      <path\n        d=\"M9.08997 9.00008C9.32507 8.33175 9.78912 7.76819 10.3999 7.40921C11.0107 7.05024 11.7289 6.91902 12.4271 7.03879C13.1254 7.15857 13.7588 7.52161 14.215 8.06361C14.6713 8.60561 14.921 9.2916 14.92 10.0001C14.92 12.0001 11.92 13.0001 11.92 13.0001\"\n        stroke=\"white\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n      <path\n        d=\"M12 17H12.01\"\n        stroke=\"white\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3497_1833\">\n        <rect width=\"24\" height=\"24\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const cameraIcon: TemplateResult = html`\n  <svg\n    width=\"52\"\n    height=\"52\"\n    viewBox=\"0 0 52 52\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <circle cx=\"26\" cy=\"26\" r=\"25\" stroke=\"white\" stroke-width=\"2\" />\n    <circle cx=\"26\" cy=\"26.0005\" r=\"22\" fill=\"white\" />\n    <path\n      d=\"M37 33C37 33.5304 36.7893 34.0391 36.4142 34.4142C36.0391 34.7893 35.5304 35 35 35H17C16.4696 35 15.9609 34.7893 15.5858 34.4142C15.2107 34.0391 15 33.5304 15 33V22C15 21.4696 15.2107 20.9609 15.5858 20.5858C15.9609 20.2107 16.4696 20 17 20H21L23 17H29L31 20H35C35.5304 20 36.0391 20.2107 36.4142 20.5858C36.7893 20.9609 37 21.4696 37 22V33Z\"\n      stroke=\"black\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n    <path\n      d=\"M26 31C28.2091 31 30 29.2091 30 27C30 24.7909 28.2091 23 26 23C23.7909 23 22 24.7909 22 27C22 29.2091 23.7909 31 26 31Z\"\n      stroke=\"black\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n`;\n\nexport const closeIcon: TemplateResult = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Help\"\n  >\n    <path\n      d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\"\n      stroke=\"#0B4886\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n    <path\n      d=\"M15 9L9 15\"\n      stroke=\"#0B4886\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n    <path\n      d=\"M9 9L15 15\"\n      stroke=\"#0B4886\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n`;\n\nexport const pauseIcon: TemplateResult = html` <svg\n  xmlns=\"http://www.w3.org/2000/svg\"\n  width=\"24\"\n  height=\"24\"\n  viewBox=\"0 0 24 24\"\n>\n  <path d=\"M2 24v-24l20 12-20 12z\" fill=\"white\" />\n</svg>`;\n","import { DetectResponse } from '../../image/index';\nimport { CaptureResponse } from '../CaptureResponse';\nimport { CameraState } from '../WebRtcCamera';\nimport { DocCameraError } from '../error/index';\n\nexport class DocumentCameraEventDispatcher {\n  public static OpenEventName = 'open';\n  public static CloseEventName = 'close';\n  public static CaptureEventName = 'capture';\n  public static DetectEventName = 'detect';\n  public static FailureEventName = 'failure';\n\n  private parent: HTMLElement;\n\n  constructor(parent: HTMLElement) {\n    this.parent = parent;\n  }\n\n  public dispatchError(error: DocCameraError) {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.FailureEventName,\n      {\n        bubbles: true,\n        composed: true,\n        detail: {\n          error,\n        },\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchCapture(captureResponse: CaptureResponse) {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.CaptureEventName,\n      {\n        bubbles: true,\n        composed: true,\n        detail: {\n          captureResponse,\n        },\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchClose() {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.CloseEventName,\n      {\n        bubbles: true,\n        composed: true,\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchOpen() {\n    const event = new CustomEvent(DocumentCameraEventDispatcher.OpenEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchDetect(\n    detectResponse: DetectResponse | undefined,\n    cameraState: CameraState\n  ) {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.DetectEventName,\n      {\n        bubbles: true,\n        composed: true,\n        detail: {\n          detectResponse,\n          cameraState,\n        },\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n}\n","import { html, css, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ref, createRef, Ref } from 'lit/directives/ref.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport '@lottiefiles/lottie-player';\nimport type { LottiePlayer } from '@lottiefiles/lottie-player';\nimport { isLiveCaptureSupported } from '../../helper/index';\nimport { DetectResponse } from '../../image/index';\nimport { CaptureResponse } from '../CaptureResponse';\nimport { DocCameraError, StartFail } from '../error/index';\nimport { ILiveDocumentCamera } from '../LiveDocumentCameraInterface';\nimport { WebRtcCamera, CameraState } from '../WebRtcCamera';\n\nimport { SmartCaptureModule } from '../../image/SmartCaptureModule';\nimport { cameraStyles } from './cameraStyles';\nimport { drawAutoCaptureHint, drawDocumentRectangle } from './canvasUtils';\nimport {\n  warningIcon,\n  capturedIcon,\n  helpIcon,\n  cameraIcon,\n  closeIcon,\n  pauseIcon,\n} from './icons';\nimport { DocumentHint } from './DocumentHint';\nimport lowResolutionAnimation from '../../assets/low-res-white.json';\nimport positionDocumentAnimation from '../../assets/position-document.json';\nimport positionDocumentAnimationPortrait from '../../assets/position-document-portrait.json';\nimport flipDocument from '../../assets/flip-document.json';\nimport flipDocumentPortrait from '../../assets/flip-document-portrait.json';\nimport glareAnimation from '../../assets/glare-white.json';\nimport blurAnimation from '../../assets/blur-white.json';\nimport { ISmartCaptureModule } from '../../image/interfaces/ISmartCaptureModule';\nimport { DocumentDetectionHint } from './DocumentDetectionHint';\nimport { DocumentCameraEventDispatcher } from './DocumentCameraEventDispatcher';\n\n\n@customElement('live-document-camera')\nexport class LiveDocumentCamera\n  extends LitElement\n  implements ILiveDocumentCamera\n{\n  private tabbableElements: HTMLElement[] = [];\n  setFocusToElement(elementId: string): void {\n    const element = this.shadowRoot?.getElementById(elementId) as HTMLElement;\n\n    if (element) {\n      if (!element.hasAttribute('tabindex')) {\n        element.setAttribute('tabindex', '0');\n      }\n      element.focus();\n      console.log('focused');\n    } else {\n      console.warn(`Element with ID ${elementId} not found`);\n    }\n  }\n  private enableTabbingOnOtherElements(): void {\n    this.tabbableElements = Array.from(\n      this.shadowRoot?.querySelectorAll('[tabindex]') || []\n    );\n    this.tabbableElements.forEach(element => {\n      if (element.id !== 'helpSection') {\n        element.setAttribute('tabindex', '0');\n        console.log(`${element.title} enabled`);\n      }\n    });\n  }\n\n  private disableTabbingOnOtherElements(): void {\n    this.tabbableElements = Array.from(\n      this.shadowRoot?.querySelectorAll('[tabindex]') || []\n    );\n    this.tabbableElements.forEach(element => {\n      if (element.id !== 'helpSection') {\n        element.setAttribute('tabindex', '-1');\n        console.log(`${element.title} disabled`);\n      }\n    });\n  }\n  // Method to toggle play and pause\n  public toggleLottieAnimation(event: Event) {\n    const lottiePlayer = event.target as LottiePlayer; // Get the clicked lottie-player instance\n    lottiePlayer.seek(0);\n    lottiePlayer.play();\n  }\n  /// ///////////////////////////////////////////////\n  // Statics\n  /// ///////////////////////////////////////////////\n\n  public static OpenEventName = DocumentCameraEventDispatcher.OpenEventName;\n  public static CloseEventName = DocumentCameraEventDispatcher.CloseEventName;\n  public static CaptureEventName =\n    DocumentCameraEventDispatcher.CaptureEventName;\n  public static DetectEventName = DocumentCameraEventDispatcher.DetectEventName;\n  public static FailureEventName =\n    DocumentCameraEventDispatcher.FailureEventName;\n\n  static styles = [\n    cameraStyles,\n    css`\n      :host {\n        display: block;\n        color: #000;\n      }\n      .switchDisplay{\n        display: block;\n      }\n      .switchDisplay.hide{\n      display: none;\n      }\n      .tipAnimation {\n        background-color: #dbd9d9;\n      }\n      .pauseIcon {\n        color: white;\n        pointer-events: none; /* Disable clicks when the overlay is hidden */\n        position: absolute;\n        z-index: 0;\n      }\n      .overlay {\n        z-index: 10;\n        background-color: #dbd9d9;\n        height: 8vh;\n        width: 6vh;\n        opacity: 0.1;\n\n        transition: opacity 0s linear 10s;\n      }\n\n      .overlay:active {\n        opacity: 1;\n        transition: opacity 0s;\n      }\n      .backButton{\n        position: absolute;\n        z-index:101;\n        top:16px;\n        left:16px;\n        //width: 24px;\n        //height: 24px;\n      }\n    `,\n  ];\n\n  /// ///////////////////////////////////////////////\n  // Component properties\n  /// ///////////////////////////////////////////////\n  private handleKeydown(event: KeyboardEvent) {\n    if (event.key === 'Enter') {\n      (event.target as HTMLElement).click(); // Simulate a click on Enter key press\n    }\n  }\n  @property({ type: Boolean })\n  isOpen: boolean = false;\n\n  @property({ type: Boolean })\n  showHelpIcon: boolean = true;\n\n  @property({ type: Boolean })\n  forceManualCamera: boolean = false; // TODO: Remove this property\n\n  @property({ type: Boolean })\n  useHeic: boolean = false; // TODO: Remove this property\n\n  @property({ type: String })\n  texts = {\n    autoCaptureText: 'Auto Capture',\n    autoCaptureOnText: 'ON',\n    autoCaptureOffText: 'OFF',\n    alertText: 'Struggling to capture? Disable Auto Capture'\n\n  };\n\n  @property({ type: Array })\n  generalInfoTexts = [\n    'Position your Identity Document within the frame',\n    'Position your Identity Document within the frame and select the capture button.',\n  ];\n\n  @property({ type: Object })\n  hints: DocumentDetectionHint | undefined = undefined;\n\n  @property({ type: Number })\n  successTime: number = 500;\n\n  @property({ type: Boolean })\n  showToggle: boolean = true;\n\n  @property({ type: Number })\n  toggleAutoCaptureDelay = 15000;\n\n  @property({ type: Boolean })\n  showBackOfDocumentAnimation = false;\n\n  @state()\n  cameraState: CameraState = CameraState.OutOfFrame;\n\n  @state()\n  hasShownDocumentAnimation: boolean = false;\n\n  @state()\n  toggleDelayIsDone: boolean = false;\n\n\n  @state()\n  isPortraitOrientation: boolean = false;\n\n  @state()\n  private tapToCaptureSpinner: boolean = false;\n\n  @state()\n  private tapToCapture = false;\n\n  @state()\n  public showHelp = false;\n\n  @state()\n  private captured = false;\n\n  detectionHints: (docState: CameraState) => DocumentHint = (\n    docState: CameraState,\n  ) => {\n    switch (docState) {\n      case CameraState.MoveCloser:\n        return (\n          this.hints?.moveCloserHint || {\n            title: 'Document is too far',\n            description: 'Fit the document fully within the frame.',\n          }\n        );\n      case CameraState.FixBlur:\n        return (\n          this.hints?.fixBlurHint || {\n            title: 'Document is blurry',\n            description: 'Hold the document and device steady.',\n          }\n        );\n      case CameraState.FixGlare:\n        return (\n          this.hints?.fixGlareHint || {\n            title: 'Glare Detected',\n            description: 'Move the document away from direct light sources.',\n          }\n        );\n      case CameraState.OutOfFrame:\n        return (\n          this.hints?.outOfFrameHint || {\n            title: 'Document not in frame',\n            description: 'Fit the document fully within the frame.',\n          }\n        );\n      case CameraState.Capturing:\n        return (\n          this.hints?.capturingHint || {\n            title: 'Document detected',\n            description: 'Capturing',\n          }\n        );\n      default:\n        return (\n          this.hints?.outOfFrameHint || {\n            title: 'Document not in frame',\n            description: 'Fit the document fully within the frame.',\n          }\n        );\n    }\n  };\n\n\n  /// ///////////////////////////////////////////////\n  // Component non-property variables\n  /// ///////////////////////////////////////////////\n\n  private videoElementRef: Ref<HTMLVideoElement> = createRef();\n\n  private uiCanvasElementRef: Ref<HTMLCanvasElement> = createRef();\n\n  private guidanceIconRef: Ref<LottiePlayer> = createRef();\n\n  private documentAnimationRef: Ref<LottiePlayer> = createRef();\n\n  public documentBackAnimationRef: Ref<LottiePlayer> = createRef();\n\n  private autoCaptureSwitchRef: Ref<HTMLInputElement> = createRef();\n\n  private isPortraitOrientationQuery = window.matchMedia(\n    '(orientation: portrait)',\n  );\n\n  smartCaptureModule?: ISmartCaptureModule;\n\n  private webRtcCamera?: WebRtcCamera;\n\n  private eventDispatcher: DocumentCameraEventDispatcher =\n    new DocumentCameraEventDispatcher(this);\n\n  /// ///////////////////////////////////////////////\n  // Helper/misc methods\n  /// ///////////////////////////////////////////////\n\n  getPlayer(): HTMLVideoElement | undefined {\n    return this.videoElementRef.value;\n  }\n\n  /// ///////////////////////////////////////////////\n  // UI related methods\n  /// ///////////////////////////////////////////////\n\n  private drawAutoCaptureFrame(\n    autoCapture: Boolean = true,\n    autoCaptureToggled = false,\n  ) {\n    const isCapturing = this.cameraState === CameraState.Capturing;\n    const ShouldShowAlert =\n      this.hasShownDocumentAnimation && !isCapturing && !this.tapToCapture;\n    const uiCanvas = this.uiCanvasElementRef.value;\n    const uiContext = uiCanvas?.getContext('2d');\n    const player = this.getPlayer();\n    if (!uiCanvas || !uiContext || !player) return;\n\n    if (autoCapture || autoCaptureToggled) {\n      uiCanvas.width = player.videoWidth;\n      uiCanvas.height = player.videoHeight;\n    } else {\n      uiCanvas.width = player.videoHeight;\n      uiCanvas.height = player.videoWidth;\n    }\n\n    uiContext.clearRect(0, 0, uiCanvas.width, uiCanvas.height);\n    let cornerColor = 'rgba(255, 255, 255)';\n    if (ShouldShowAlert) cornerColor = 'rgba(250, 160, 80)';\n    if (this.captured) cornerColor = 'rgba(120, 210, 120)';\n    drawDocumentRectangle(uiContext, cornerColor);\n\n    if (!this.captured)\n\n      drawAutoCaptureHint(uiContext, autoCapture, ShouldShowAlert, this.texts.autoCaptureText, this.showToggle ? this.texts.alertText : '', this.texts.autoCaptureOnText, this.texts.autoCaptureOffText);\n  }\n\n  private loadHintAnimation() {\n    switch (this.cameraState) {\n      case CameraState.MoveCloser:\n        this.guidanceIconRef.value?.load(lowResolutionAnimation);\n        break;\n      case CameraState.FixBlur:\n        this.guidanceIconRef.value?.load(blurAnimation);\n        break;\n      case CameraState.FixGlare:\n        this.guidanceIconRef.value?.load(glareAnimation);\n        break;\n      case CameraState.OutOfFrame:\n        this.guidanceIconRef.value?.load(lowResolutionAnimation);\n        break;\n      default: // No document\n        this.guidanceIconRef.value?.load(lowResolutionAnimation);\n    }\n  }\n\n  public onDocumentAnimationComplete() {\n    this.hasShownDocumentAnimation = true;\n    setTimeout(() => {\n      console.log(\"Delayed for \"+ this.toggleAutoCaptureDelay /1000+\" seconds.\");\n      this.autoCaptureSwitchRef.value?.removeAttribute('disabled');\n      this.toggleDelayIsDone = true;\n\n    }, this.toggleAutoCaptureDelay);\n  }\n\n  private onOrientationChange(event: MediaQueryListEvent) {\n    this.isPortraitOrientation = event.matches;\n  }\n\n  private onTapToCaptureSwitchChange() {\n    if (!this.tapToCapture) {\n      this.webRtcCamera?.stopDetection();\n    } else {\n      this.webRtcCamera?.runDetectionBind();\n    }\n    this.tapToCapture = !this.tapToCapture;\n    this.drawAutoCaptureFrame(!this.tapToCapture, true);\n  }\n\n  private async onTapToCaptureButtonClick() {\n    this.tapToCaptureSpinner = true;\n    this.getPlayer()?.pause();\n    await this.webRtcCamera?.triggerCapture(true);\n    this.tapToCaptureSpinner = false;\n    this.closeCamera();\n  }\n\n  /// ///////////////////////////////////////////////\n  // WebRTC Camera callbacks\n  /// ///////////////////////////////////////////////\n\n  onCameraEnabled(): void {\n    const player = this.getPlayer();\n    if (player) {\n      player.play();\n      this.eventDispatcher.dispatchOpen();\n    } else {\n      // This should never happen.\n      this.isOpen = false;\n      this.eventDispatcher.dispatchError(\n        StartFail('Component video element missing.'),\n      );\n    }\n  }\n\n  onDetect(response: DetectResponse | undefined, cameraState: CameraState) {\n    this.cameraState = cameraState;\n    if (!this.hasShownDocumentAnimation) {\n      this.documentAnimationRef.value?.play();\n      this.documentBackAnimationRef.value?.play();\n\n    }\n    this.drawAutoCaptureFrame(!this.tapToCapture, this.tapToCapture);\n    this.eventDispatcher.dispatchDetect(response, cameraState);\n    if (cameraState === CameraState.Capturing) {\n      this.webRtcCamera?.triggerCapture();\n    }\n  }\n\n  onCapture(response: CaptureResponse) {\n    this.getPlayer()?.pause();\n    this.captured = true;\n    this.drawAutoCaptureFrame(!this.tapToCapture);\n    setTimeout(() => {\n      this.isOpen = false;\n      this.eventDispatcher.dispatchCapture(response);\n    }, this.successTime);\n  }\n\n  onError(error: DocCameraError) {\n    this.isOpen = false;\n    this.eventDispatcher.dispatchError(error);\n  }\n\n  /// ///////////////////////////////////////////////\n  // WebRTC Camera related methods\n  /// ///////////////////////////////////////////////\n\n  public openCamera() {\n    if (!this.webRtcCamera) {\n      if (!this.smartCaptureModule) {\n        this.smartCaptureModule = SmartCaptureModule.getInstance();\n      }\n      this.webRtcCamera = new WebRtcCamera(this, this.smartCaptureModule);\n    }\n    this.webRtcCamera.startCamera();\n\n    this.documentAnimationRef.value?.addEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n    this.documentBackAnimationRef.value?.addEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n    const switchDisplay = this.shadowRoot?.querySelector('.switchDisplay');\n    if(!this.showToggle){\n      switchDisplay?.classList.add('hide');\n    }else{\n      switchDisplay?.classList.remove('hide');\n    }\n  }\n\n  private closeCamera() {\n    this.webRtcCamera?.endCamera();\n    this.documentAnimationRef.value?.removeEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n    this.documentBackAnimationRef.value?.removeEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n\n\n    this.eventDispatcher.dispatchClose();\n  }\n\n  private helpToggle() {\n    this.showHelp = !this.showHelp;\n    // this.setFocusToElement('helpSection');\n  }\n\n  /// ///////////////////////////////////////////////\n  // Component related methods\n  /// ///////////////////////////////////////////////\n\n  connectedCallback(): void {\n    super.connectedCallback();\n    this.isPortraitOrientation = this.isPortraitOrientationQuery.matches;\n    this.isPortraitOrientationQuery.onchange =\n      this.onOrientationChange.bind(this);\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.isPortraitOrientationQuery.onchange = null;\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    super.updated(changedProperties);\n    console.log('Updated', changedProperties);\n    if (changedProperties.has('showHelp') && this.showHelp) {\n      this.setFocusToElement('helpSection');\n      this.disableTabbingOnOtherElements();\n    } else {\n      this.enableTabbingOnOtherElements();\n    }\n\n\n    if (changedProperties.has('isOpen')) {\n      if (!this.isOpen) {\n        this.hasShownDocumentAnimation = false;\n        this.captured = false;\n        this.tapToCapture = false;\n        this.toggleDelayIsDone = false;\n      }\n\n      if (!this.forceManualCamera && isLiveCaptureSupported()) {\n        if (this.isOpen) {\n          this.openCamera();\n        } else {\n          this.closeCamera();\n        }\n      }\n    }\n    if (changedProperties.has('isPortraitOrientation')) {\n      this.drawAutoCaptureFrame(!this.tapToCapture);\n    }\n  }\n\n  private guidanceIcon() {\n    return html`\n      <lottie-player\n        ${ref(this.guidanceIconRef)}\n        autoplay\n        loop\n        aria-label=\"null\"\n        style=\"width: 8vh\"\n        .src=${lowResolutionAnimation}\n      >\n      </lottie-player>\n    `;\n  }\n\n  private documentAnimation() {\n    return html`\n      <div class=\"cameraPreviewTransparentOverlay\">\n        <lottie-player\n          ${ref(this.documentAnimationRef)}\n          count=\"1\"\n          loop\n          aria-label=\"null\"\n          style=\"max-height: 40vh;\"\n          .src=${this.isPortraitOrientation\n            ? positionDocumentAnimationPortrait\n            : positionDocumentAnimation}\n        >\n        </lottie-player>\n      </div>\n    `;\n  }\n  private backOfDocumentAnimation() {\n    return html`\n      <div class=\"cameraPreviewTransparentOverlay\">\n        <lottie-player\n          ${ref(this.documentBackAnimationRef)}\n          count=\"1\"\n          loop\n          aria-label=\"null\"\n          style=\"max-height: 40vh;\"\n          .src=${this.isPortraitOrientation\n            ? flipDocumentPortrait\n            : flipDocument}\n        >\n        </lottie-player>\n      </div>\n    `;\n  }\n\n  private manualActionsSection() {\n    return html`\n      <div class=\"manualActionsContainer\">\n        <div class=\"switchDisplay\">\n          <label\n            class=\"control controlSwitch manual--mode--switch\"\n            aria-label=\"switch\"\n          >\n            <input\n              aria-label=\"toggle Auto Capture\"\n              id=\"toggleAutoCapture\"\n              ${ref(this.autoCaptureSwitchRef)}\n              type=\"checkbox\"\n              checked\n              @change=${this.onTapToCaptureSwitchChange}\n              disabled\n            />\n            <div\n              aria-label=\"toggle Auto Capture\"\n              class=\"controlSwitchContainer ${this.toggleDelayIsDone\n                ? 'enabledSwitch'\n                : 'disabledSwitch'}\"\n              tabindex=\"0\"\n              @keydown=${this.handleKeydown}\n            >\n              <div class=\"icon ico-checkmark-16 controlSwitchIcon text-black\">\n                <svg\n                  width=\"16\"\n                  height=\"16\"\n                  viewBox=\"0 0 16 16\"\n                  fill=\"none\"\n                  aria-label=\"Checkmark icon\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  class=\"icon ico-checkmark-16 controlSwitchIcon text-black\"\n                >\n                  <path\n                    d=\"M13 4L6 12L3 9\"\n                    stroke=\"#111\"\n                    stroke-width=\"1.5\"\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                  ></path>\n                </svg>\n              </div>\n            </div>\n            <p class=\"action-caption\">${this.texts.autoCaptureText}</p>\n          </label>\n        </div>\n        ${this.isPortraitOrientation\n          ? null\n          : html`<div\n              class=\"cameraCaptureContainer ${this.isPortraitOrientation\n                ? null\n                : 'landscape'}\"\n              style=\"display:${this.tapToCapture ? 'block' : 'none'}\"\n            >\n              <div\n                class=\"cameraCaptureButton\"\n                @click=${this.onTapToCaptureButtonClick}\n                @keydown=${this.handleKeydown}\n                tabindex=\"0\"\n                aria-label=\"Camera icon\"\n              >\n                ${cameraIcon}\n              </div>\n            </div>`}\n      </div>\n    `;\n  }\n\n  private generalInfoSection() {\n    const isCapturing = this.cameraState === CameraState.Capturing;\n    const ShouldShowAlert =\n      this.hasShownDocumentAnimation && !isCapturing && !this.tapToCapture;\n    return !ShouldShowAlert\n      ? html`\n          <div class=\"generalInfoContainer\">\n            <p>${this.generalInfoTexts[Number(this.tapToCapture)]}</p>\n          </div>\n        `\n      : null;\n  }\n\n  private manualCaptureButtonSection() {\n    return this.tapToCapture\n      ? html`<div>\n          <div class=\"guidanceContainer\">\n            <div\n              class=\"guidanceInnerContainer ${this.isPortraitOrientation\n                ? null\n                : 'landscape'}\"\n            >\n              <div\n                class=\"guidanceIcon ${this.isPortraitOrientation\n                  ? null\n                  : 'landscape'}\"\n              >\n                ${this.guidanceIcon()}\n              </div>\n              <div\n                class=\"guidanceDescriptionContainer\"\n                aria-live=\"assertive\"\n                role=\"alert\"\n              >\n                <div class=\"guidanceDescription\">\n                  ${this.generalInfoTexts[Number(this.tapToCapture)]}\n                </div>\n              </div>\n            </div>\n          </div>\n          ${this.isPortraitOrientation\n            ? html`<div\n                class=\"cameraCaptureContainer\"\n                style=\"display:${this.tapToCapture ? 'block' : 'none'}\"\n              >\n                <div\n                  class=\"cameraCaptureButton\"\n                  @click=${this.onTapToCaptureButtonClick}\n                  @keydown=${this.handleKeydown}\n                >\n                  ${cameraIcon}\n                </div>\n              </div>`\n            : null}\n        </div>`\n      : null;\n  }\n\n  private cameraGuidanceSection() {\n    const hint = this.detectionHints(this.cameraState);\n    this.loadHintAnimation();\n\n    return html`\n      <div class=\"guidanceContainer\">\n        <div\n          class=\"guidanceInnerContainer ${this.isPortraitOrientation\n            ? null\n            : 'landscape'}\"\n        >\n          <div\n            class=\"guidanceIcon ${this.isPortraitOrientation\n              ? null\n              : 'landscape'}\"\n          >\n            ${this.guidanceIcon()}\n          </div>\n          <div\n            class=\"guidanceDescriptionContainer\"\n            aria-live=\"assertive\"\n            role=\"alert\"\n          >\n            <div class=\"guidanceDescription\">${hint.description}</div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private video() {\n    return html`\n      <video\n        class=\"video\"\n        ${ref(this.videoElementRef)}\n        autoplay\n        playsinline\n      ></video>\n    `;\n  }\n\n  private cameraPreview() {\n    const isCapturing = this.cameraState === CameraState.Capturing;\n    const ShouldShowAlert =\n      this.hasShownDocumentAnimation && !isCapturing && !this.tapToCapture;\n    const hint = this.detectionHints(this.cameraState);\n    const classes = {\n      cameraPreviewInnerContainer: true,\n      cameraPreviewInnerContainerError: !isCapturing,\n      cameraPreviewInnerContainerSuccess: isCapturing,\n    };\n\n    console.log(\"showBack\", this.showBackOfDocumentAnimation)\n    return html`\n      <div class=\"cameraPreviewContainer\">\n        <div class=\"backButton\"\n             @click=${this.closeCamera}\n             @keydown=${this.handleKeydown}\n             role=\"button\"\n             aria-label=\"Back\"\n             tabindex=\"0\"\n             style=\"cursor: pointer;\">\n          <svg width=\"24px\" height=\"24px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M15 18L9 12L15 6\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </div>\n        <div class=${classMap(classes)}>\n          <loading-spinner>\n            <div\n              class=\"spinner\"\n              aria-label=\"Tap to Capture\"\n              style=\"display:${this.tapToCaptureSpinner ? 'block' : 'none'}\"\n            ></div>\n          </loading-spinner>\n          <canvas class=\"canvas\" ${ref(this.uiCanvasElementRef)}> </canvas>\n          ${!this.hasShownDocumentAnimation && !this.showBackOfDocumentAnimation ? this.documentAnimation() : null}\n          ${!this.hasShownDocumentAnimation && this.showBackOfDocumentAnimation ? this.backOfDocumentAnimation() : null}\n\n          ${this.captured ? capturedIcon : null}${this.video()}\n          ${ShouldShowAlert\n            ? html`<div class=\"guidanceTitleContainer\">\n                ${warningIcon}\n                <span class=\"guidanceTitle\"> ${hint.title} </span>\n              </div>`\n            : null}\n          ${this.showHelpIcon\n            ? html`<div\n                class=\"helpIcon\"\n                aria-label=\"close help\"\n                @click=${this.helpToggle}\n                tabindex=\"0\"\n                @keydown=${this.handleKeydown}\n              >\n                ${helpIcon}\n              </div>`\n            : null}\n        </div>\n      </div>\n    `;\n  }\n\n  private helpSection() {\n    return html`\n      <div\n        class=\"helpContainer\"\n        tabindex=\"0\"\n        id=\"helpSection\"\n        aria-label=\"Help section.\"\n      >\n        ${this.isPortraitOrientation\n          ? html`\n              <div\n                class=\"closeHelp\"\n                id=\"helpSection\"\n                @click=${this.helpToggle}\n                @keydown=${this.handleKeydown}\n                tabindex=\"0\"\n              >\n                Close help ${closeIcon}\n              </div>\n              <div class=\"helpTitle\">\n                How to take a photo of your Identity Document\n              </div>\n            `\n          : html`\n              <div style=\"display: flex; justify-content: space-between\">\n                <div\n                  class=\"helpTitle\"\n                  id=\"helpSection\"\n                  tabindex=\"0\"\n                  style=\"margin-top:0\"\n                >\n                  How to take a photo of your Identity Document\n                </div>\n                <div\n                  id=\"helpSection\"\n                  class=\"closeHelp\"\n                  @click=${this.helpToggle}\n                  tabindex=\"0\"\n                  @keydown=${this.handleKeydown}\n                >\n                  Close help ${closeIcon}\n                </div>\n              </div>\n            `}\n        <div class=\"helpText\" id=\"helpSection\" tabindex=\"0\">\n          When Auto Capture is on, the capture screen will automatically take a\n          photo of your document when it has recognised that it is of good\n          enough quality.\n        </div>\n        <div\n          class=\"helpTitle\"\n          style=\"font-size: 16px\"\n          id=\"helpSection\"\n          tabindex=\"0\"\n        >\n          Tips for taking a good quality photo\n        </div>\n        <div class=\"tipsContainer\">\n          <div class=\"tipContainer\">\n            <div class=\"tipAnimation\">\n              <lottie-player\n                id=\"helpSection\"\n                class=\"overlay\"\n                @click=${this.toggleLottieAnimation}\n                @keydown=${this.handleKeydown}\n                style=\"width: 8vh\"\n                tabindex=\"0\"\n                aria-label=\"Use a well lit area but avoid any strong overhead lighting.\"\n                .src=${glareAnimation}\n              >\n              </lottie-player>\n              <div class=\"pauseIcon\">${pauseIcon}</div>\n            </div>\n            <div class=\"tipText\">\n              <div class=\"helpTitle\" style=\"font-size: 14px; margin-top: 0\">\n                Prevent Glare\n              </div>\n              <div class=\"helpText\" style=\"margin-top: 0\">\n                Move the document away from direct light sources.\n              </div>\n            </div>\n          </div>\n          <div class=\"tipContainer\">\n            <div class=\"tipAnimation\">\n              <lottie-player\n                @click=${this.toggleLottieAnimation}\n                class=\"overlay\"\n                aria-label=\"Fill the entire frame with your document.\"\n                style=\"width: 8vh\"\n                tabindex=\"0\"\n                id=\"helpSection\"\n                .src=${blurAnimation}\n                @keydown=${this.handleKeydown}\n              >\n              </lottie-player>\n              <div class=\"pauseIcon\">${pauseIcon}</div>\n            </div>\n            <div class=\"tipText\">\n              <div class=\"helpTitle\" style=\"font-size: 14px; margin-top: 0\">\n                Prevent Blur\n              </div>\n              <div class=\"helpText\" style=\"margin-top: 0\">\n                Hold the document or device steady.\n              </div>\n            </div>\n          </div>\n          <div class=\"tipContainer\">\n            <div class=\"tipAnimation\">\n              <lottie-player\n                class=\"overlay\"\n                id=\"helpSection\"\n                tabindex=\"0\"\n                @click=${this.toggleLottieAnimation}\n                @keydown=${this.handleKeydown}\n                aria-label=\"Hold your phone steady.\"\n                style=\"width: 8vh\"\n                .src=${lowResolutionAnimation}\n              >\n              </lottie-player>\n              <div class=\"pauseIcon\">${pauseIcon}</div>\n            </div>\n            <div class=\"tipText\">\n              <div class=\"helpTitle\" style=\"font-size: 14px; margin-top: 0\">\n                Document Too Far\n              </div>\n              <div class=\"helpText\" style=\"margin-top: 0\">\n                Fit the document fully within the frame.\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    `;\n  }\n\n  render() {\n    return html`\n      <div class=\"root\">\n        <div\n          class=\"container ${this.isPortraitOrientation\n            ? 'portrait'\n            : 'landscape'}\"\n        >\n          ${this.showHelp ? this.helpSection() : null} ${this.cameraPreview()}\n          <div\n            class=\"feedbackContainer ${this.isPortraitOrientation\n              ? null\n              : 'landscape'}\"\n          >\n            ${this.hasShownDocumentAnimation &&\n            !this.tapToCapture &&\n            !this.captured\n              ? this.cameraGuidanceSection()\n              : null}\n            ${!this.tapToCapture && !this.captured\n              ? this.generalInfoSection()\n              : null}\n            ${!this.captured ? this.manualCaptureButtonSection() : null}\n            ${!this.captured ? this.manualActionsSection() : null}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n}\n","import { JwtToken } from './JwtToken';\nimport { SdkBearerAuthentication } from './SdkBearerAuthentication';\n\nexport const isSdkBearerAuthentication = (\n  value: any\n): value is SdkBearerAuthentication =>\n  Object.keys(value).length === 2 &&\n  typeof value.token === 'string' &&\n  typeof value.url === 'string';\n\nconst parseJwt = (token: string): JwtToken => {\n  const base64Url = token.split('.')[1];\n  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n  const jsonPayload = decodeURIComponent(\n    atob(base64)\n      .split('')\n      .map(c => `%${`00${c.charCodeAt(0).toString(16)}`.slice(-2)}`)\n      .join('')\n  );\n  return JSON.parse(jsonPayload);\n};\n\nexport const getSubscription = (token: string) => {\n  const jwtToken = parseJwt(token);\n  const [, subscription] = jwtToken.sub.split('Subscription ')[1];\n  return subscription;\n};\n"],"names":["PermissionNotGrantedError","message","code","UnexpectedError","addMetadata","imgBase64","metadata","make","navigator","platform","model","userAgent","software","dateTimeOriginal","Date","toUTCString","userComment","repeat","zeroth","exif","piexif","ImageIFD","Make","Model","Software","imageDescription","ImageDescription","ExifIFD","DateTimeOriginal","UserComment","exifObj","Exif","exifStr","dump","insert","isIpadIOS13OrAbove","maxTouchPoints","isIOS","test","iOSversion","v","appVersion","match","parseInt","_","isiOS144Plus","ver","length","isiOS15","isiOS163OrLess","isiOS164Plus","isiOS17","isDeviceAffectedByIOS16Issue","decodedCookie","decodeURIComponent","document","cookie","includes","dims","screen","width","height","long","Math","max","short","min","isFirefox","toLowerCase","indexOf","isSamsungNote10OrS10OrNewer","async","navData","deviceModel","userAgentData","_a","getHighEntropyValues","dm","matchedModelNumber","modelNumber","smallerModelNumber","Number","isNaN","isChromeForIOS","window","isWebkit","isChrome","isLiveCaptureSupported","console","error","isBackCameraLabel","cameraLabel","some","keyword","arrayBufferToBase64","buffer","binary","bytes","Uint8Array","len","byteLength","i","String","fromCharCode","btoa","deviceOS","sdkName","onload","imageElement","canvasElement","createElement","MAX_WIDTH","MAX_HEIGHT","context","getContext","drawImage","data","toDataURL","clearRect","resizeImageFromBlob","imageBlob","Promise","resolve","URL","revokeObjectURL","src","createObjectURL","resizeImageFromString","imageSrc","split","DocumentType","DocumentState","SmartCaptureHost","constructor","this","createWorker","workerScriptUrl","reject","smartCaptureWorker","createCrossDomainWorker","makeRequest","then","catch","checkImage","image","requestMessage","requestData","requestId","getTime","toString","responseHandler","id","removeEventListener","errorHandler","e","addEventListener","postMessage","workerUrl","worker","testSameOrigin","Worker","type","onerror","event","preventDefault","createWorkerFallback","blob","Blob","blobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","blobUrl","webkitURL","e1","log","url","loc","location","a","href","hostname","port","protocol","FaceDetectionState","SmartCaptureHost$1","SmartCaptureModule","_initialized","_initializing","barcodeReaderId","hiddenCanvas","init","_b","Error","addBarcodeReaderDiv","getElementById","barcodeReaderDiv","style","display","body","appendChild","processEncodedFrame","img","result","quality","coords","corners","coordinateCheck","mapCorners","undefined","dimensions","isGood","isAdequateDpi","resolutionCheck","isSharp","blurCheck","isGlareFree","glareCheck","failedChecks","imageDataToBlob","imageData","w","h","hiddenContext","putImageData","toBlob","detect","imgData","asBlob","arrayBuffer","croppedImg","crop","imgBlob","captureData","_c","Image","top","topLeft","y","topRight","bot","bottomLeft","bottomRight","left","x","right","getImageData","addImageProcess","isInitialized","isInitializing","_SmartCaptureModule_instance","value","getInstance","__classPrivateFieldGet","__classPrivateFieldSet","SmartCaptureWorker","workerGlobalContext","onError","onMessage","onPerformQualityCheck","close","onInitialize","smartCapture","stickman_module","checkQuality","response","resolveCheck","name","succesfulChecks","checkPassed","checkFailed","smResult","analyse_encoded_image","document_bounds","failed_checks","is_good","successful_checks","JSON","parse","self","FaceCameraEventDispatcher","parent","dispatchInitialized","CustomEvent","InitializeEventName","bubbles","composed","deprecatedEvent","DetectorInitializeEventName","dispatchEvent","warn","dispatchBeforeOpened","BeforeOpenEventName","dispatchOpened","OpenEventName","dispatchDetected","detectionErrors","DetectEventName","detail","errors","dispatchBeforeCaptured","BeforeCaptureEventName","dispatchCapture","imageBase64","encryptedFile","dispatchError","CaptureEventName","dispatchClosed","CloseEventName","FailureEventName","dispatchRetake","RetakeEventName","dispatchPreview","PreviewEventName","LiveFaceCamera","LitElement","liveCameraRef","createRef","eventDispatcher","lastDetectionState","isFlashing","environment","isOpen","hints","detectionState","FaceNotFound","isInPreview","detectionText","faceState","NotInitialized","notInitializedHint","_d","faceNotFoundHint","TooManyFaces","_f","_e","tooManyFacesHint","FaceAngleTooLarge","_h","_g","faceAngleTooLargeHint","ProbabilityTooSmall","_k","_j","probabilityTooSmallHint","FaceTooSmall","_m","_l","faceTooSmallHint","FaceCloseToBorder","_p","_o","faceCloseToBorderHint","isMobileDevice","connectedCallback","super","loadLibrary","library","import","disconnectedCallback","updated","changedProperties","has","Event","_onInitialized","stopPropagation","_onBeforeOpened","_onOpened","oval","shadowRoot","querySelector","initializer","sidepanel","liveface","hint","classList","remove","add","openCamera","_onDetection","errorStates","setTimeout","_onBeforeCaptured","_onCaptured","capturedModal","photo","_onClosed","_onFailure","_onPreview","_onRetake","_closeCamera","closeCamera","liveCamera","html","ref","render","styles","css","__decorate","property","prototype","Boolean","Object","state","customElement","HEIC_NOT_SUPPORTED_CODE","SequenceBreak","StartFail","RuntimeError","HeicNotSupported","CameraState","WebRtcCamera","smartCaptureModule","willReadFrequently","isStarted","isDetecting","isCapturing","lastFrameDetected","detectResponse","restartDetectionBind","restartDetectionAfterBrowserResume","bind","visibilityChangeBind","onVisibilityChange","metaDataBind","onLoadedMetaData","runDetectionBind","runDetection","videoConstraints","facingMode","ideal","aspectRatio","cameraConstraints","video","initSmartCapture","finalizeCameraConstraints","innerWidth","innerHeight","zoom","startCamera","player","getPlayer","startCameraInternal","iteration","getDeviceWasAbleToReadLabels","deviceId","stream","mediaDevices","getUserMedia","device","getDevice","getVideoTracks","getSettings","stopMediaTracks","enableCamera","userMediaError","srcObject","addEvents","onCameraEnabled","stopDetection","clearTimeout","detectTimeout","endCamera","removeEvents","pause","srcStream","paused","processFrameForDetection","devices","minSuffix","enumerateDevices","selectedDevice","dualWideCamera","find","d","label","filter","kind","forEach","cameraSuffixNumber","videoWidth","videoHeight","visibilityState","getTracks","track","stop","sequenceBreak","newCanvasHeight","newCanvasWidth","handleLiveCapture","onDetect","Capturing","OutOfFrame","FixGlare","FixBlur","MoveCloser","triggerCapture","manualMode","lastFrameImgData","lastFramedetectResponse","isPortraitOrientation","matchMedia","matches","onCapture","imageWidth","imageHeight","cameraStyles","drawDocumentRectangle","cornerColor","fillStyle","lineWidth","canvas","center","targetWidth","targetHeight","offsetX","offsetY","defaultCorners","fillRect","point","index","currentOrientation","orientation","color","strokeStyle","lineJoin","beginPath","roundedX","roundedY","moveTo","lineTo","stroke","drawCorner","drawCorners","warningIcon","capturedIcon","helpIcon","cameraIcon","closeIcon","pauseIcon","DocumentCameraEventDispatcher","captureResponse","dispatchClose","dispatchOpen","dispatchDetect","cameraState","LiveDocumentCamera","tabbableElements","showHelpIcon","forceManualCamera","useHeic","texts","autoCaptureText","autoCaptureOnText","autoCaptureOffText","alertText","generalInfoTexts","successTime","showToggle","toggleAutoCaptureDelay","showBackOfDocumentAnimation","hasShownDocumentAnimation","toggleDelayIsDone","tapToCaptureSpinner","tapToCapture","showHelp","captured","detectionHints","docState","moveCloserHint","title","description","fixBlurHint","fixGlareHint","outOfFrameHint","capturingHint","videoElementRef","uiCanvasElementRef","guidanceIconRef","documentAnimationRef","documentBackAnimationRef","autoCaptureSwitchRef","isPortraitOrientationQuery","setFocusToElement","elementId","element","hasAttribute","setAttribute","focus","enableTabbingOnOtherElements","Array","from","querySelectorAll","disableTabbingOnOtherElements","toggleLottieAnimation","lottiePlayer","target","seek","play","handleKeydown","key","click","drawAutoCaptureFrame","autoCapture","autoCaptureToggled","ShouldShowAlert","uiCanvas","uiContext","paddingTop","font","textAlign","fillText","drawAutoCaptureHint","loadHintAnimation","load","lowResolutionAnimation","blurAnimation","glareAnimation","onDocumentAnimationComplete","removeAttribute","onOrientationChange","onTapToCaptureSwitchChange","webRtcCamera","onTapToCaptureButtonClick","switchDisplay","helpToggle","onchange","guidanceIcon","documentAnimation","positionDocumentAnimationPortrait","positionDocumentAnimation","backOfDocumentAnimation","flipDocumentPortrait","flipDocument","manualActionsSection","generalInfoSection","manualCaptureButtonSection","cameraGuidanceSection","cameraPreview","classes","cameraPreviewInnerContainer","cameraPreviewInnerContainerError","cameraPreviewInnerContainerSuccess","classMap","helpSection","isSdkBearerAuthentication","keys","token","getSubscription","jwtToken","base64","replace","jsonPayload","atob","map","c","charCodeAt","slice","join","parseJwt","subscription","sub"],"mappings":"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"}