{"version":3,"file":"index.js","sources":["../../../../src/helper/index.ts","../../../../src/document/error/DocumentCameraError.ts","../../../../src/document/WebRtcCamera.ts","../../../../src/image/smart-capture/SmartCaptureHost.ts","../../../../src/image/SmartCaptureModule.ts","../../../../src/document/components/cameraStyles.ts","../../../../src/document/components/canvasUtils.ts","../../../../src/document/components/icons.ts","../../../../src/document/components/DocumentCameraEventDispatcher.ts","../../../../src/document/components/live-document-camera.ts"],"sourcesContent":["export { addMetadata, SDKMetadata } from './MetaDataHelper';\n\nexport const isIpadIOS13OrAbove = () =>\n  navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;\n\nexport const isIOS = (): boolean =>\n  /iPad|iPhone|iPod/.test(navigator.platform) || isIpadIOS13OrAbove();\n\nexport const iOSversion = (): number[] => {\n  if (/iP(hone|od|ad)/.test(navigator.platform)) {\n    // supports iOS 2.0 and later: <http://bit.ly/TJjs1V>\n    try {\n      const v = navigator.appVersion.match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n      if (v === null) {\n        return [-1];\n      }\n      return [\n        parseInt(v[1], 10),\n        parseInt(v[2], 10),\n        parseInt(v[3] || '0', 10),\n      ];\n    } catch (_) {\n      return [-1];\n    }\n  }\n  return [-1];\n};\n\nexport const isiOS144Plus = (): boolean => {\n  const ver = iOSversion();\n  return ver && ver.length >= 2 && ver[0] === 14 && ver[1] >= 4;\n};\n\nexport const isiOS15 = (): boolean => {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] === 15;\n};\n\nexport function isiOS163OrLess() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] === 16 && ver[1] < 4;\n}\n\nexport function isiOS164Plus() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] >= 16 && ver[1] >= 4;\n}\n\nexport function isiOS17() {\n  const ver = iOSversion();\n  return ver && ver.length >= 1 && ver[0] >= 17;\n}\n\nexport const isDeviceAffectedByIOS16Issue = (): boolean => {\n  const decodedCookie = decodeURIComponent(document.cookie);\n  if (decodedCookie.includes('ForceRegularCapture=true')) {\n    return false;\n  }\n  if (decodedCookie.includes('ForceDistantCapture=true')) {\n    return true;\n  }\n  if (isiOS163OrLess()) {\n\n    const dims = [screen.width, screen.height];\n    const long = Math.max(...dims);\n    const short = Math.min(...dims);\n    if (long === 852 && short === 393) {\n      // 14 pro\n      return true;\n    }\n    if (long === 932 && short === 430) {\n      // 14 pro max\n      return true;\n    }\n    if (long === 844 && short === 390) {\n      // 13 pro\n      return true;\n    }\n    if (long === 926 && short === 428) {\n      // 13 pro max\n      return true;\n    }\n  }\n  return false;\n};\n\nexport const isFirefox = (): boolean =>\n  navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const isSamsungNote10OrS10OrNewer = async () => {\n  const navData: any = navigator;\n  let deviceModel: any = '';\n\n  if (navData.userAgentData?.getHighEntropyValues) {\n    const dm = await navData.userAgentData.getHighEntropyValues(['model']);\n    if (typeof dm === 'string') {\n      deviceModel = dm;\n    } else if (typeof dm.model === 'string') {\n      deviceModel = dm.model;\n    }\n  } else {\n    deviceModel = navigator.userAgent;\n  }\n\n  const matchedModelNumber = deviceModel.match(/SM-[N|G|S]\\d{3}/);\n  if (!matchedModelNumber) {\n    return false;\n  }\n\n  const modelNumber = parseInt(matchedModelNumber[0].match(/\\d{3}/)[0], 10);\n  const smallerModelNumber = deviceModel.match(/SM-S\\d{3}/) ? 900 : 970; // S10e\n  return !Number.isNaN(modelNumber) && modelNumber >= smallerModelNumber;\n};\n\nexport const isChromeForIOS = () => {\n  const { userAgent } = window.navigator;\n  const isWebkit = userAgent.indexOf('WebKit') > -1;\n  const isChrome = userAgent.indexOf('CriOS') > -1;\n  return isWebkit && isChrome && isIOS();\n};\n\nexport const isLiveCaptureSupported = (): boolean =>{\n  if('mediaDevices' in navigator){\n    return true\n  }\n  console.error(\"Camera not available\");\n  return false\n}\n\nexport const isBackCameraLabel = (cameraLabel: string): boolean => {\n  const backCameraKeywords = [\n    'rear',\n    'back',\n    'rück',\n    'arrière',\n    'trasera',\n    'trás',\n    'traseira',\n    'posteriore',\n    '后面',\n    '後面',\n    '背面',\n    'задней',\n    'الخلفية',\n    '후',\n    'arka',\n    'achterzijde',\n    'หลัง',\n    'baksidan',\n    'bagside',\n    'sau',\n    'bak',\n    'tylny',\n    'takakamera',\n    'belakang',\n    'אחורית',\n    'πίσω',\n    'spate',\n    'hátsó',\n    'zadní',\n    'darrere',\n    'zadná',\n    'задня',\n    'stražnja',\n    'belakang',\n    'बैक',\n  ];\n  return backCameraKeywords.some(keyword => cameraLabel.includes(keyword));\n};\n\nexport const arrayBufferToBase64 = (buffer: ArrayBuffer): string => {\n  let binary = '';\n  const bytes = new Uint8Array(buffer);\n  const len = bytes.byteLength;\n  for (let i = 0; i < len; i += 1) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return window.btoa(binary);\n};\nexport const deviceOS = (): string => (isIOS() ? 'iOS' : 'Android');\n\nexport const sdkName = 'Docs & Bio Mobile Web SDK 1.0';\n","export const SEQUENCE_BREAK_CODE = 'sequence-break';\nexport const START_FAIL_CODE = 'start-fail';\nexport const RUNTIME_ERROR_CODE = 'runtime-error';\nexport const HEIC_NOT_SUPPORTED_CODE = 'heic-not-supported';\n\nexport const SEQUENCE_BREAK_TEXT_IOS_15 =\n  'Camera capture failed due to unexpected sequence break. This usually indicates the camera closed or froze unexpectedly. In iOS 15+ this is intermittently occurs due to a GPU Highwater failure. Swap to manual capture until the user fully reloads the browser. Attempting to continue to use live capture can lead to further Highwater errors and can cause to OS to cut off the webpage.';\nexport const SEQUENCE_BREAK_TEXT_OTHER =\n  'Camera capture failed due to unexpected sequence break. This usually indicates the camera closed or froze unexpectedly. Swap to manual capture until the user fully reloads the browser.';\nexport const HEIC_NOT_SUPPORTED_TEXT =\n  'HEIC image processing failed. Please use the version that supports HEIC files if HEIC is expected.';\n\nexport type DocCameraError = {\n  code: string;\n  message: string;\n};\n\nexport const SequenceBreak = (isIOS: boolean = true): DocCameraError => ({\n  code: SEQUENCE_BREAK_CODE,\n  message: isIOS ? SEQUENCE_BREAK_TEXT_IOS_15 : SEQUENCE_BREAK_TEXT_OTHER,\n});\n\nexport const StartFail = (message: string): DocCameraError => ({\n  code: START_FAIL_CODE,\n  message,\n});\n\nexport const RuntimeError = (message: string): DocCameraError => ({\n  code: RUNTIME_ERROR_CODE,\n  message,\n});\n\nexport const HeicNotSupported = (message?: string): DocCameraError => {\n  if (message) {\n    return { code: HEIC_NOT_SUPPORTED_CODE, message };\n  }\n  return { code: HEIC_NOT_SUPPORTED_CODE, message: HEIC_NOT_SUPPORTED_TEXT };\n};\n","import { RuntimeError, SequenceBreak, StartFail } from './error/index';\nimport {\n  isIOS,\n  isBackCameraLabel,\n  isSamsungNote10OrS10OrNewer,\n  isiOS15,\n  isiOS17,\n  isIpadIOS13OrAbove,\n  isDeviceAffectedByIOS16Issue,\n  isiOS164Plus,\n} from '../helper/index';\nimport { ILiveDocumentCamera } from './LiveDocumentCameraInterface';\nimport { DetectResponse } from '../image/index';\nimport { ISmartCaptureModule } from '../image/interfaces/ISmartCaptureModule';\nimport { CaptureResponse } from './CaptureResponse';\nimport { DetectedFrame } from './DetectedFrame';\n\nexport const MAX_VIDEO_WIDTH_IOS_15 = 1920;\n\nexport enum CameraState {\n  MoveCloser,\n  OutOfFrame,\n  FixGlare,\n  FixBlur,\n  Countdown,\n  Capturing,\n  TapToCapture,\n}\n\n// TODO: organize methods into categories like in the camera component after all methods are set up.\nexport class WebRtcCamera {\n  private hiddenCanvas: HTMLCanvasElement = document.createElement('canvas');\n\n  // willReadFrequently is only enabled on Android since it's not implemented on iOS\n  private hiddenContext: CanvasRenderingContext2D | null =\n    this.hiddenCanvas.getContext('2d', { willReadFrequently: !isIOS() });\n\n  private isStarted: boolean = false;\n  private isDetecting: boolean = false;\n  private detectTimeout?: ReturnType<typeof setTimeout>;\n  private isCapturing = false;\n  private parent: ILiveDocumentCamera;\n  private smartCaptureModule: ISmartCaptureModule;\n  private player?: HTMLVideoElement;\n  private lastFrameDetected: DetectedFrame = {\n    imgData: undefined,\n    detectResponse: undefined,\n  };\n\n  private restartDetectionBind =\n    this.restartDetectionAfterBrowserResume.bind(this);\n  private visibilityChangeBind = this.onVisibilityChange.bind(this);\n  private metaDataBind = this.onLoadedMetaData.bind(this);\n  runDetectionBind = this.runDetection.bind(this);\n\n  constructor(\n    parent: ILiveDocumentCamera,\n    smartCaptureModule: ISmartCaptureModule\n  ) {\n    this.parent = parent;\n    this.smartCaptureModule = smartCaptureModule;\n    this.initSmartCapture();\n  }\n\n  private initSmartCapture() {\n    if (\n      !this.smartCaptureModule.isInitialized &&\n      !this.smartCaptureModule.isInitializing\n    ) {\n      this.smartCaptureModule.init().catch(() => {\n        this.parent.onError(\n          RuntimeError('Smart Capture Module failed to init.')\n        );\n      });\n    }\n  }\n\n  private videoConstraints: MediaTrackConstraints = {\n    facingMode: { ideal: 'environment' },\n    // 1.3333 aspect ratio and lower ideal height seems to result in better focus and higher dpi on ios devices.\n    // I believe this is because the true ratio of the camera is 4:3 so this ratio means people do not need to get as close\n    // to the id to get good dpi. Cameras might struggle to focus at very close angles.\n    aspectRatio: 4 / 3,\n    // This might help performance, especially on low end devices. Might be less important after apple fixes the ios 15 bug,\n    // but right now we want to do as little redraws as possible to avoid GPU load.\n    // 20221110 update removing this as this did not seem to be relevant and might be negatively affecting firefox\n    // frameRate: { min: 10, ideal: 15, max: 15 }\n  };\n\n  private cameraConstraints: MediaStreamConstraints = {\n    video: this.videoConstraints,\n  };\n\n  private async finalizeCameraConstraints() {\n    if (isIOS()) {\n      if (isDeviceAffectedByIOS16Issue()) {\n        // Need to bump resolution since we will be capturing from further away\n        // Also change aspect ratio to make it seem like the id is closer from user's pov.\n        this.videoConstraints.aspectRatio =\n          (Math.max(window.innerWidth, window.innerHeight) * 1.0) /\n          Math.min(window.innerWidth, window.innerHeight);\n        this.videoConstraints.height = { min: 1440, ideal: 2880 };\n      } else if (isiOS15()) {\n        this.videoConstraints.width = {\n          min: MAX_VIDEO_WIDTH_IOS_15,\n          ideal: MAX_VIDEO_WIDTH_IOS_15,\n        };\n      } else {\n        this.videoConstraints.height = { min: 1440, ideal: 1440 };\n        if (isiOS17()) {\n          this.videoConstraints.zoom = 1.6;\n        }\n      }\n    } else {\n      this.videoConstraints.height = { min: 720, ideal: 1440 };\n      if (await isSamsungNote10OrS10OrNewer()) {\n        // We found out that some triple camera Samsung devices (S10, S20, Note 20, etc) capture images blurry at edges.\n        // Zooming to 2X, matching the telephoto lens, doesn't solve it completely but mitigates it.\n        this.videoConstraints.zoom = 2.0;\n      }\n    }\n  }\n  async startCamera() {\n    this.player = this.parent.getPlayer();\n    if (!this.player) {\n      this.parent.onError(StartFail('Required internal element was null'));\n      return;\n    }\n\n    if (!this.isStarted) {\n      await this.finalizeCameraConstraints();\n      await this.startCameraInternal();\n    }\n  }\n\n  /**\n   * Attempts to get the best back facing camera and then start it.\n   *\n   * getDevice will not always return accurate data until after get user media has been called once. So the first time this is called it starts the camera fitting the constraints, but after starting that camera it checks with get devices if there is a better camera fitting our constraints. If there is it will add its ID to the constraints can perform this function again, this time not checking with get devices.\n   *\n   * @param iteration the current attempt number to search for the proper camera device.\n   */\n  private async startCameraInternal(iteration = 0) {\n    const maxIterations = 2;\n    const video = this.cameraConstraints.video as MediaTrackConstraints;\n    // Realistically this would never be set on the first call and always set on the second one, however\n    // it makes sense to check it just in case the implementor is overriding our ID selection and specifying their own.\n    const getDeviceWasAbleToReadLabels = Boolean(video.deviceId);\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia(\n        this.cameraConstraints\n      );\n      if (!getDeviceWasAbleToReadLabels && iteration < maxIterations) {\n        // Check if there is a better camera to use once we have permissions\n        const device = await this.getDevice();\n        if (\n          device &&\n          device.deviceId !== stream.getVideoTracks()[0].getSettings().deviceId\n        ) {\n          this.videoConstraints.deviceId = device.deviceId;\n          this.stopMediaTracks(stream);\n          await this.startCameraInternal(iteration + 1);\n        } else {\n          await this.enableCamera(stream);\n        }\n      } else {\n        await this.enableCamera(stream);\n      }\n    } catch (error) {\n      const userMediaError = error as DOMException;\n      this.parent.onError(StartFail(userMediaError.message));\n    }\n  }\n\n  private async enableCamera(stream: MediaStream) {\n    this.isStarted = true;\n    if (this.player) this.player.srcObject = stream;\n    await this.addEvents();\n    this.parent.onCameraEnabled();\n  }\n\n  stopDetection() {\n    clearTimeout(this.detectTimeout);\n  }\n\n  endCamera() {\n    this.isStarted = false;\n    this.isDetecting = false;\n    if (this.detectTimeout) {\n      this.stopDetection();\n      this.detectTimeout = undefined;\n    }\n\n    this.isCapturing = false;\n\n    this.removeEvents();\n\n    if (this.player) {\n      this.player.pause();\n      const srcStream = this.player.srcObject as MediaStream;\n      if (srcStream) {\n        this.stopMediaTracks(srcStream);\n      }\n    }\n\n    // This is just in case the camera is reused somehow on a different device.\n    this.videoConstraints.deviceId = undefined;\n  }\n\n  private async addEvents() {\n    if (this.player) {\n      this.player.addEventListener('play', this.restartDetectionBind);\n      this.player.addEventListener('loadedmetadata', this.metaDataBind);\n    }\n    if (await isSamsungNote10OrS10OrNewer()) {\n      document.addEventListener('visibilitychange', this.visibilityChangeBind);\n    }\n  }\n\n  private async removeEvents() {\n    if (this.player) {\n      this.player.removeEventListener('play', this.restartDetectionBind);\n      this.player.removeEventListener('loadedmetadata', this.metaDataBind);\n    }\n    if (await isSamsungNote10OrS10OrNewer()) {\n      document.removeEventListener(\n        'visibilitychange',\n        this.visibilityChangeBind\n      );\n    }\n  }\n\n  // Once this function is called once it will start a detect loop.\n  private runDetection() {\n    if (!this.player || this.player.paused) {\n      this.detectTimeout = setTimeout(this.runDetectionBind, 100);\n      return;\n    }\n\n    this.processFrameForDetection();\n    this.detectTimeout = setTimeout(this.runDetectionBind, 100); // detecting at most 10 times a second, short circuits out very quickly if detect is running\n  }\n\n  // Sets up constraints to target the best camera. I think this is what the original implementer went off of:\n  // https://old.reddit.com/r/javascript/comments/8eg8w5/choosing_cameras_in_javascript_with_the/\n  // could be prone to error\n  private async getDevice(): Promise<MediaDeviceInfo | null> {\n    let devices;\n    try {\n      devices = await navigator.mediaDevices.enumerateDevices();\n    } catch {\n      return null;\n    }\n    let minSuffix: number;\n    let selectedDevice = null;\n    const dualWideCamera = devices.find(\n      d => d.label === 'Back Dual Wide Camera'\n    );\n    if (isiOS164Plus() && dualWideCamera) {\n      selectedDevice = dualWideCamera;\n    } else {\n      devices\n        .filter(device => device.kind === 'videoinput')\n        .forEach(device => {\n          if (!isBackCameraLabel(device.label)) {\n            return;\n          }\n          const split = device.label.split(',');\n          const cameraSuffixNumber = parseInt(\n            split[0][split[0].length - 1],\n            10\n          );\n          if (cameraSuffixNumber || cameraSuffixNumber === 0) {\n            if (minSuffix === undefined || minSuffix > cameraSuffixNumber) {\n              minSuffix = cameraSuffixNumber;\n              selectedDevice = device;\n            }\n          }\n        });\n    }\n    return selectedDevice;\n  }\n\n  // This is in a callback because we need the video to already be playing with the correct resolution\n  private onLoadedMetaData() {\n    if (\n      !this.player ||\n      this.player.videoWidth + this.player.videoHeight < 1000\n    ) {\n      this.endCamera();\n      this.parent.onError(StartFail('insufficient camera stream dimens'));\n    } else {\n      this.runDetectionBind();\n    }\n  }\n\n  // We need to restart the camera when navigator is sent to background at devices where the zoom constraint is applied,\n  // otherwise, zoom value is override when resuming capture\n  private async onVisibilityChange() {\n    if (!this.isStarted) {\n      return;\n    }\n\n    if (document.visibilityState === 'visible') {\n      this.endCamera();\n      await this.startCamera();\n    }\n  }\n\n  // We need this to re-create the detect timeout after browser is sent to background/resumed since the timer is throttled by the OS\n  private restartDetectionAfterBrowserResume() {\n    if (!this.detectTimeout) {\n      return;\n    }\n\n    this.stopDetection();\n    this.isDetecting = false;\n    this.runDetectionBind();\n  }\n\n  private stopMediaTracks(stream: MediaStream | undefined) {\n    if (stream) {\n      stream.getTracks().forEach(track => {\n        track.stop();\n      });\n    }\n  }\n\n  private sequenceBreak() {\n    this.parent.onError(SequenceBreak(isiOS15() || isIpadIOS13OrAbove()));\n  }\n\n  private processFrameForDetection() {\n    if (!this.isStarted || this.isDetecting || this.isCapturing) {\n      return;\n    }\n    if (!this.player || this.player.videoWidth === 0) {\n      this.sequenceBreak();\n      return;\n    }\n    if (!this.hiddenContext) {\n      this.parent.onError(RuntimeError('Required internal element was null'));\n      return;\n    }\n    this.isDetecting = true;\n\n    let newCanvasHeight = 0;\n    let newCanvasWidth = 0;\n\n    newCanvasWidth = this.player.videoWidth;\n    newCanvasHeight = this.player.videoHeight;\n\n    if (\n      newCanvasWidth !== this.hiddenCanvas.width ||\n      newCanvasHeight !== this.hiddenCanvas.height\n    ) {\n      this.hiddenCanvas.width = newCanvasWidth;\n      this.hiddenCanvas.height = newCanvasHeight;\n    }\n\n    if (this.isStarted) {\n      let imgData;\n      try {\n        this.hiddenContext.drawImage(\n          this.player,\n          0,\n          0,\n          this.player.videoWidth,\n          this.player.videoHeight,\n          0,\n          0,\n          this.hiddenCanvas.width,\n          this.hiddenCanvas.height\n        ); // This scales down to target size\n        imgData = this.hiddenContext.getImageData(\n          0,\n          0,\n          this.hiddenCanvas.width,\n          this.hiddenCanvas.height\n        );\n        this.hiddenContext.clearRect(\n          0,\n          0,\n          this.hiddenCanvas.width,\n          this.hiddenCanvas.height\n        );\n      } catch (_) {\n        this.sequenceBreak();\n        return;\n      }\n\n      this.detect({ imageData: imgData });\n    }\n  }\n\n  private async detect(imgData: CaptureResponse) {\n    if (!this.smartCaptureModule.isInitialized) {\n      this.initSmartCapture();\n      this.isDetecting = false;\n    } else {\n      try {\n        const detectResponse = await this.smartCaptureModule.detect(imgData);\n        this.lastFrameDetected.detectResponse = detectResponse;\n        this.lastFrameDetected.imgData = imgData.imageData;\n        this.handleLiveCapture(detectResponse);\n      } catch {\n        this.parent.onError(RuntimeError('Detect Errored Unexpectedly.'));\n      } finally {\n        this.isDetecting = false;\n      }\n    }\n  }\n\n  private handleLiveCapture(response: DetectResponse | undefined) {\n    if (response) {\n      if (response.isGood) {\n        this.parent.onDetect(response, CameraState.Capturing);\n      } else if (response.failedChecks.includes('FullDocumentInViewCheck')) {\n        this.parent.onDetect(response, CameraState.OutOfFrame);\n      } else if (!response.isAdequateDpi) {\n        this.parent.onDetect(response, CameraState.MoveCloser);\n      } else if (!response.isSharp) {\n        this.parent.onDetect(response, CameraState.FixBlur);\n      } else {\n        this.parent.onDetect(response, CameraState.FixGlare);\n      }\n    } else {\n      this.parent.onDetect(undefined, CameraState.OutOfFrame);\n    }\n  }\n\n  async triggerCapture(manualMode: boolean = false) {\n    this.stopDetection();\n\n    const lastFrameImgData = this.lastFrameDetected.imgData;\n    const lastFramedetectResponse = this.lastFrameDetected.detectResponse;\n\n    let imgData;\n    let detectResponse;\n    const isPortraitOrientation = window.matchMedia(\n      '(orientation: portrait)'\n    ).matches;\n\n    if (lastFrameImgData && lastFramedetectResponse && !manualMode) {\n      imgData = lastFrameImgData;\n      detectResponse = lastFramedetectResponse;\n    } else {\n      const { hiddenCanvas, hiddenContext, player } = this;\n\n      if (!hiddenCanvas || !hiddenContext || !player) {\n        this.parent.onError(RuntimeError('Required internal element was null'));\n        return;\n      }\n      try {\n        if (player.videoWidth === 0) {\n          throw new Error('width 0');\n        }\n        hiddenCanvas.width = player.videoWidth;\n        hiddenCanvas.height = player.videoHeight;\n\n        hiddenContext.drawImage(\n          player,\n          0,\n          0,\n          hiddenCanvas.width,\n          hiddenCanvas.height\n        );\n        imgData = hiddenContext.getImageData(\n          0,\n          0,\n          hiddenCanvas.width,\n          hiddenCanvas.height\n        );\n        hiddenContext.clearRect(0, 0, hiddenCanvas.width, hiddenCanvas.height);\n      } catch (_) {\n        this.sequenceBreak();\n        return;\n      }\n\n      detectResponse = await this.smartCaptureModule.detect({\n        imageData: imgData,\n      });\n    }\n\n    this.parent.onCapture({\n      isGood: detectResponse.isGood,\n      isAdequateDpi: detectResponse.isAdequateDpi,\n      isSharp: detectResponse.isSharp,\n      isGlareFree: detectResponse.isGlareFree,\n      failedChecks: detectResponse.failedChecks,\n      imageData: imgData,\n      imageWidth: imgData.width,\n      imageHeight: imgData.height,\n      isPortraitOrientation,\n    });\n  }\n}\n","/* eslint no-promise-executor-return: 0 */\nimport { SmartCaptureWorkerMessages } from './enums/SmartCaptureWorkerMessages';\nimport { IImageResult } from './interfaces/IImage';\nimport { IWorkerMessageEvent } from './interfaces/IMessage';\n\nexport class SmartCaptureHost {\n  private smartCaptureWorker?: Worker;\n\n  public createWorker = (workerScriptUrl: string): Promise<void> =>\n    new Promise((resolve, reject) => {\n      if (this.smartCaptureWorker) {\n        return this.makeRequest(SmartCaptureWorkerMessages.Initialize, null)\n          .then(resolve)\n          .catch(reject);\n      }\n      this.smartCaptureWorker = this.createCrossDomainWorker(workerScriptUrl);\n      return this.makeRequest(SmartCaptureWorkerMessages.Initialize, null)\n        .then(resolve)\n        .catch(reject);\n    });\n\n  private createCrossDomainWorker(workerUrl: string): Worker | undefined {\n    let worker;\n    try {\n      if (this.testSameOrigin(workerUrl)) {\n        worker = new Worker(workerUrl, { type: 'module' });\n        worker.onerror = event => {\n          event.preventDefault();\n          worker = this.createWorkerFallback(workerUrl);\n        };\n      } else {\n        worker = this.createWorkerFallback(workerUrl);\n      }\n    } catch (_) {\n      worker = this.createWorkerFallback(workerUrl);\n    }\n    return worker;\n  }\n\n  private createWorkerFallback(workerUrl: string): Worker | undefined {\n    let worker;\n    try {\n      let blob;\n      try {\n        // TODO: This does not work as expected. We cannot use importScripts with module\n        blob = new Blob([`importScripts('${workerUrl}');`], { type: 'module' });\n      } catch (_) {\n        const blobBuilder = new ((window && (window as any).BlobBuilder) ||\n          (window && (window as any).WebKitBlobBuilder) ||\n          (window && (window as any).MozBlobBuilder))();\n        blobBuilder.append(`importScripts('${workerUrl}');`);\n        blob = blobBuilder.getBlob('module');\n      }\n\n      const url =\n        (window && (window as any).URL) ||\n        (window && (window as any).webkitURL);\n      const blobUrl = url.createObjectURL(blob);\n      return new Worker(blobUrl);\n    } catch (e1) {\n      console.log('WorkerFallback', e1);\n    }\n    return worker;\n  }\n\n  public checkImage = (image: any): Promise<IImageResult> =>\n    this.makeRequest(SmartCaptureWorkerMessages.PerformQualityCheck, { image });\n\n  private makeRequest = <InputType = any, OutputType = any>(\n    requestMessage: SmartCaptureWorkerMessages,\n    requestData: InputType,\n    requestId: string = new Date().getTime().toString()\n  ): Promise<OutputType> =>\n    new Promise((resolve, reject) => {\n      if (this.smartCaptureWorker) {\n        const responseHandler = ({ data }: IWorkerMessageEvent<OutputType>) => {\n          if (data.id === requestId) {\n            this.smartCaptureWorker!.removeEventListener(\n              'message',\n              responseHandler\n            );\n            this.smartCaptureWorker!.removeEventListener('error', errorHandler);\n\n            switch (data.message) {\n              case SmartCaptureWorkerMessages.Error:\n                return reject();\n              default:\n                return resolve(data.data);\n            }\n          }\n          return reject();\n        };\n\n        const errorHandler = (e: any) => {\n          this.smartCaptureWorker!.removeEventListener(\n            'message',\n            responseHandler\n          );\n          this.smartCaptureWorker!.removeEventListener('error', errorHandler);\n          return reject(e);\n        };\n\n        this.smartCaptureWorker.addEventListener('message', responseHandler);\n        this.smartCaptureWorker.addEventListener('error', errorHandler);\n\n        this.smartCaptureWorker!.postMessage({\n          id: requestId,\n          message: requestMessage,\n          data: requestData,\n        });\n      } else {\n        reject();\n      }\n    });\n\n  private testSameOrigin(url: string) {\n    const loc = window.location;\n    const a = document.createElement('a');\n    a.href = url;\n    return (\n      a.hostname === loc.hostname &&\n      a.port === loc.port &&\n      a.protocol === loc.protocol\n    );\n  }\n}\n\n// TODO: Ideally this string wants to come from webpack...\nexport default new SmartCaptureHost();\n","/* eslint no-promise-executor-return: 0 */\n/* eslint prefer-promise-reject-errors: 0 */\n/* eslint consistent-return: 0 */\nimport SmartCaptureHost from './smart-capture/SmartCaptureHost';\nimport { DetectResponse, MappedCorners } from './DetectResponse';\nimport { ISmartCaptureModule } from './interfaces/ISmartCaptureModule';\nimport { CaptureResponse } from '../document/CaptureResponse';\n\nexport class SmartCaptureModule implements ISmartCaptureModule {\n\n  static #instance: SmartCaptureModule | undefined;\n\n  private constructor() {\n    this.addBarcodeReaderDiv(this.barcodeReaderId);\n  }\n\n\n  static getInstance: () => SmartCaptureModule = () => {\n    if (!SmartCaptureModule.#instance) {\n      SmartCaptureModule.#instance = new SmartCaptureModule();\n    }\n    return SmartCaptureModule.#instance;\n  };\n\n  private _initialized = false;\n  get isInitialized() {\n    return this._initialized;\n  }\n  private _initializing = false;\n  get isInitializing() {\n    return this._initializing;\n  }\n\n  private barcodeReaderId: string = 'barcode-reader';\n\n  private hiddenCanvas: HTMLCanvasElement = document.createElement('canvas');\n\n  init: () => Promise<boolean> = async () => {\n    if (this._initialized) {\n      return true;\n    }\n    if (!this._initializing) {\n      this._initializing = true;\n      const workerScriptUrl = new URL(__WORKER_PATH__, import.meta.url).href;\n      try {\n        await SmartCaptureHost.createWorker(workerScriptUrl);\n        this._initializing = false;\n        this._initialized = true;\n        return true;\n      } catch {\n        this._initializing = false;\n        this._initialized = false;\n        throw new Error('Create Worker Failed');\n      }\n    } else {\n      return false;\n    }\n  };\n\n  private addBarcodeReaderDiv: (barcodeReaderId: string) => void = (\n    barcodeReaderId: string\n  ) => {\n    if (document.getElementById(barcodeReaderId)) {\n      return;\n    }\n    const barcodeReaderDiv = document.createElement('div');\n    barcodeReaderDiv.id = barcodeReaderId;\n    barcodeReaderDiv.style.display = 'none';\n    document.body.appendChild(barcodeReaderDiv);\n  };\n\n  private processEncodedFrame: (img: ArrayBuffer) => Promise<DetectResponse> =\n    async (img: ArrayBuffer) => {\n      const result = await SmartCaptureHost.checkImage(img);\n      if (result && result.quality && result.coords) {\n        const corners = result.quality.coordinateCheck\n          ? this.mapCorners(result.coords)\n          : undefined;\n        const dimensions = {\n          width: result.coords.width,\n          height: result.coords.height,\n        };\n        // let type = DocumentType.ID1; //todo how can we detect this now\n        const response: DetectResponse = {\n          isGood: result.isGood,\n          // type: type,\n          dimensions,\n          isAdequateDpi: result.quality.resolutionCheck,\n          // isCorrectAspectRatio: this.isCorrectAspectRatio(dimensions, type),\n          corners,\n          isSharp: result.quality.blurCheck,\n          isGlareFree: result.quality.glareCheck,\n          failedChecks: result.failedChecks,\n        };\n        return response;\n      }\n      throw new Error('Part of result was null');\n    };\n\n  // private isCorrectAspectRatio(dimens: Dimension, cardType: DocumentType) {\n  //   let aspectRatio = dimens.width/dimens.height;\n  //   let isCorrectAspectRatio = false;\n  //   let tolerancePercentage = 5.0;\n  //   let expectedPassportAspectRatio = 1.42;\n  //   let expectedID1AspectRatio = 1.58870;\n  //   let expectedID2AspectRatio  = 1.41915551;\n  //   if (cardType == DocumentType.ID3) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedPassportAspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedPassportAspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   } else if (cardType == DocumentType.ID1) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedID1AspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedID1AspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   } else if (cardType == DocumentType.ID2) {\n  //     let min = ((100 - tolerancePercentage) / 100) * expectedID2AspectRatio;\n  //     let max = ((100 + tolerancePercentage) / 100) * expectedID2AspectRatio;\n  //     if (aspectRatio >= min && aspectRatio <= max) {\n  //       isCorrectAspectRatio = true;\n  //     }\n  //   }\n  //   return isCorrectAspectRatio;\n  // }\n\n  private mapCorners(coords: {\n    height: number;\n    width: number;\n    x: number;\n    y: number;\n  }): MappedCorners {\n    return {\n      topLeft: {\n        x: coords.x,\n        y: coords.y,\n      },\n      topRight: {\n        x: coords.x + coords.width,\n        y: coords.y,\n      },\n      bottomRight: {\n        x: coords.x + coords.width,\n        y: coords.y + coords.height,\n      },\n      bottomLeft: {\n        x: coords.x,\n        y: coords.y + coords.height,\n      },\n    };\n  }\n\n  private imageDataToBlob: (imageData: ImageData) => Promise<Blob> = async (\n    imageData: ImageData\n  ) => {\n    const w = imageData.width;\n    const h = imageData.height;\n    const { hiddenCanvas } = this;\n    const hiddenContext = this.hiddenCanvas.getContext('2d');\n\n    if (!hiddenContext) {\n      throw new Error('Hidden Context Missing');\n    }\n    hiddenCanvas.width = w;\n    hiddenCanvas.height = h;\n    hiddenContext.putImageData(imageData, 0, 0);\n    const blob: Blob | null = await new Promise(resolve =>\n      hiddenCanvas.toBlob(resolve)\n    );\n    if (blob) return blob;\n    throw new Error('Canvas To Blob Errored');\n  };\n\n  detect: (imgData: CaptureResponse) => Promise<DetectResponse> = async (\n    imgData: CaptureResponse\n  ) => {\n    if (imgData.imageData) {\n      const asBlob = await this.imageDataToBlob(imgData.imageData);\n      const buffer = await asBlob.arrayBuffer();\n      const result = await this.processEncodedFrame(buffer);\n      if (result.isGood) {\n        const croppedImg = await this.crop(buffer, result);\n        result.image = croppedImg;\n        return result;\n      }\n      return result;\n    }\n    throw new Error('Image Data Was Null');\n  };\n\n  crop: (\n    imgBlob: ArrayBuffer,\n    captureData: DetectResponse\n  ) => Promise<ImageData> = async (\n    imgBlob: ArrayBuffer,\n    captureData: DetectResponse\n  ) => {\n    if (!imgBlob || !captureData.corners) {\n      throw new Error('Image or Corners Missing');\n    }\n\n    const { hiddenCanvas } = this;\n    const hiddenContext = this.hiddenCanvas.getContext('2d');\n\n    if (!hiddenContext) {\n      throw new Error('Hidden Context Missing');\n    }\n\n    if (captureData.dimensions?.width && captureData.dimensions?.height) {\n      const blob = new Blob([imgBlob], { type: 'image/jpeg' });\n      const img = new Image();\n\n      const addImageProcess = (src: string) =>\n        new Promise<ImageData>((resolve, reject) => {\n\n          img.onload = function () {\n            if (captureData.corners) {\n              const top = Math.min(\n                captureData.corners.topLeft.y,\n                captureData.corners.topRight.y\n              );\n              const bot = Math.max(\n                captureData.corners.bottomLeft.y,\n                captureData.corners.bottomRight.y\n              );\n              const left = Math.min(\n                captureData.corners.topLeft.x,\n                captureData.corners.bottomLeft.x\n              );\n              const right = Math.max(\n                captureData.corners.topRight.x,\n                captureData.corners.bottomRight.x\n              );\n\n              hiddenCanvas.height = bot - top;\n              hiddenCanvas.width = right - left;\n              hiddenContext.drawImage(\n                img,\n                left,\n                top,\n                right - left,\n                bot - top,\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              const data = hiddenContext.getImageData(\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              hiddenContext.clearRect(\n                0,\n                0,\n                hiddenCanvas.width,\n                hiddenCanvas.height\n              );\n              hiddenCanvas.height = 1;\n              hiddenCanvas.width = 1;\n\n              resolve(data);\n            }\n          };\n          img.onerror = reject;\n          img.src = src;\n        });\n\n      return addImageProcess(URL.createObjectURL(blob));\n    }\n    throw new Error('Width or Height Missing');\n  };\n}\n","import { css } from 'lit';\n\nexport const cameraStyles = css`\n  .video {\n    display: block;\n    image-orientation: none;\n    object-fit: contain;\n    width: 100%;\n  }\n  .canvas {\n    display: block;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    object-fit: contain;\n    width: 100%;\n    height: 100%;\n  }\n  .helpIcon {\n    position: absolute;\n    right: 12px;\n    bottom: 12px;\n  }\n  .root {\n    color: white;\n    background-color: #000d1a;\n    flex-grow: 50;\n    min-height: 100%;\n    min-width: 100%;\n    display: flex;\n  }\n  .container {\n    position: relative;\n    display: flex;\n  }\n  .container.landscape {\n    flex-direction: row;\n  }\n  .container.portrait {\n    flex-direction: column;\n  }\n  .feedbackContainer {\n    display: flex;\n    justify-content: space-between;\n    flex-direction: column;\n  }\n  .feedbackContainer.landscape {\n    min-width: 292px;\n    width: 60%;\n  }\n  .cameraPreviewContainer {\n    position: relative;\n    width: 100%;\n  }\n  .cameraPreviewInnerContainer {\n    box-sizing: border-box;\n  }\n  .cameraPreviewInnerContainerError {\n    border-color: #f88618;\n  }\n  .cameraPreviewInnerContainerSuccess {\n    border-color: #48bb78;\n  }\n  .guidanceContainer {\n    display: flex;\n    flex-direction: row;\n    padding: 16px;\n  }\n  .guidanceInnerContainer {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n  }\n  .guidanceInnerContainer.landscape {\n    flex-direction: column;\n  }\n  .guidanceIcon {\n    align-self: center;\n    max-height: 8vh;\n    margin-bottom: 16px;\n  }\n  .guidanceIcon.landscape {\n    align-self: flex-start;\n    height: 16vh;\n  }\n  .guidanceDescriptionContainer {\n    padding-left: 12px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n  }\n  .guidanceTitleContainer {\n    position: absolute;\n    bottom: 1vw;\n    width: 100%;\n    display: flex;\n    text-align: center;\n    flex-direction: row;\n    justify-content: center;\n  }\n  .guidanceTitle {\n    color: #fff;\n    font-size: 2vh;\n    font-weight: 600;\n    line-height: 24px;\n    padding-left: 8px;\n    align-self: center;\n  }\n  @media (max-width: 1400px) {\n    .guidanceTitle {\n      font-size: 1.5vh;\n    }\n  }\n  @media (max-width: 850px) {\n    .guidanceTitleContainer {\n      bottom: 2vw;\n    }\n    .guidanceTitle {\n      font-size: 1.5vh;\n    }\n  }\n\n  .guidanceDescription {\n    padding-top: 0.5vh;\n    align-items: center;\n  }\n  .cameraPreviewTransparentOverlay {\n    position: absolute;\n    left: 0;\n    top: 0;\n    z-index: 3;\n    height: 100%;\n    text-align: center;\n    display: flex;\n    justify-content: center;\n    align-content: center;\n    flex-direction: column;\n    width: 100%;\n    max-height: 70vh;\n    object-fit: contain;\n  }\n  .generalInfoContainer {\n    max-width: 95%;\n    padding: 5px 34px 0;\n    margin-top: 25px;\n    margin-left: auto;\n    margin-right: auto;\n    text-align: center;\n    padding-bottom: 10px;\n    font-size: 16px;\n    font-weight: 600;\n    line-height: 24px;\n    letter-spacing: 0.02em;\n  }\n  .manualActionsContainer {\n    display: flex;\n    flex-direction: row;\n    padding: 0 16px;\n    justify-content: space-between;\n  }\n\n  .action-caption {\n    font-size: 16px;\n    margin: 3px 0 16px 3px;\n    font-weight: 600;\n  }\n  .control {\n    align-items: center;\n    background-color: #fff;\n    border: 1px solid #444b53;\n    border-radius: 3px;\n    display: flex;\n    flex-direction: column;\n    transition: box-shadow 0.2s ease;\n  }\n  .controlSwitch {\n    background-color: transparent;\n    border: 0;\n    margin: 0;\n    padding: 0;\n    position: relative;\n    user-select: none;\n    width: fit-content;\n  }\n  .controlSwitchContainer {\n    background-color: #000;\n    border-radius: 5000px;\n    height: 20px;\n    width: 41px;\n  }\n  .disabledSwitch {\n    border: 2px solid #a1a8ae;\n  }\n  .enabledSwitch {\n    border: 2px solid #fff;\n  }\n  .controlSwitchContainer::after {\n    background-color: #fff;\n    border-radius: 50%;\n    content: '';\n    display: block;\n    height: 18px;\n    transform: translateY(1px) translateX(3px);\n    transition: 250ms ease transform, 250ms ease background-color;\n    width: 18px;\n  }\n  .controlSwitchIcon {\n    left: 2px;\n    position: absolute;\n    top: 2px;\n  }\n  input:checked + .controlSwitchContainer.disabledSwitch {\n    background-color: #a1a8ae;\n  }\n  input:checked + .controlSwitchContainer.enabledSwitch {\n    background-color: #fff;\n  }\n  input:checked + .controlSwitchContainer::after {\n    background-color: #000;\n    transform: translateY(1px) translateX(20px);\n  }\n  .controlSwitch input {\n    height: 2px;\n    opacity: 0;\n    position: absolute;\n    width: 2px;\n  }\n  .cameraCaptureContainer {\n    margin: 0 auto;\n    width: 48px;\n    height: 48px;\n  }\n  .cameraCaptureContainer.landscape {\n    margin: 0;\n  }\n  .cameraCaptureButton:hover {\n    cursor: pointer;\n  }\n\n  loading-spinner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n  }\n\n  .spinner {\n    margin: 0 auto;\n    width: 48px;\n    height: 48px;\n    border-radius: 50%;\n    display: inline-block;\n    position: relative;\n    background: linear-gradient(0deg, rgba(255, 61, 0, 0.2) 33%, #f88618 100%);\n    box-sizing: border-box;\n    animation: rotation 1s linear infinite;\n  }\n\n  .spinner::after {\n    content: '';\n    box-sizing: border-box;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 44px;\n    height: 44px;\n    border-radius: 50%;\n    background: #ffffff;\n    opacity: 0.5;\n  }\n\n  .cancel-button {\n    text-align: center;\n    vertical-align: center;\n    margin: 16px;\n    padding: 16px;\n    border-radius: 4px;\n    border: 1px;\n    border: 1px solid #9d3333;\n    font-size: 16px;\n    font-weight: 500;\n    line-height: 24px;\n    letter-spacing: 0.02em;\n    color: #9d3333;\n  }\n\n  .helpContainer {\n    position: absolute;\n    top: 0;\n    left: 0;\n    background-color: #fff;\n    border: 1px solid rgba(186, 189, 193, 1);\n    z-index: 9;\n    padding: 16px;\n    margin: 0;\n    width: -webkit-fill-available;\n  }\n\n  .closeHelp {\n    display: flex;\n    width: 116px;\n    justify-content: space-between;\n    color: rgb(0, 50, 100);\n    font-size: 16px;\n    font-weight: 500;\n    line-height: 24px;\n    letter-spacing: 0.02em;\n    margin-left: auto;\n  }\n\n  .helpTitle {\n    font-size: 18px;\n    font-weight: 600;\n    line-height: 28px;\n    text-align: left;\n    color: rgba(0, 13, 26, 1);\n    margin-top: 16px;\n  }\n\n  .helpText {\n    font-size: 14px;\n    font-weight: 400;\n    line-height: 20px;\n    letter-spacing: 0.01em;\n    text-align: left;\n    color: rgba(68, 75, 83, 1);\n    margin-top: 16px;\n  }\n\n  .tipsContainer {\n    display: flex;\n    flex-wrap: wrap;\n  }\n\n  .tipContainer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-top: 16px;\n    max-width: 230px;\n  }\n\n  .tipAnimation {\n    height: 84px;\n    width: 84px;\n    background-color: rgb(229, 230, 231);\n    margin-right: 16px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  @keyframes rotation {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n\n  @-webkit-keyframes rotation {\n    0% {\n      -webkit-transform: rotate(0deg);\n    }\n    100% {\n      -webkit-transform: rotate(360deg);\n    }\n  }\n\n  @-webkit-keyframes doc-rotation {\n    0% {\n      -webkit-transform: rotate(0deg);\n    }\n    100% {\n      -webkit-transform: rotate(90deg);\n    }\n  }\n`;\n","function drawCorner(\n  context: CanvasRenderingContext2D,\n  point: any,\n  offsetX: number,\n  offsetY: number,\n  color: string\n) {\n  context.strokeStyle = color;\n  context.lineWidth = 10;\n  context.lineJoin = 'miter';\n\n  context.beginPath();\n\n  const roundedX = point.x;\n  const roundedY = point.y;\n\n  context.moveTo(roundedX + offsetX, roundedY);\n  context.lineTo(roundedX, roundedY);\n  context.lineTo(roundedX, roundedY + offsetY);\n  context.stroke();\n}\n\nfunction drawCorners(\n  context: CanvasRenderingContext2D,\n  point: any,\n  index: number,\n  cornerColor: string\n) {\n  const currentOrientation = window.orientation;\n  const { width } = context.canvas;\n  let offsetX = width * 0.07;\n  let offsetY = width * 0.07;\n\n  if (currentOrientation !== 0) {\n    offsetX = width * 0.07;\n    offsetY = width * 0.07;\n  }\n\n  // Modify offsets for specific corners\n  switch (index.toString()) {\n    case '1': // Top-right corner\n      offsetX = -offsetX; // Flip horizontally\n      break;\n    case '2': // Bottom-right corner\n      offsetX = -offsetX; // Flip horizontally\n      offsetY = -offsetY; // Flip vertically\n      break;\n    case '3': // Bottom-left corner\n      offsetY = -offsetY; // Flip vertically\n      break;\n    default: // Top-left corner\n      break;\n  }\n  drawCorner(context, point, offsetX, offsetY, cornerColor);\n}\n\nexport const drawDocumentRectangle = (\n  context: CanvasRenderingContext2D,\n  cornerColor: string\n): void => {\n  context.fillStyle = 'rgba(0, 0, 0, 0.5)';\n  context.lineWidth = 10;\n\n  const { width, height } = context.canvas;\n  const center = {\n    x: width / 2,\n    y: height / 2\n  };\n\n  let targetWidth;\n  let targetHeight;\n\n  if (width >= height) {\n    targetWidth = 0.85 * width;\n    targetHeight = (0.85 * width) / 1.5887;\n    if (targetHeight > 0.85 * height) {\n      targetWidth = (targetWidth / targetHeight) * 0.85 * height;\n      targetHeight = 0.85 * height;\n    }\n    console.log('Normal, Width:' + width + ' Height:' + height);\n  } else {\n    targetWidth = (0.85 * height) / 1.5;\n    targetHeight = 0.82 * height;\n    if (targetWidth > 0.85 * width) {\n      targetHeight = (targetHeight / targetWidth) * 0.85 * width;\n      targetWidth = 0.85 * width;\n    }\n    console.log('Weird, Width:' + width + ' Height:' + height);\n\n  }\n\n  const offsetX = targetWidth / 2;\n  const offsetY = targetHeight / 2;\n\n  const defaultCorners = [\n    { x: center.x - offsetX, y: center.y - offsetY },\n    { x: center.x + offsetX, y: center.y - offsetY },\n    { x: center.x + offsetX, y: center.y + offsetY },\n    { x: center.x - offsetX, y: center.y + offsetY }\n  ];\n\n  // Draw surrounding masks\n  context.fillRect(0, 0, width, defaultCorners[0].y);\n  context.fillRect(0, defaultCorners[0].y, defaultCorners[0].x, height);\n  context.fillRect(\n    defaultCorners[1].x,\n    defaultCorners[1].y,\n    defaultCorners[0].y,\n    height\n  );\n  context.fillRect(\n    defaultCorners[3].x,\n    defaultCorners[3].y,\n    defaultCorners[1].x - defaultCorners[0].x,\n    defaultCorners[0].y\n  );\n\n  defaultCorners.forEach((point, i) => {\n    drawCorners(context, point, i, cornerColor);\n  });\n};\n\nexport const drawAutoCaptureHint = (\n  context: CanvasRenderingContext2D,\n  hint: Boolean,\n  ShouldShowAlert: Boolean,\n  autoCaptureText: string,\n  alertText: string,\n  autoCaptureOnText: string,\n  autoCaptureOffText: string\n): void => {\n  const { width, height } = context.canvas;\n  let paddingTop = ShouldShowAlert ? height * 0.035 : height * 0.055;\n  if (width > height) {\n    paddingTop = height * 0.055;\n  }\n  context.fillStyle = 'rgba(255, 255, 255)';\n  context.font =\n    'bold 50px \"Haas Grot Text R Web\", \"Helvetica Neue\", Helvetica, Arial, sans-serif';\n  context.textAlign = 'center';\n  context.fillText(\n    `${autoCaptureText}  - ${hint ? autoCaptureOnText : autoCaptureOffText}`,\n    context.canvas.width / 2,\n    paddingTop\n  );\n  if (ShouldShowAlert)\n    context.fillText(\n      alertText,\n      context.canvas.width / 2,\n      paddingTop + 60\n    );\n};\n","import { TemplateResult, html } from 'lit';\n\nexport const warningIcon: TemplateResult = html`\n  <svg\n    width=\"22\"\n    height=\"22\"\n    viewBox=\"0 0 22 22\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Warning icon\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M11 0C11.3788 0 11.725 0.214002 11.8944 0.552786L21.8944 20.5528C22.0494 20.8628 22.0329 21.2309 21.8507 21.5257C21.6684 21.8205 21.3466 22 21 22H1C0.653423 22 0.331557 21.8205 0.14935 21.5257C-0.0328564 21.2309 -0.0494204 20.8628 0.105574 20.5528L10.1056 0.552786C10.275 0.214002 10.6212 0 11 0ZM19.382 20L11 3.23607L2.61804 20H19.382ZM11 8C11.5523 8 12 8.44771 12 9V13C12 13.5523 11.5523 14 11 14C10.4477 14 10 13.5523 10 13V9C10 8.44771 10.4477 8 11 8ZM11 18C11.5523 18 12 17.5523 12 17C12 16.4477 11.5523 16 11 16C10.4477 16 10 16.4477 10 17C10 17.5523 10.4477 18 11 18Z\"\n      fill=\"#F88618\"\n    ></path>\n  </svg>\n`;\n\nexport const capturedIcon: TemplateResult = html`\n  <style>\n    svg.overlay {\n      position: absolute;\n      top: calc(50% - 24px);\n      left: calc(50% - 24px);\n      width: 48px;\n      height: 48px;\n    }\n  </style>\n  <svg\n    class=\"overlay\"\n    width=\"48\"\n    height=\"48\"\n    viewBox=\"0 0 48 48\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Document captured icon\"\n  >\n    <circle cx=\"24\" cy=\"24\" r=\"24\" fill=\"#000D1A\" fill-opacity=\"0.5\" />\n    <circle\n      cx=\"24\"\n      cy=\"24\"\n      r=\"18\"\n      fill=\"white\"\n      stroke=\"#78D278\"\n      stroke-width=\"4\"\n      stroke-linecap=\"round\"\n    />\n    <path\n      d=\"M16.7266 25.8181L20.3629 29.4545L31.272 18.5454\"\n      stroke=\"#78D278\"\n      stroke-width=\"4\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n`;\n\nexport const helpIcon: TemplateResult = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Help\"\n  >\n    <g clip-path=\"url(#clip0_3497_1833)\">\n      <path\n        d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\"\n        stroke=\"white\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n      <path\n        d=\"M9.08997 9.00008C9.32507 8.33175 9.78912 7.76819 10.3999 7.40921C11.0107 7.05024 11.7289 6.91902 12.4271 7.03879C13.1254 7.15857 13.7588 7.52161 14.215 8.06361C14.6713 8.60561 14.921 9.2916 14.92 10.0001C14.92 12.0001 11.92 13.0001 11.92 13.0001\"\n        stroke=\"white\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n      <path\n        d=\"M12 17H12.01\"\n        stroke=\"white\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_3497_1833\">\n        <rect width=\"24\" height=\"24\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n`;\n\nexport const cameraIcon: TemplateResult = html`\n  <svg\n    width=\"52\"\n    height=\"52\"\n    viewBox=\"0 0 52 52\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <circle cx=\"26\" cy=\"26\" r=\"25\" stroke=\"white\" stroke-width=\"2\" />\n    <circle cx=\"26\" cy=\"26.0005\" r=\"22\" fill=\"white\" />\n    <path\n      d=\"M37 33C37 33.5304 36.7893 34.0391 36.4142 34.4142C36.0391 34.7893 35.5304 35 35 35H17C16.4696 35 15.9609 34.7893 15.5858 34.4142C15.2107 34.0391 15 33.5304 15 33V22C15 21.4696 15.2107 20.9609 15.5858 20.5858C15.9609 20.2107 16.4696 20 17 20H21L23 17H29L31 20H35C35.5304 20 36.0391 20.2107 36.4142 20.5858C36.7893 20.9609 37 21.4696 37 22V33Z\"\n      stroke=\"black\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n    <path\n      d=\"M26 31C28.2091 31 30 29.2091 30 27C30 24.7909 28.2091 23 26 23C23.7909 23 22 24.7909 22 27C22 29.2091 23.7909 31 26 31Z\"\n      stroke=\"black\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n`;\n\nexport const closeIcon: TemplateResult = html`\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"Help\"\n  >\n    <path\n      d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\"\n      stroke=\"#0B4886\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n    <path\n      d=\"M15 9L9 15\"\n      stroke=\"#0B4886\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n    <path\n      d=\"M9 9L15 15\"\n      stroke=\"#0B4886\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n`;\n\nexport const pauseIcon: TemplateResult = html` <svg\n  xmlns=\"http://www.w3.org/2000/svg\"\n  width=\"24\"\n  height=\"24\"\n  viewBox=\"0 0 24 24\"\n>\n  <path d=\"M2 24v-24l20 12-20 12z\" fill=\"white\" />\n</svg>`;\n","import { DetectResponse } from '../../image/index';\nimport { CaptureResponse } from '../CaptureResponse';\nimport { CameraState } from '../WebRtcCamera';\nimport { DocCameraError } from '../error/index';\n\nexport class DocumentCameraEventDispatcher {\n  public static OpenEventName = 'open';\n  public static CloseEventName = 'close';\n  public static CaptureEventName = 'capture';\n  public static DetectEventName = 'detect';\n  public static FailureEventName = 'failure';\n\n  private parent: HTMLElement;\n\n  constructor(parent: HTMLElement) {\n    this.parent = parent;\n  }\n\n  public dispatchError(error: DocCameraError) {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.FailureEventName,\n      {\n        bubbles: true,\n        composed: true,\n        detail: {\n          error,\n        },\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchCapture(captureResponse: CaptureResponse) {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.CaptureEventName,\n      {\n        bubbles: true,\n        composed: true,\n        detail: {\n          captureResponse,\n        },\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchClose() {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.CloseEventName,\n      {\n        bubbles: true,\n        composed: true,\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchOpen() {\n    const event = new CustomEvent(DocumentCameraEventDispatcher.OpenEventName, {\n      bubbles: true,\n      composed: true,\n    });\n    this.parent.dispatchEvent(event);\n  }\n\n  public dispatchDetect(\n    detectResponse: DetectResponse | undefined,\n    cameraState: CameraState\n  ) {\n    const event = new CustomEvent(\n      DocumentCameraEventDispatcher.DetectEventName,\n      {\n        bubbles: true,\n        composed: true,\n        detail: {\n          detectResponse,\n          cameraState,\n        },\n      }\n    );\n    this.parent.dispatchEvent(event);\n  }\n}\n","import { html, css, LitElement } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { ref, createRef, Ref } from 'lit/directives/ref.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport '@lottiefiles/lottie-player';\nimport type { LottiePlayer } from '@lottiefiles/lottie-player';\nimport { isLiveCaptureSupported } from '../../helper/index';\nimport { DetectResponse } from '../../image/index';\nimport { CaptureResponse } from '../CaptureResponse';\nimport { DocCameraError, StartFail } from '../error/index';\nimport { ILiveDocumentCamera } from '../LiveDocumentCameraInterface';\nimport { WebRtcCamera, CameraState } from '../WebRtcCamera';\n\nimport { SmartCaptureModule } from '../../image/SmartCaptureModule';\nimport { cameraStyles } from './cameraStyles';\nimport { drawAutoCaptureHint, drawDocumentRectangle } from './canvasUtils';\nimport {\n  warningIcon,\n  capturedIcon,\n  helpIcon,\n  cameraIcon,\n  closeIcon,\n  pauseIcon,\n} from './icons';\nimport { DocumentHint } from './DocumentHint';\nimport lowResolutionAnimation from '../../assets/low-res-white.json';\nimport positionDocumentAnimation from '../../assets/position-document.json';\nimport positionDocumentAnimationPortrait from '../../assets/position-document-portrait.json';\nimport flipDocument from '../../assets/flip-document.json';\nimport flipDocumentPortrait from '../../assets/flip-document-portrait.json';\nimport glareAnimation from '../../assets/glare-white.json';\nimport blurAnimation from '../../assets/blur-white.json';\nimport { ISmartCaptureModule } from '../../image/interfaces/ISmartCaptureModule';\nimport { DocumentDetectionHint } from './DocumentDetectionHint';\nimport { DocumentCameraEventDispatcher } from './DocumentCameraEventDispatcher';\n\n\n@customElement('live-document-camera')\nexport class LiveDocumentCamera\n  extends LitElement\n  implements ILiveDocumentCamera\n{\n  private tabbableElements: HTMLElement[] = [];\n  setFocusToElement(elementId: string): void {\n    const element = this.shadowRoot?.getElementById(elementId) as HTMLElement;\n\n    if (element) {\n      if (!element.hasAttribute('tabindex')) {\n        element.setAttribute('tabindex', '0');\n      }\n      element.focus();\n      console.log('focused');\n    } else {\n      console.warn(`Element with ID ${elementId} not found`);\n    }\n  }\n  private enableTabbingOnOtherElements(): void {\n    this.tabbableElements = Array.from(\n      this.shadowRoot?.querySelectorAll('[tabindex]') || []\n    );\n    this.tabbableElements.forEach(element => {\n      if (element.id !== 'helpSection') {\n        element.setAttribute('tabindex', '0');\n        console.log(`${element.title} enabled`);\n      }\n    });\n  }\n\n  private disableTabbingOnOtherElements(): void {\n    this.tabbableElements = Array.from(\n      this.shadowRoot?.querySelectorAll('[tabindex]') || []\n    );\n    this.tabbableElements.forEach(element => {\n      if (element.id !== 'helpSection') {\n        element.setAttribute('tabindex', '-1');\n        console.log(`${element.title} disabled`);\n      }\n    });\n  }\n  // Method to toggle play and pause\n  public toggleLottieAnimation(event: Event) {\n    const lottiePlayer = event.target as LottiePlayer; // Get the clicked lottie-player instance\n    lottiePlayer.seek(0);\n    lottiePlayer.play();\n  }\n  /// ///////////////////////////////////////////////\n  // Statics\n  /// ///////////////////////////////////////////////\n\n  public static OpenEventName = DocumentCameraEventDispatcher.OpenEventName;\n  public static CloseEventName = DocumentCameraEventDispatcher.CloseEventName;\n  public static CaptureEventName =\n    DocumentCameraEventDispatcher.CaptureEventName;\n  public static DetectEventName = DocumentCameraEventDispatcher.DetectEventName;\n  public static FailureEventName =\n    DocumentCameraEventDispatcher.FailureEventName;\n\n  static styles = [\n    cameraStyles,\n    css`\n      :host {\n        display: block;\n        color: #000;\n      }\n      .switchDisplay{\n        display: block;\n      }\n      .switchDisplay.hide{\n      display: none;\n      }\n      .tipAnimation {\n        background-color: #dbd9d9;\n      }\n      .pauseIcon {\n        color: white;\n        pointer-events: none; /* Disable clicks when the overlay is hidden */\n        position: absolute;\n        z-index: 0;\n      }\n      .overlay {\n        z-index: 10;\n        background-color: #dbd9d9;\n        height: 8vh;\n        width: 6vh;\n        opacity: 0.1;\n\n        transition: opacity 0s linear 10s;\n      }\n\n      .overlay:active {\n        opacity: 1;\n        transition: opacity 0s;\n      }\n      .backButton{\n        position: absolute;\n        z-index:101;\n        top:16px;\n        left:16px;\n        //width: 24px;\n        //height: 24px;\n      }\n    `,\n  ];\n\n  /// ///////////////////////////////////////////////\n  // Component properties\n  /// ///////////////////////////////////////////////\n  private handleKeydown(event: KeyboardEvent) {\n    if (event.key === 'Enter') {\n      (event.target as HTMLElement).click(); // Simulate a click on Enter key press\n    }\n  }\n  @property({ type: Boolean })\n  isOpen: boolean = false;\n\n  @property({ type: Boolean })\n  showHelpIcon: boolean = true;\n\n  @property({ type: Boolean })\n  forceManualCamera: boolean = false; // TODO: Remove this property\n\n  @property({ type: Boolean })\n  useHeic: boolean = false; // TODO: Remove this property\n\n  @property({ type: String })\n  texts = {\n    autoCaptureText: 'Auto Capture',\n    autoCaptureOnText: 'ON',\n    autoCaptureOffText: 'OFF',\n    alertText: 'Struggling to capture? Disable Auto Capture'\n\n  };\n\n  @property({ type: Array })\n  generalInfoTexts = [\n    'Position your Identity Document within the frame',\n    'Position your Identity Document within the frame and select the capture button.',\n  ];\n\n  @property({ type: Object })\n  hints: DocumentDetectionHint | undefined = undefined;\n\n  @property({ type: Number })\n  successTime: number = 500;\n\n  @property({ type: Boolean })\n  showToggle: boolean = true;\n\n  @property({ type: Number })\n  toggleAutoCaptureDelay = 15000;\n\n  @property({ type: Boolean })\n  showBackOfDocumentAnimation = false;\n\n  @state()\n  cameraState: CameraState = CameraState.OutOfFrame;\n\n  @state()\n  hasShownDocumentAnimation: boolean = false;\n\n  @state()\n  toggleDelayIsDone: boolean = false;\n\n\n  @state()\n  isPortraitOrientation: boolean = false;\n\n  @state()\n  private tapToCaptureSpinner: boolean = false;\n\n  @state()\n  private tapToCapture = false;\n\n  @state()\n  public showHelp = false;\n\n  @state()\n  private captured = false;\n\n  detectionHints: (docState: CameraState) => DocumentHint = (\n    docState: CameraState,\n  ) => {\n    switch (docState) {\n      case CameraState.MoveCloser:\n        return (\n          this.hints?.moveCloserHint || {\n            title: 'Document is too far',\n            description: 'Fit the document fully within the frame.',\n          }\n        );\n      case CameraState.FixBlur:\n        return (\n          this.hints?.fixBlurHint || {\n            title: 'Document is blurry',\n            description: 'Hold the document and device steady.',\n          }\n        );\n      case CameraState.FixGlare:\n        return (\n          this.hints?.fixGlareHint || {\n            title: 'Glare Detected',\n            description: 'Move the document away from direct light sources.',\n          }\n        );\n      case CameraState.OutOfFrame:\n        return (\n          this.hints?.outOfFrameHint || {\n            title: 'Document not in frame',\n            description: 'Fit the document fully within the frame.',\n          }\n        );\n      case CameraState.Capturing:\n        return (\n          this.hints?.capturingHint || {\n            title: 'Document detected',\n            description: 'Capturing',\n          }\n        );\n      default:\n        return (\n          this.hints?.outOfFrameHint || {\n            title: 'Document not in frame',\n            description: 'Fit the document fully within the frame.',\n          }\n        );\n    }\n  };\n\n\n  /// ///////////////////////////////////////////////\n  // Component non-property variables\n  /// ///////////////////////////////////////////////\n\n  private videoElementRef: Ref<HTMLVideoElement> = createRef();\n\n  private uiCanvasElementRef: Ref<HTMLCanvasElement> = createRef();\n\n  private guidanceIconRef: Ref<LottiePlayer> = createRef();\n\n  private documentAnimationRef: Ref<LottiePlayer> = createRef();\n\n  public documentBackAnimationRef: Ref<LottiePlayer> = createRef();\n\n  private autoCaptureSwitchRef: Ref<HTMLInputElement> = createRef();\n\n  private isPortraitOrientationQuery = window.matchMedia(\n    '(orientation: portrait)',\n  );\n\n  smartCaptureModule?: ISmartCaptureModule;\n\n  private webRtcCamera?: WebRtcCamera;\n\n  private eventDispatcher: DocumentCameraEventDispatcher =\n    new DocumentCameraEventDispatcher(this);\n\n  /// ///////////////////////////////////////////////\n  // Helper/misc methods\n  /// ///////////////////////////////////////////////\n\n  getPlayer(): HTMLVideoElement | undefined {\n    return this.videoElementRef.value;\n  }\n\n  /// ///////////////////////////////////////////////\n  // UI related methods\n  /// ///////////////////////////////////////////////\n\n  private drawAutoCaptureFrame(\n    autoCapture: Boolean = true,\n    autoCaptureToggled = false,\n  ) {\n    const isCapturing = this.cameraState === CameraState.Capturing;\n    const ShouldShowAlert =\n      this.hasShownDocumentAnimation && !isCapturing && !this.tapToCapture;\n    const uiCanvas = this.uiCanvasElementRef.value;\n    const uiContext = uiCanvas?.getContext('2d');\n    const player = this.getPlayer();\n    if (!uiCanvas || !uiContext || !player) return;\n\n    if (autoCapture || autoCaptureToggled) {\n      uiCanvas.width = player.videoWidth;\n      uiCanvas.height = player.videoHeight;\n    } else {\n      uiCanvas.width = player.videoHeight;\n      uiCanvas.height = player.videoWidth;\n    }\n\n    uiContext.clearRect(0, 0, uiCanvas.width, uiCanvas.height);\n    let cornerColor = 'rgba(255, 255, 255)';\n    if (ShouldShowAlert) cornerColor = 'rgba(250, 160, 80)';\n    if (this.captured) cornerColor = 'rgba(120, 210, 120)';\n    drawDocumentRectangle(uiContext, cornerColor);\n\n    if (!this.captured)\n\n      drawAutoCaptureHint(uiContext, autoCapture, ShouldShowAlert, this.texts.autoCaptureText, this.showToggle ? this.texts.alertText : '', this.texts.autoCaptureOnText, this.texts.autoCaptureOffText);\n  }\n\n  private loadHintAnimation() {\n    switch (this.cameraState) {\n      case CameraState.MoveCloser:\n        this.guidanceIconRef.value?.load(lowResolutionAnimation);\n        break;\n      case CameraState.FixBlur:\n        this.guidanceIconRef.value?.load(blurAnimation);\n        break;\n      case CameraState.FixGlare:\n        this.guidanceIconRef.value?.load(glareAnimation);\n        break;\n      case CameraState.OutOfFrame:\n        this.guidanceIconRef.value?.load(lowResolutionAnimation);\n        break;\n      default: // No document\n        this.guidanceIconRef.value?.load(lowResolutionAnimation);\n    }\n  }\n\n  public onDocumentAnimationComplete() {\n    this.hasShownDocumentAnimation = true;\n    setTimeout(() => {\n      console.log(\"Delayed for \"+ this.toggleAutoCaptureDelay /1000+\" seconds.\");\n      this.autoCaptureSwitchRef.value?.removeAttribute('disabled');\n      this.toggleDelayIsDone = true;\n\n    }, this.toggleAutoCaptureDelay);\n  }\n\n  private onOrientationChange(event: MediaQueryListEvent) {\n    this.isPortraitOrientation = event.matches;\n  }\n\n  private onTapToCaptureSwitchChange() {\n    if (!this.tapToCapture) {\n      this.webRtcCamera?.stopDetection();\n    } else {\n      this.webRtcCamera?.runDetectionBind();\n    }\n    this.tapToCapture = !this.tapToCapture;\n    this.drawAutoCaptureFrame(!this.tapToCapture, true);\n  }\n\n  private async onTapToCaptureButtonClick() {\n    this.tapToCaptureSpinner = true;\n    this.getPlayer()?.pause();\n    await this.webRtcCamera?.triggerCapture(true);\n    this.tapToCaptureSpinner = false;\n    this.closeCamera();\n  }\n\n  /// ///////////////////////////////////////////////\n  // WebRTC Camera callbacks\n  /// ///////////////////////////////////////////////\n\n  onCameraEnabled(): void {\n    const player = this.getPlayer();\n    if (player) {\n      player.play();\n      this.eventDispatcher.dispatchOpen();\n    } else {\n      // This should never happen.\n      this.isOpen = false;\n      this.eventDispatcher.dispatchError(\n        StartFail('Component video element missing.'),\n      );\n    }\n  }\n\n  onDetect(response: DetectResponse | undefined, cameraState: CameraState) {\n    this.cameraState = cameraState;\n    if (!this.hasShownDocumentAnimation) {\n      this.documentAnimationRef.value?.play();\n      this.documentBackAnimationRef.value?.play();\n\n    }\n    this.drawAutoCaptureFrame(!this.tapToCapture, this.tapToCapture);\n    this.eventDispatcher.dispatchDetect(response, cameraState);\n    if (cameraState === CameraState.Capturing) {\n      this.webRtcCamera?.triggerCapture();\n    }\n  }\n\n  onCapture(response: CaptureResponse) {\n    this.getPlayer()?.pause();\n    this.captured = true;\n    this.drawAutoCaptureFrame(!this.tapToCapture);\n    setTimeout(() => {\n      this.isOpen = false;\n      this.eventDispatcher.dispatchCapture(response);\n    }, this.successTime);\n  }\n\n  onError(error: DocCameraError) {\n    this.isOpen = false;\n    this.eventDispatcher.dispatchError(error);\n  }\n\n  /// ///////////////////////////////////////////////\n  // WebRTC Camera related methods\n  /// ///////////////////////////////////////////////\n\n  public openCamera() {\n    if (!this.webRtcCamera) {\n      if (!this.smartCaptureModule) {\n        this.smartCaptureModule = SmartCaptureModule.getInstance();\n      }\n      this.webRtcCamera = new WebRtcCamera(this, this.smartCaptureModule);\n    }\n    this.webRtcCamera.startCamera();\n\n    this.documentAnimationRef.value?.addEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n    this.documentBackAnimationRef.value?.addEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n    const switchDisplay = this.shadowRoot?.querySelector('.switchDisplay');\n    if(!this.showToggle){\n      switchDisplay?.classList.add('hide');\n    }else{\n      switchDisplay?.classList.remove('hide');\n    }\n  }\n\n  private closeCamera() {\n    this.webRtcCamera?.endCamera();\n    this.documentAnimationRef.value?.removeEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n    this.documentBackAnimationRef.value?.removeEventListener(\n      'complete',\n      this.onDocumentAnimationComplete.bind(this),\n    );\n\n\n    this.eventDispatcher.dispatchClose();\n  }\n\n  private helpToggle() {\n    this.showHelp = !this.showHelp;\n    // this.setFocusToElement('helpSection');\n  }\n\n  /// ///////////////////////////////////////////////\n  // Component related methods\n  /// ///////////////////////////////////////////////\n\n  connectedCallback(): void {\n    super.connectedCallback();\n    this.isPortraitOrientation = this.isPortraitOrientationQuery.matches;\n    this.isPortraitOrientationQuery.onchange =\n      this.onOrientationChange.bind(this);\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.isPortraitOrientationQuery.onchange = null;\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    super.updated(changedProperties);\n    console.log('Updated', changedProperties);\n    if (changedProperties.has('showHelp') && this.showHelp) {\n      this.setFocusToElement('helpSection');\n      this.disableTabbingOnOtherElements();\n    } else {\n      this.enableTabbingOnOtherElements();\n    }\n\n\n    if (changedProperties.has('isOpen')) {\n      if (!this.isOpen) {\n        this.hasShownDocumentAnimation = false;\n        this.captured = false;\n        this.tapToCapture = false;\n        this.toggleDelayIsDone = false;\n      }\n\n      if (!this.forceManualCamera && isLiveCaptureSupported()) {\n        if (this.isOpen) {\n          this.openCamera();\n        } else {\n          this.closeCamera();\n        }\n      }\n    }\n    if (changedProperties.has('isPortraitOrientation')) {\n      this.drawAutoCaptureFrame(!this.tapToCapture);\n    }\n  }\n\n  private guidanceIcon() {\n    return html`\n      <lottie-player\n        ${ref(this.guidanceIconRef)}\n        autoplay\n        loop\n        aria-label=\"null\"\n        style=\"width: 8vh\"\n        .src=${lowResolutionAnimation}\n      >\n      </lottie-player>\n    `;\n  }\n\n  private documentAnimation() {\n    return html`\n      <div class=\"cameraPreviewTransparentOverlay\">\n        <lottie-player\n          ${ref(this.documentAnimationRef)}\n          count=\"1\"\n          loop\n          aria-label=\"null\"\n          style=\"max-height: 40vh;\"\n          .src=${this.isPortraitOrientation\n            ? positionDocumentAnimationPortrait\n            : positionDocumentAnimation}\n        >\n        </lottie-player>\n      </div>\n    `;\n  }\n  private backOfDocumentAnimation() {\n    return html`\n      <div class=\"cameraPreviewTransparentOverlay\">\n        <lottie-player\n          ${ref(this.documentBackAnimationRef)}\n          count=\"1\"\n          loop\n          aria-label=\"null\"\n          style=\"max-height: 40vh;\"\n          .src=${this.isPortraitOrientation\n            ? flipDocumentPortrait\n            : flipDocument}\n        >\n        </lottie-player>\n      </div>\n    `;\n  }\n\n  private manualActionsSection() {\n    return html`\n      <div class=\"manualActionsContainer\">\n        <div class=\"switchDisplay\">\n          <label\n            class=\"control controlSwitch manual--mode--switch\"\n            aria-label=\"switch\"\n          >\n            <input\n              aria-label=\"toggle Auto Capture\"\n              id=\"toggleAutoCapture\"\n              ${ref(this.autoCaptureSwitchRef)}\n              type=\"checkbox\"\n              checked\n              @change=${this.onTapToCaptureSwitchChange}\n              disabled\n            />\n            <div\n              aria-label=\"toggle Auto Capture\"\n              class=\"controlSwitchContainer ${this.toggleDelayIsDone\n                ? 'enabledSwitch'\n                : 'disabledSwitch'}\"\n              tabindex=\"0\"\n              @keydown=${this.handleKeydown}\n            >\n              <div class=\"icon ico-checkmark-16 controlSwitchIcon text-black\">\n                <svg\n                  width=\"16\"\n                  height=\"16\"\n                  viewBox=\"0 0 16 16\"\n                  fill=\"none\"\n                  aria-label=\"Checkmark icon\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  class=\"icon ico-checkmark-16 controlSwitchIcon text-black\"\n                >\n                  <path\n                    d=\"M13 4L6 12L3 9\"\n                    stroke=\"#111\"\n                    stroke-width=\"1.5\"\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                  ></path>\n                </svg>\n              </div>\n            </div>\n            <p class=\"action-caption\">${this.texts.autoCaptureText}</p>\n          </label>\n        </div>\n        ${this.isPortraitOrientation\n          ? null\n          : html`<div\n              class=\"cameraCaptureContainer ${this.isPortraitOrientation\n                ? null\n                : 'landscape'}\"\n              style=\"display:${this.tapToCapture ? 'block' : 'none'}\"\n            >\n              <div\n                class=\"cameraCaptureButton\"\n                @click=${this.onTapToCaptureButtonClick}\n                @keydown=${this.handleKeydown}\n                tabindex=\"0\"\n                aria-label=\"Camera icon\"\n              >\n                ${cameraIcon}\n              </div>\n            </div>`}\n      </div>\n    `;\n  }\n\n  private generalInfoSection() {\n    const isCapturing = this.cameraState === CameraState.Capturing;\n    const ShouldShowAlert =\n      this.hasShownDocumentAnimation && !isCapturing && !this.tapToCapture;\n    return !ShouldShowAlert\n      ? html`\n          <div class=\"generalInfoContainer\">\n            <p>${this.generalInfoTexts[Number(this.tapToCapture)]}</p>\n          </div>\n        `\n      : null;\n  }\n\n  private manualCaptureButtonSection() {\n    return this.tapToCapture\n      ? html`<div>\n          <div class=\"guidanceContainer\">\n            <div\n              class=\"guidanceInnerContainer ${this.isPortraitOrientation\n                ? null\n                : 'landscape'}\"\n            >\n              <div\n                class=\"guidanceIcon ${this.isPortraitOrientation\n                  ? null\n                  : 'landscape'}\"\n              >\n                ${this.guidanceIcon()}\n              </div>\n              <div\n                class=\"guidanceDescriptionContainer\"\n                aria-live=\"assertive\"\n                role=\"alert\"\n              >\n                <div class=\"guidanceDescription\">\n                  ${this.generalInfoTexts[Number(this.tapToCapture)]}\n                </div>\n              </div>\n            </div>\n          </div>\n          ${this.isPortraitOrientation\n            ? html`<div\n                class=\"cameraCaptureContainer\"\n                style=\"display:${this.tapToCapture ? 'block' : 'none'}\"\n              >\n                <div\n                  class=\"cameraCaptureButton\"\n                  @click=${this.onTapToCaptureButtonClick}\n                  @keydown=${this.handleKeydown}\n                >\n                  ${cameraIcon}\n                </div>\n              </div>`\n            : null}\n        </div>`\n      : null;\n  }\n\n  private cameraGuidanceSection() {\n    const hint = this.detectionHints(this.cameraState);\n    this.loadHintAnimation();\n\n    return html`\n      <div class=\"guidanceContainer\">\n        <div\n          class=\"guidanceInnerContainer ${this.isPortraitOrientation\n            ? null\n            : 'landscape'}\"\n        >\n          <div\n            class=\"guidanceIcon ${this.isPortraitOrientation\n              ? null\n              : 'landscape'}\"\n          >\n            ${this.guidanceIcon()}\n          </div>\n          <div\n            class=\"guidanceDescriptionContainer\"\n            aria-live=\"assertive\"\n            role=\"alert\"\n          >\n            <div class=\"guidanceDescription\">${hint.description}</div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private video() {\n    return html`\n      <video\n        class=\"video\"\n        ${ref(this.videoElementRef)}\n        autoplay\n        playsinline\n      ></video>\n    `;\n  }\n\n  private cameraPreview() {\n    const isCapturing = this.cameraState === CameraState.Capturing;\n    const ShouldShowAlert =\n      this.hasShownDocumentAnimation && !isCapturing && !this.tapToCapture;\n    const hint = this.detectionHints(this.cameraState);\n    const classes = {\n      cameraPreviewInnerContainer: true,\n      cameraPreviewInnerContainerError: !isCapturing,\n      cameraPreviewInnerContainerSuccess: isCapturing,\n    };\n\n    console.log(\"showBack\", this.showBackOfDocumentAnimation)\n    return html`\n      <div class=\"cameraPreviewContainer\">\n        <div class=\"backButton\"\n             @click=${this.closeCamera}\n             @keydown=${this.handleKeydown}\n             role=\"button\"\n             aria-label=\"Back\"\n             tabindex=\"0\"\n             style=\"cursor: pointer;\">\n          <svg width=\"24px\" height=\"24px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M15 18L9 12L15 6\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </div>\n        <div class=${classMap(classes)}>\n          <loading-spinner>\n            <div\n              class=\"spinner\"\n              aria-label=\"Tap to Capture\"\n              style=\"display:${this.tapToCaptureSpinner ? 'block' : 'none'}\"\n            ></div>\n          </loading-spinner>\n          <canvas class=\"canvas\" ${ref(this.uiCanvasElementRef)}> </canvas>\n          ${!this.hasShownDocumentAnimation && !this.showBackOfDocumentAnimation ? this.documentAnimation() : null}\n          ${!this.hasShownDocumentAnimation && this.showBackOfDocumentAnimation ? this.backOfDocumentAnimation() : null}\n\n          ${this.captured ? capturedIcon : null}${this.video()}\n          ${ShouldShowAlert\n            ? html`<div class=\"guidanceTitleContainer\">\n                ${warningIcon}\n                <span class=\"guidanceTitle\"> ${hint.title} </span>\n              </div>`\n            : null}\n          ${this.showHelpIcon\n            ? html`<div\n                class=\"helpIcon\"\n                aria-label=\"close help\"\n                @click=${this.helpToggle}\n                tabindex=\"0\"\n                @keydown=${this.handleKeydown}\n              >\n                ${helpIcon}\n              </div>`\n            : null}\n        </div>\n      </div>\n    `;\n  }\n\n  private helpSection() {\n    return html`\n      <div\n        class=\"helpContainer\"\n        tabindex=\"0\"\n        id=\"helpSection\"\n        aria-label=\"Help section.\"\n      >\n        ${this.isPortraitOrientation\n          ? html`\n              <div\n                class=\"closeHelp\"\n                id=\"helpSection\"\n                @click=${this.helpToggle}\n                @keydown=${this.handleKeydown}\n                tabindex=\"0\"\n              >\n                Close help ${closeIcon}\n              </div>\n              <div class=\"helpTitle\">\n                How to take a photo of your Identity Document\n              </div>\n            `\n          : html`\n              <div style=\"display: flex; justify-content: space-between\">\n                <div\n                  class=\"helpTitle\"\n                  id=\"helpSection\"\n                  tabindex=\"0\"\n                  style=\"margin-top:0\"\n                >\n                  How to take a photo of your Identity Document\n                </div>\n                <div\n                  id=\"helpSection\"\n                  class=\"closeHelp\"\n                  @click=${this.helpToggle}\n                  tabindex=\"0\"\n                  @keydown=${this.handleKeydown}\n                >\n                  Close help ${closeIcon}\n                </div>\n              </div>\n            `}\n        <div class=\"helpText\" id=\"helpSection\" tabindex=\"0\">\n          When Auto Capture is on, the capture screen will automatically take a\n          photo of your document when it has recognised that it is of good\n          enough quality.\n        </div>\n        <div\n          class=\"helpTitle\"\n          style=\"font-size: 16px\"\n          id=\"helpSection\"\n          tabindex=\"0\"\n        >\n          Tips for taking a good quality photo\n        </div>\n        <div class=\"tipsContainer\">\n          <div class=\"tipContainer\">\n            <div class=\"tipAnimation\">\n              <lottie-player\n                id=\"helpSection\"\n                class=\"overlay\"\n                @click=${this.toggleLottieAnimation}\n                @keydown=${this.handleKeydown}\n                style=\"width: 8vh\"\n                tabindex=\"0\"\n                aria-label=\"Use a well lit area but avoid any strong overhead lighting.\"\n                .src=${glareAnimation}\n              >\n              </lottie-player>\n              <div class=\"pauseIcon\">${pauseIcon}</div>\n            </div>\n            <div class=\"tipText\">\n              <div class=\"helpTitle\" style=\"font-size: 14px; margin-top: 0\">\n                Prevent Glare\n              </div>\n              <div class=\"helpText\" style=\"margin-top: 0\">\n                Move the document away from direct light sources.\n              </div>\n            </div>\n          </div>\n          <div class=\"tipContainer\">\n            <div class=\"tipAnimation\">\n              <lottie-player\n                @click=${this.toggleLottieAnimation}\n                class=\"overlay\"\n                aria-label=\"Fill the entire frame with your document.\"\n                style=\"width: 8vh\"\n                tabindex=\"0\"\n                id=\"helpSection\"\n                .src=${blurAnimation}\n                @keydown=${this.handleKeydown}\n              >\n              </lottie-player>\n              <div class=\"pauseIcon\">${pauseIcon}</div>\n            </div>\n            <div class=\"tipText\">\n              <div class=\"helpTitle\" style=\"font-size: 14px; margin-top: 0\">\n                Prevent Blur\n              </div>\n              <div class=\"helpText\" style=\"margin-top: 0\">\n                Hold the document or device steady.\n              </div>\n            </div>\n          </div>\n          <div class=\"tipContainer\">\n            <div class=\"tipAnimation\">\n              <lottie-player\n                class=\"overlay\"\n                id=\"helpSection\"\n                tabindex=\"0\"\n                @click=${this.toggleLottieAnimation}\n                @keydown=${this.handleKeydown}\n                aria-label=\"Hold your phone steady.\"\n                style=\"width: 8vh\"\n                .src=${lowResolutionAnimation}\n              >\n              </lottie-player>\n              <div class=\"pauseIcon\">${pauseIcon}</div>\n            </div>\n            <div class=\"tipText\">\n              <div class=\"helpTitle\" style=\"font-size: 14px; margin-top: 0\">\n                Document Too Far\n              </div>\n              <div class=\"helpText\" style=\"margin-top: 0\">\n                Fit the document fully within the frame.\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    `;\n  }\n\n  render() {\n    return html`\n      <div class=\"root\">\n        <div\n          class=\"container ${this.isPortraitOrientation\n            ? 'portrait'\n            : 'landscape'}\"\n        >\n          ${this.showHelp ? this.helpSection() : null} ${this.cameraPreview()}\n          <div\n            class=\"feedbackContainer ${this.isPortraitOrientation\n              ? null\n              : 'landscape'}\"\n          >\n            ${this.hasShownDocumentAnimation &&\n            !this.tapToCapture &&\n            !this.captured\n              ? this.cameraGuidanceSection()\n              : null}\n            ${!this.tapToCapture && !this.captured\n              ? this.generalInfoSection()\n              : null}\n            ${!this.captured ? this.manualCaptureButtonSection() : null}\n            ${!this.captured ? this.manualActionsSection() : null}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n}\n"],"names":["isIpadIOS13OrAbove","navigator","platform","maxTouchPoints","isIOS","test","iOSversion","v","appVersion","match","parseInt","_","isiOS15","ver","length","isDeviceAffectedByIOS16Issue","decodedCookie","decodeURIComponent","document","cookie","includes","isiOS163OrLess","dims","screen","width","height","long","Math","max","short","min","isSamsungNote10OrS10OrNewer","async","navData","deviceModel","userAgentData","_a","getHighEntropyValues","dm","model","userAgent","matchedModelNumber","modelNumber","smallerModelNumber","Number","isNaN","HEIC_NOT_SUPPORTED_CODE","SequenceBreak","code","message","StartFail","RuntimeError","HeicNotSupported","CameraState","WebRtcCamera","constructor","parent","smartCaptureModule","this","hiddenCanvas","createElement","hiddenContext","getContext","willReadFrequently","isStarted","isDetecting","isCapturing","lastFrameDetected","imgData","undefined","detectResponse","restartDetectionBind","restartDetectionAfterBrowserResume","bind","visibilityChangeBind","onVisibilityChange","metaDataBind","onLoadedMetaData","runDetectionBind","runDetection","videoConstraints","facingMode","ideal","aspectRatio","cameraConstraints","video","initSmartCapture","isInitialized","isInitializing","init","catch","onError","finalizeCameraConstraints","window","innerWidth","innerHeight","isiOS17","zoom","startCamera","player","getPlayer","startCameraInternal","iteration","getDeviceWasAbleToReadLabels","Boolean","deviceId","stream","mediaDevices","getUserMedia","device","getDevice","getVideoTracks","getSettings","stopMediaTracks","enableCamera","error","userMediaError","srcObject","addEvents","onCameraEnabled","stopDetection","clearTimeout","detectTimeout","endCamera","removeEvents","pause","srcStream","addEventListener","removeEventListener","paused","processFrameForDetection","setTimeout","devices","minSuffix","enumerateDevices","selectedDevice","dualWideCamera","find","d","label","isiOS164Plus","filter","kind","forEach","cameraLabel","some","keyword","split","cameraSuffixNumber","videoWidth","videoHeight","visibilityState","getTracks","track","stop","sequenceBreak","newCanvasHeight","newCanvasWidth","drawImage","getImageData","clearRect","detect","imageData","handleLiveCapture","response","isGood","onDetect","Capturing","failedChecks","OutOfFrame","isAdequateDpi","isSharp","FixGlare","FixBlur","MoveCloser","triggerCapture","manualMode","lastFrameImgData","lastFramedetectResponse","isPortraitOrientation","matchMedia","matches","Error","onCapture","isGlareFree","imageWidth","imageHeight","SmartCaptureHost$1","createWorker","workerScriptUrl","Promise","resolve","reject","smartCaptureWorker","createCrossDomainWorker","makeRequest","then","checkImage","image","requestMessage","requestData","requestId","Date","getTime","toString","responseHandler","data","id","errorHandler","e","postMessage","workerUrl","worker","testSameOrigin","Worker","type","onerror","event","preventDefault","createWorkerFallback","blob","Blob","blobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","blobUrl","URL","webkitURL","createObjectURL","e1","console","log","url","loc","location","a","href","hostname","port","protocol","SmartCaptureModule","_initialized","_initializing","barcodeReaderId","SmartCaptureHost","_b","addBarcodeReaderDiv","getElementById","barcodeReaderDiv","style","display","body","appendChild","processEncodedFrame","img","result","quality","coords","corners","coordinateCheck","mapCorners","dimensions","resolutionCheck","blurCheck","glareCheck","imageDataToBlob","w","h","putImageData","toBlob","asBlob","buffer","arrayBuffer","croppedImg","crop","imgBlob","captureData","_c","Image","src","onload","top","topLeft","y","topRight","bot","bottomLeft","bottomRight","left","x","right","addImageProcess","_SmartCaptureModule_instance","value","getInstance","__classPrivateFieldGet","__classPrivateFieldSet","cameraStyles","css","drawDocumentRectangle","context","cornerColor","fillStyle","lineWidth","canvas","center","targetWidth","targetHeight","offsetX","offsetY","defaultCorners","fillRect","point","i","index","currentOrientation","orientation","color","strokeStyle","lineJoin","beginPath","roundedX","roundedY","moveTo","lineTo","stroke","drawCorner","drawCorners","warningIcon","html","capturedIcon","helpIcon","cameraIcon","closeIcon","pauseIcon","DocumentCameraEventDispatcher","dispatchError","CustomEvent","FailureEventName","bubbles","composed","detail","dispatchEvent","dispatchCapture","captureResponse","CaptureEventName","dispatchClose","CloseEventName","dispatchOpen","OpenEventName","dispatchDetect","cameraState","DetectEventName","LiveDocumentCamera","LitElement","tabbableElements","isOpen","showHelpIcon","forceManualCamera","useHeic","texts","autoCaptureText","autoCaptureOnText","autoCaptureOffText","alertText","generalInfoTexts","hints","successTime","showToggle","toggleAutoCaptureDelay","showBackOfDocumentAnimation","hasShownDocumentAnimation","toggleDelayIsDone","tapToCaptureSpinner","tapToCapture","showHelp","captured","detectionHints","docState","moveCloserHint","title","description","fixBlurHint","fixGlareHint","_d","outOfFrameHint","_e","capturingHint","_f","videoElementRef","createRef","uiCanvasElementRef","guidanceIconRef","documentAnimationRef","documentBackAnimationRef","autoCaptureSwitchRef","isPortraitOrientationQuery","eventDispatcher","setFocusToElement","elementId","element","shadowRoot","hasAttribute","setAttribute","focus","warn","enableTabbingOnOtherElements","Array","from","querySelectorAll","disableTabbingOnOtherElements","toggleLottieAnimation","lottiePlayer","target","seek","play","handleKeydown","key","click","drawAutoCaptureFrame","autoCapture","autoCaptureToggled","ShouldShowAlert","uiCanvas","uiContext","hint","paddingTop","font","textAlign","fillText","drawAutoCaptureHint","loadHintAnimation","load","lowResolutionAnimation","blurAnimation","glareAnimation","onDocumentAnimationComplete","removeAttribute","onOrientationChange","onTapToCaptureSwitchChange","webRtcCamera","onTapToCaptureButtonClick","closeCamera","openCamera","switchDisplay","querySelector","classList","remove","add","helpToggle","connectedCallback","super","onchange","disconnectedCallback","updated","changedProperties","has","guidanceIcon","ref","documentAnimation","positionDocumentAnimationPortrait","positionDocumentAnimation","backOfDocumentAnimation","flipDocumentPortrait","flipDocument","manualActionsSection","generalInfoSection","manualCaptureButtonSection","cameraGuidanceSection","cameraPreview","classes","cameraPreviewInnerContainer","cameraPreviewInnerContainerError","cameraPreviewInnerContainerSuccess","classMap","helpSection","render","styles","__decorate","property","prototype","String","Object","state","customElement"],"mappings":"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"}