# docsbio-stickman-wasm

Wasm wrapper for smart-capture (idscan-engine-smart-capture)

## Local compilation

### Prequisites

A binary version of smart-capture-package is required -
smart-capture-package is the smart-capture binaries with
the required resource files added. Prebuild binaries for
this can be sourced from:

https://hunter.idscan.cloud/packages/smart-capture-package/wasm/

(develop is "vdev"). This should be downloaded and unpacked into:

    .pkgs/smart-capture-package

relative to this directory.

The build instructions require nvm and emsdk to be installed
as normal - installation instructions for those are out-of-scope.

The polly repo from https://github.com/idscan/polly needs to be
cloned to a local directory and environment variable POLLY_ROOT
needs to point to it.

### Building the Module

To build the module, emcmake is used but is called from npm:

    npm install
    npm run build


### Testing

There is currently a smoke test that can be run via:

    npm test

#### Browserify tests

In order to run the smoke tests from a browser, some extra steps are needed.
- Install `browserify` and `brfs` node packages
- Execute the `browserify_smoke_test.sh` from within the build folder, for example with
    ```bash
    (cd _builds && bash ../browserify_smoke_test.sh)
    ```
- In the build folder, now you should have one `*-bundle.js` and `*.html` file per test.
Just open the `*.html` file in a browser, inspect the web page and look at the console.

#### Bigmagic-web functional tests

Bigmagic-web intragrates the `stickman.js` file in the final smart capture product.
We have included a test which somehow replicates this integration for debugging purposes.
To run it, please see the [instructions](test/bigmagic_web_test/README.md).

## Basic Use

See the smoke test source (test/smoke-test/smoke-test.js)
for hints on how to use the module. Note the way the module
is loaded:

    import stickmanModuleFactory from './stickman.js';
    const stickman = await stickmanModuleFactory()

This ES6 code replaces an earlier node-orientated scheme
that was based on require() but was not portable.

**Note:** here is an additional stickman.worker.js which
is assumed to related to javascript workers, but is not
seemingly documented anywhere.

